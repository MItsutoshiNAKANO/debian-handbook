<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">14.3. Supervisión: prevención, detección, disuasión</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-es-ES-1.0-1" /><meta
        name="keywords"
        content="Firewall, Netfilter, IDS/NIDS" /><link
        rel="home"
        href="index.html"
        title="El libro del administrador de Debian" /><link
        rel="up"
        href="security.html"
        title="Capítulo 14. Seguridad" /><link
        rel="prev"
        href="sect.firewall-packet-filtering.html"
        title="14.2. Firewall o el filtrado de paquetes" /><link
        rel="next"
        href="sect.apparmor.html"
        title="14.4. Introduction to AppArmor" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/es-ES/sect.supervision.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.firewall-packet-filtering.html"><strong>Anterior</strong></a></li><li
          class="home">El libro del administrador de Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apparmor.html"><strong>Siguiente</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.supervision"></a>14.3. Supervisión: prevención, detección, disuasión</h2></div></div></div><a
          id="idm139627319790960"
          class="indexterm"></a><div
          class="para">
			La monitorización es una parte integral de cualquier política de seguridad por varias razones. Entre ellas, que el objetivo de la seguridad generalmente no se limita a garantizar la confidencialidad de los datos, sino que también incluye garantizar la disponibilidad de los servicios. Por tanto, es imprescindible comprobar que todo funciona como se espera y detectar de manera oportuna cualquier desvío en la conducta o cambio en la calidad de los servicios prestados. Monitorizar la actividad puede ayudar con la detección de intentos de intrusión y permitir una reacción rápida antes que ocurran graves consecuencias. Esta sección revisa algunas de las herramientas que puede utilizar para monitorizar varios aspectos de un sistema Debian. Como tal, esto completa la sección dedicada a la monitorización genérica del sistema en el <a
            class="xref"
            href="advanced-administration.html">Capítulo 12, <em>Administración avanzada</em></a>.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.logcheck"></a>14.3.1. Monitorización de los registros con <code
                    class="command">logcheck</code></h3></div></div></div><a
            id="idm139627319786832"
            class="indexterm"></a><a
            id="idm139627319785712"
            class="indexterm"></a><a
            id="idm139627319784272"
            class="indexterm"></a><div
            class="para">
				El programa <code
              class="command">logcheck</code> monitoriza los archivos de registro, de forma predeterminada, cada hora. Envía los mensajes de registro inusuales en correos electrónicos al administrador para su posterior análisis.
			</div><div
            class="para">
				The list of monitored files is stored in <code
              class="filename">/etc/logcheck/logcheck.logfiles</code>; the default values work fine if the <code
              class="filename">/etc/rsyslog.conf</code> file has not been completely overhauled.
			</div><div
            class="para">
				<code
              class="command">logcheck</code> puede funcionar en una de tres modalidades más o menos detalladas: <span
              class="emphasis"><em>paranoid</em></span>, <span
              class="emphasis"><em>server</em></span> y <span
              class="emphasis"><em>workstation</em></span>. El primero es <span
              class="emphasis"><em>muy</em></span> detallado y, probablemente, debería restringirlo a servidores específicos como firewalls. El segundo (y predeterminado) es el modo recomendado para la mayoría de los servidores. El ultimo está diseñado para estaciones de trabajo y es aún más conciso (filtra la mayoría de los mensajes).
			</div><div
            class="para">
				En los tres casos, probablemente debería personalizar <code
              class="command">logcheck</code> para excluir algunos mensajes adicionales (dependiendo de los servicios instalados) a menos que el administrador realmente desee recibir a cada hora correos electrónicos enormes y poco interesantes. Dado que el mecanismo de selección de mensajes es bastante complejo, <code
              class="filename">/usr/share/doc/logcheck-database/README.logcheck-database.gz</code> es una lectura — aunque difícil — necesaria.
			</div><div
            class="para">
				Las reglas aplicadas se puede dividir en varios tipos:
			</div><div
            xmlns:d="http://docbook.org/ns/docbook"
            class="itemizedlist"><ul><li
                class="listitem"><div
                  class="para">
						aquellas que clasifican un mensaje como un intento de intrusión — «cracking» (almacenado en un archivo en el directorio <code
                    class="filename">/etc/logcheck/cracking.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						aquellas que cancelan esta clasificación (<code
                    class="filename">/etc/logcheck/cracking.ignore.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						aquellos que clasifican un mensaje como una alerta de seguridad (<code
                    class="filename">/etc/logcheck/violations.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						aquellos que cancelan esta clasificación (<code
                    class="filename">/etc/logcheck/violations.ignore.d/</code>);
					</div></li><li
                class="listitem"><div
                  class="para">
						finalmente, aquellas que son aplicadas a los mensajes restantes (considerados como <span
                    class="emphasis"><em>eventos del sistema</em></span>).
					</div></li></ul></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>PRECAUCIÓN</em></span> Ignorar un mensaje</strong></p></div></div></div><div
              class="para">
				Cualquier mensaje marcado como un intento de intrusión o una alerta de seguridad (siguiendo una regla almacenada en el archivo <code
                class="filename">/etc/logcheck/violations.d/miarchivo</code>) sólo puede ser ignorado por una regla en el archivo <code
                class="filename">/etc/logcheck/violations.ignore.d/miarchivo</code> o <code
                class="filename">/etc/logcheck/violations.ignore.d/miarchivo-<em
                  class="replaceable">extensión</em></code>.
			</div></div><div
            class="para">
				Siempre se indicará un evento de sistema a menos que una regla en alguno de los directorios en <code
              class="filename">/etc/logcheck/ignore.d.{paranoid,server,workstation}/</code> indique que el evento debe ser ignorado. Por supuesto, sólo se tomarán en cuenta los directorios que corresponden a los niveles de detalle igual o mayor al modo de funcionamiento seleccionado.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.monitoring-activity"></a>14.3.2. Monitorización de actividad</h3></div></div></div><a
            id="idm139627319761680"
            class="indexterm"></a><a
            id="idm139627319760240"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.real-time-monitoring"></a>14.3.2.1. En tiempo real</h4></div></div></div><div
              class="para">
					<code
                class="command">top</code> es una herramienta interactiva que muestra una lista de los procesos en ejecución. La ordenación predeterminada es según la cantidad de procesador utilizada y se puede obtener mediante la tecla <span
                class="keycap"><strong>P</strong></span>. Entre otros criterios de ordenación podemos encontrar: según la cantidad de memoria ocupada (tecla <span
                class="keycap"><strong>M</strong></span>), según el tiempo total de uso de procesador (tecla <span
                class="keycap"><strong>T</strong></span>) y según el identificador de proceso (tecla <span
                class="keycap"><strong>N</strong></span>). La tecla <span
                class="keycap"><strong>k</strong></span> permite matar un proceso ingresando su identificador de proceso. La tecla <span
                class="keycap"><strong>r</strong></span> permite ejecutar <span
                class="emphasis"><em>renice</em></span> sobre un proceso, es decir: cambiar su prioridad.
				</div><a
              id="idm139627319754016"
              class="indexterm"></a><div
              class="para">
					Cuando el sistema aparenta estar sobrecargado, <code
                class="command">top</code> es una herramienta excelente para ver qué procesos estan compitiendo por el tiempo de procesador o consumiendo demasiada memoria. En particular, a menudo es interesante comprobar si los procesos que están consumiendo los recursos se corresponden con los servicios reales que la máquina debe albergar. Por ejemplo, un proceso desconocido ejecutándose como el usuario www-data debería llamar su atención y ser investigado puesto que posiblemente sea algún tipo de software instalado y ejecutado en el sistema a través de una vulnerabilidad en una aplicación web.
				</div><div
              class="para">
					<code
                class="command">top</code> es una herramienta muy flexible y su página de manual detalla cómo personalizar su presentación y adaptarla a las necesidades y hábitos particulares.
				</div><div
              class="para">
					The <code
                class="command">gnome-system-monitor</code> graphical tool is similar to <code
                class="command">top</code> and it provides roughly the same features.
				</div><a
              id="idm139627319748928"
              class="indexterm"></a></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.monitoring-history"></a>14.3.2.2. Historial</h4></div></div></div><a
              id="idm139627319746592"
              class="indexterm"></a><div
              class="para">
					La carga del procesador, el tráfico de red y el espacio libre en disco son datos que varían constantemente. A menudo es útil disponer de un historial con su evolución para determinar cómo se utiliza exáctamente la máquina.
				</div><a
              id="idm139627319744928"
              class="indexterm"></a><a
              id="idm139627319743968"
              class="indexterm"></a><div
              class="para">
					Existen muchas herramientas dedicadas para esta tarea. La mayoría puede obtener datos a través de SNMP (<span
                class="emphasis"><em>protocolo simple de gestión de red</em></span>: «Simple Network Management Protocol») para centralizar esta información. Un beneficio adicional es que permite recoger datos de elementos de red que pueden no ser equipos de propósito general, tal como switches o routers dedicados.
				</div><div
              class="para">
					Este libro habla de Munin con cierto detalle (ver la <a
                class="xref"
                href="sect.monitoring.html#sect.munin">Sección 12.4.1, “Configuración de Munin”</a> como parte del <a
                class="xref"
                href="advanced-administration.html">Capítulo 12: “<em>Administración avanzada</em>”</a>. Debian también proporciona una herramienta similar: <span
                class="pkg pkg">cacti</span>. Su despliegue es algo más complejo puesto que se basa exclusivamente en SNMP. A pesar de que dispone de una interfaz web, entender los conceptos involucrados en la configuración requiere de todas formas un poco de esfuerzo. Debería considerar como prerequisito leer la documentación HTML (<code
                class="filename">/usr/share/doc/cacti/html/index.html</code>).
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVA</em></span> <code
                          class="command">mrtg</code></strong></p></div></div></div><a
                id="idm139627319737280"
                class="indexterm"></a><div
                class="para">
					<code
                  class="command">mrtg</code> (contenido en el paquete del mismo nombre) es una herramienta más antigua. A pesar de algunas asperezas, puede agrupar datos históricos y mostrarlos como gráficos. Incluye algunos scripts para recolectar los datos monitorizados con más frecuencia como la carga de procesador, el tráfico de red, el número de impresiones de una página web, etc.
				</div><div
                class="para">
					Los paquetes <span
                  class="pkg pkg">mrtg-contrib</span> y <span
                  class="pkg pkg">mrtgutils</span> contienen scripts de ejemplo que puede utilizar directamente.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm139627319732512"></a>14.3.3. Detección de cambios</h3></div></div></div><div
            class="para">
				Una vez que el sistema está instalado y configurado, dejando al margen las actualizaciones de seguridad, normalmente no hay razón para que los archivos y directorios cambien con excepción de los datos. Por lo tanto, es interesante asegurarse que efectivamente los archivos no cambian: debería investigar cualquier cambio inesperado. Esta sección presenta algunas herramientas capaces de monitorizar archivos y advertir al administrador en caso de que se produzca algún cambio inesperado (o simplemente enumerar estos cambios).
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.dpkg-verify"></a>14.3.3.1. Auditing Packages with <code
                      class="command">dpkg --verify</code></h4></div></div></div><a
              id="idm139627319729328"
              class="indexterm"></a><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>YENDO MÁS ALLÁ</em></span> Protección contra los cambios de los desarrolladores originales</strong></p></div></div></div><div
                class="para">
					<code
                  class="command">dpkg --verify</code> is useful in detecting changes to files coming from a Debian package, but it will be useless if the package itself is compromised, for instance if the Debian mirror is compromised. Protecting against this class of attacks involves using APT's digital signature verification system (see <a
                  class="xref"
                  href="sect.package-authentication.html">Sección 6.5, “Comprobación de la autenticidad de un paquete”</a>), and taking care to only install packages from a certified origin.
				</div></div><div
              class="para">
					<code
                class="command">dpkg --verify</code> (or <code
                class="command">dpkg -V</code>) is an interesting tool since it allows finding what installed files have been modified (potentially by an attacker), but this should be taken with a grain of salt. To do its job it relies on checksums stored in dpkg's own database which is stored on the hard disk (they can be found in <code
                class="filename">/var/lib/dpkg/info/<em
                  class="replaceable">package</em>.md5sums</code>); a thorough attacker will therefore update these files so they contain the new checksums for the subverted files.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>BACK TO BASICS</em></span> File fingerprint</strong></p></div></div></div><a
                id="idm139627319720656"
                class="indexterm"></a><a
                id="idm139627319719696"
                class="indexterm"></a><a
                id="idm139627319718736"
                class="indexterm"></a><a
                id="idm139627319717776"
                class="indexterm"></a><div
                class="para">
					As a reminder: a fingerprint is a value, often a number (even though in hexadecimal notation), that contains a kind of signature for the contents of a file. This signature is calculated with an algorithm (MD5 or SHA1 being well-known examples) that more or less guarantee that even the tiniest change in the file contents implies a change in the fingerprint; this is known as the “avalanche effect”. This allows a simple numerical fingerprint to serve as a litmus test to check whether the contents of a file have been altered. These algorithms are not reversible; in other words, for most of them, knowing a fingerprint doesn't allow finding the corresponding contents. Recent mathematical advances seem to weaken the absoluteness of these principles, but their use is not called into question so far, since creating different contents yielding the same fingerprint still seems to be quite a difficult task.
				</div></div><div
              class="para">
					Running <code
                class="command">dpkg -V</code> will verify all installed packages and will print out a line for each file with a failing test. The output format is the same as the one of <code
                class="command">rpm -V</code> where each character denotes a test on some specific meta-data. Unfortunately <code
                class="command">dpkg</code> does not store the meta-data needed for most tests and will thus output question marks for them. Currently only the checksum test can yield a "5" on the third character (when it fails).
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -V</code></strong>
<code
                class="computeroutput">??5??????   /lib/systemd/system/ssh.service
??5?????? c /etc/libvirt/qemu/networks/default.xml
??5?????? c /etc/lvm/lvm.conf
??5?????? c /etc/salt/roster</code></pre><div
              class="para">
					In the sample above, dpkg reports a change to SSH's service file that the administrator made to the packaged file instead of using an appropriate <code
                class="filename">/etc/systemd/system/ssh.service</code> override. It also lists multiple configuration files (identified by the "c" letter on the second field) that had been legitimately modified.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.debsums"></a>14.3.3.2. Auditoría de paquetes: <code
                      class="command">debsums</code> y sus límites</h4></div></div></div><a
              id="idm139627319708464"
              class="indexterm"></a><div
              class="para">
					<code
                class="command">debsums</code> is the ancestor of <code
                class="command">dpkg -V</code> and is thus mostly obsolete. It suffers from the same limitations than dpkg. Fortunately, some of the limitations can be worked-around (whereas dpkg does not offer similar work-arounds).
				</div><div
              class="para">
					Since the data on the disk cannot be trusted, <code
                class="command">debsums</code> offers to do its checks based on <code
                class="filename">.deb</code> files instead of relying on dpkg's database. To download trusted <code
                class="filename">.deb</code> files of all the packages installed, we can rely on APT's authenticated downloads. This operation can be slow and tedious, and should therefore not be considered a proactive technique to be used on a regular basis.
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt-get --reinstall -d install `grep-status -e 'Status: install ok installed' -n -s Package`</code></strong>
<code
                class="computeroutput">[ ... ]
# </code><strong
                class="userinput"><code>debsums -p /var/cache/apt/archives --generate=all</code></strong></pre><div
              class="para">
					Sepa que este ejemplo utiliza el programa <code
                class="command">grep-status</code> del paquete <span
                class="pkg pkg">dctrl-tools</span> que no se instala de forma predeterminada.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm139627319700032"></a>14.3.3.3. Monitorización de archivos: AIDE</h4></div></div></div><a
              id="idm139627319699264"
              class="indexterm"></a><div
              class="para">
					La herramienta AIDE (<span
                class="emphasis"><em>entorno avanzado de detección de intrusión</em></span>: «Advanced Intrusion Detection Environment») permite comprobar la integridad de los archivos y detectar cualquier cambio frente a una imagen guardada previamente del sistema válido. Se almacena esta imagen como una base de datos (<code
                class="filename">/var/lib/aide/aide.db</code>) que contiene la información relevante de todos los archivos del sistema (huella digital, permisos, marcas temporales, etc.). Se inicializa esta base de datos con <code
                class="command">aideinit</code>; luego se la utiliza diariamente (por el script <code
                class="filename">/etc/cron.daily/aide</code>) para comprobar que nada importante haya cambiado. Cuando se detectan cambios, AIDE los almacena en archivos de registro (<code
                class="filename">/var/log/aide/*.log</code>) y envía lo encontrado en un email al administrador.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>EN LA PRÁCTICA</em></span> Protección de la base de datos</strong></p></div></div></div><div
                class="para">
					Debido a que AIDE utiliza una base de datos local para comparar el estado de los archivos, la validez de sus resultados está asociada directamente a la validez de la base de datos. Si un atacante consigue obtener permisos de administrador en un sistema comprometido, podrá reemplazar la base de datos y cubrir sus huellas. Una posible solución podría ser almacenar la base de datos de referencia en un medio de almacenamiento de sólo lectura.
				</div></div><div
              class="para">
					Puede utilizar numerosas opciones en el archivo <code
                class="filename">/etc/default/aide</code> para configurar el comportamiento del paquete <span
                class="pkg pkg">aide</span>. Se almacena la configuración de AIDE en sí en <code
                class="filename">/etc/aide/aide.conf</code> y <code
                class="filename">/etc/aide/aide.conf.d/</code> (de hecho, sólo <code
                class="command">update-aide.conf</code> utiliza estos archivos para generar <code
                class="filename">/var/lib/aide/aide.conf.autogenerated</code>). La configuración indica qué propiedades se deben comprobar. Por ejemplo, el contenidos de los archivos de registro cambia continuamente, y se puede ignorar estos cambios mientras que los permisos de los archivos permanezcan inalterados, pero tanto el contenido como los permisos de los programas ejecutables debe permanecer constante. Aunque no es excesivamente compleja, la sintaxis de la configuración no es del todo intuitiva y, por lo tanto, recomendamos leer su página de manual <span
                class="citerefentry"><span
                  class="refentrytitle">aide.conf</span>(5)</span>.
				</div><div
              class="para">
					Cada día se genera una nueva versión de la base de datos en <code
                class="filename">/var/lib/aide/aide.db.new</code>; si todos los cambios registrados son legítimos, puede utilizarla para reemplazar la base de datos de referencia.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ALTERNATIVA</em></span> Tripwire y Samhain</strong></p></div></div></div><div
                class="para">
					Tripwire es muy similar a AIDE; incluso la sintaxis del archivo de configuración es prácticamente la misma. La ventaja principal de <span
                  class="pkg pkg">tripwire</span> es un mecanismo para firmar el archivo de configuración, de forma que un atacante no pueda hacer que apunte a una versión diferente de la base de datos de referencia.
				</div><div
                class="para">
					Samhain también ofrece características similares, así como algunas funciones para ayudar a detectar «rootkits» (revise el recuadro VISTA RÁPIDA). También puede desplegarlo de forma global en una red y guardar sus trazas en un servidor central (con su firma correspondiente).
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>VISTA RÁPIDO</em></span> Los paquetes <span
                          class="pkg pkg">checksecurity</span> y <span
                          class="pkg pkg">chkrootkit</span>/<span
                          class="pkg pkg">rkhunter</span></strong></p></div></div></div><a
                id="idm139627321330576"
                class="indexterm"></a><div
                class="para">
					El primero de estos paquetes contiene varios scripts pequeños que realizan comprobaciones básicas en el sistema (contraseñas vacías, nuevos archivos setuid, etc.) y advierten al administrador si fuese necesario. A pesar de su nombre explícito, un administrador no debería confiar exclusivamente en él para asegurarse que un sistema Linux es seguro.
				</div><div
                class="para">
					Los paquetes <span
                  class="pkg pkg">chkrootkit</span> y <span
                  class="pkg pkg">rkhunter</span> permiten buscar posibles «<span
                  class="emphasis"><em>rootkits</em></span>» instalados en el sistema. Como recordatorio, estos son programas designados para ocultar que se ha comprometido el sistema a la vez que se mantiene el control de la máquina. Las comprobaciones no son 100% confiables, pero generalmente pueden guiar la atención del administrador a problemas potenciales.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.intrusion-detection"></a>14.3.4. Detección de intrusiones (IDS/NIDS)</h3></div></div></div><a
            id="idm139627321324448"
            class="indexterm"></a><a
            id="idm139627321323488"
            class="indexterm"></a><a
            id="idm139627321322560"
            class="indexterm"></a><a
            id="idm139627321321600"
            class="indexterm"></a><a
            id="idm139627321320672"
            class="indexterm"></a><a
            id="idm139627321319712"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>VOLVER A LOS CIMIENTOS</em></span> Denegación de servicio</strong></p></div></div></div><a
              id="idm139627321317184"
              class="indexterm"></a><div
              class="para">
				Un ataque de «denegación de servicio» tiene una única finalidad: hacer que un servicio no esté disponible. El resultado es el mismo independientemente de si el ataque implica sobrecargar al servidor mediante consultas o si se aprovecha algún fallo: el servicio deja de estar operativo. Los usuarios habituales no estarán contentos y la entidad que alberga la red a la que se dirige el ataque sufre una pérdida de reputación (y posiblemente también de ingresos, por ejemplo si el servicio es un sitio de comercio electrónico).
			</div><div
              class="para">
				Algunas veces estos ataques son «distribuidos»; esto implica habitualmente sobrecargar al servidor con una gran cantidad de consultas provenientes de diferentes fuentes para que el servidor no sea capaz de atender las consultas legítimas. Este tipo de ataques se han hecho merecedores de dos acrónimos muy conocidos: <acronym
                class="acronym">DoS</acronym> (denegación de servicio: «Denial of Service») y <acronym
                class="acronym">DDoS</acronym> (denegación de servicio distribuido: «Distributed Denial of Service») según si el ataque es distribuido o no.
			</div></div><div
            class="para">
				<code
              class="command">suricata</code> (in the Debian package of the same name) is a NIDS — a <span
              class="emphasis"><em>Network Intrusion Detection System</em></span>. Its function is to listen to the network and try to detect infiltration attempts and/or hostile acts (including denial of service attacks). All these events are logged in multiple files in <code
              class="filename">/var/log/suricata</code>. There are third party tools (Kibana/logstash) to better browse all the data collected. <div
              class="url">→ <a
                href="http://suricata-ids.org">http://suricata-ids.org</a></div> <div
              class="url">→ <a
                href="https://www.elastic.co/products/kibana">https://www.elastic.co/products/kibana</a></div>
			</div><a
            id="idm139627321309344"
            class="indexterm"></a><a
            id="idm139627321308224"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>PRECAUCIÓN</em></span> Rango de acción</strong></p></div></div></div><div
              class="para">
				The effectiveness of <code
                class="command">suricata</code> is limited by the traffic seen on the monitored network interface. It will obviously not be able to detect anything if it cannot observe the real traffic. When plugged into a network switch, it will therefore only monitor attacks targeting the machine it runs on, which is probably not the intention. The machine hosting <code
                class="command">suricata</code> should therefore be plugged into the “mirror” port of the switch, which is usually dedicated to chaining switches and therefore gets all the traffic.
			</div></div><div
            class="para">
				Configuring suricata involves reviewing and editing <code
              class="filename">/etc/suricata/suricata-debian.yaml</code>, which is very long because because each parameter is abundantly commented. A minimal configuration requires describing the range of addresses that the local network covers (<code
              class="literal">HOME_NET</code> parameter). In practice, this means the set of all potential attack targets. But getting the most of it requires reading it in full and adapting it to the local situation.
			</div><div
            class="para">
				On top of this, you should also edit <code
              class="filename">/etc/default/suricata</code> to define the network interface to monitor and to enable the init script (by setting <code
              class="literal">RUN=yes</code>). You might also want to set <code
              class="literal">LISTENMODE=pcap</code> because the default <code
              class="literal">LISTENMODE=nfqueue</code> requires further configuration to work properly (the netfilter firewall must be configured to pass packets to some userspace queue handled by suricata via the <code
              class="literal">NFQUEUE</code> target).
			</div><div
            class="para">
				To detect bad behaviour, <code
              class="command">suricata</code> needs a set of monitoring rules: you can find such rules in the <span
              class="pkg pkg">snort-rules-default</span> package. <code
              class="command">snort</code> is the historical reference in the IDS ecosystem and <code
              class="command">suricata</code> is able to reuse rules written for it. Unfortunately that package is missing from <span
              class="distribution distribution">Debian Jessie</span> and should be retrieved from another Debian release like <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				Alternatively, <code
              class="command">oinkmaster</code> (in the package of the same name) can be used to download Snort rulesets from external sources.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>YENDO MÁS ALLÁ</em></span> Integración con <code
                        class="command">prelude</code></strong></p></div></div></div><div
              class="para">
				Prelude permite la monitorización centralizada de la información de seguridad. Su arquitectura modular incluye un servidor (el <span
                class="emphasis"><em>gestor</em></span>, en el paquete <span
                class="pkg pkg">prelude-manager</span>), que recoge las alertas generadas por los <span
                class="emphasis"><em>sensores</em></span> de diferentes tipos.
			</div><div
              class="para">
				Suricata can be configured as such a sensor. Other possibilities include <span
                class="emphasis"><em>prelude-lml</em></span> (<span
                class="emphasis"><em>Log Monitor Lackey</em></span>) which monitors log files (in a manner similar to <code
                class="command">logcheck</code>, described in <a
                class="xref"
                href="sect.supervision.html#sect.logcheck">Sección 14.3.1, “Monitorización de los registros con <code
                  class="command">logcheck</code>”</a>).
			</div><a
              id="idm139627321286976"
              class="indexterm"></a></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.firewall-packet-filtering.html"><strong>Anterior</strong>14.2. Firewall o el filtrado de paquetes</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Subir</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Inicio</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apparmor.html"><strong>Siguiente</strong>14.4. Introduction to AppArmor</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.supervision.html">ar-MA</a></li><li><a
              href="../da-DK/sect.supervision.html">da-DK</a></li><li><a
              href="../de-DE/sect.supervision.html">de-DE</a></li><li><a
              href="../el-GR/sect.supervision.html">el-GR</a></li><li><a
              href="../en-US/sect.supervision.html">en-US</a></li><li><a
              href="../es-ES/sect.supervision.html">es-ES</a></li><li><a
              href="../fa-IR/sect.supervision.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.supervision.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.supervision.html">hr-HR</a></li><li><a
              href="../id-ID/sect.supervision.html">id-ID</a></li><li><a
              href="../it-IT/sect.supervision.html">it-IT</a></li><li><a
              href="../ja-JP/sect.supervision.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.supervision.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.supervision.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.supervision.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.supervision.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.supervision.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.supervision.html">zh-CN</a></li></ul></div></body></html>
