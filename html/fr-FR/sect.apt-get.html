<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. aptitude, apt-get, and apt Commands</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-fr-FR-1.0-1" /><meta
        name="keywords"
        content="apt, apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Le cahier de l'administrateur Debian" /><link
        rel="up"
        href="apt.html"
        title="Chapitre 6. Maintenance et mise à jour : les outils APT" /><link
        rel="prev"
        href="apt.html"
        title="Chapitre 6. Maintenance et mise à jour : les outils APT" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. Commande apt-cache" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/fr-FR/sect.apt-get.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Précédent</strong></a></li><li
          class="home">Le cahier de l'administrateur Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>Suivant</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.apt-get"></a>6.2. <code
                  class="command">aptitude</code>, <code
                  class="command">apt-get</code>, and <code
                  class="command">apt</code> Commands</h2></div></div></div><a
          id="idm140065044801216"
          class="indexterm"></a><a
          id="idm140065044800096"
          class="indexterm"></a><a
          id="idm140065044798976"
          class="indexterm"></a><div
          class="para">
			APT is a vast project, whose original plans included a graphical interface. It is based on a library which contains the core application, and <code
            class="command">apt-get</code> is the first front end — command-line based — which was developed within the project. <code
            class="command">apt</code> is a second command-line based front end provided by APT which overcomes some design mistakes of <code
            class="command">apt-get</code>.
		</div><div
          class="para">
			Numerous other graphical interfaces then appeared as external projects: <code
            class="command">synaptic</code>, <code
            class="command">aptitude</code> (which includes both a text mode interface and a graphical one — even if not complete yet), <code
            class="command">wajig</code>, etc. The most recommended interface, <code
            class="command">apt</code>, is the one that we will use in the examples given in this section. Note however that <code
            class="command">apt-get</code> and <code
            class="command">aptitude</code> have a very similar command line syntax. When there are major differences between <code
            class="command">apt</code>, <code
            class="command">apt-get</code> and <code
            class="command">aptitude</code>, these differences will be detailed.
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140065044790928"></a>6.2.1. Initialisation</h3></div></div></div><div
            class="para">
				For any work with APT, the list of available packages needs to be updated; this can be done simply through <code
              class="command">apt update</code>. Depending on the speed of your connection, the operation can take a while since it involves downloading a certain number of <code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">language-code</em></code> files, which have gradually become bigger and bigger as Debian has developed (at least 10 MB of data for the <code
              class="literal">main</code> section). Of course, installing from a CD-ROM set does not require any downloading — in this case, the operation is very fast.
			</div><a
            id="idm140065044786512"
            class="indexterm"></a><a
            id="idm140065044785392"
            class="indexterm"></a><a
            id="idm140065044784272"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140065044782992"></a>6.2.2. Installation et suppression</h3></div></div></div><a
            id="idm140065044782224"
            class="indexterm"></a><a
            id="idm140065044780784"
            class="indexterm"></a><a
            id="idm140065044779344"
            class="indexterm"></a><a
            id="idm140065044777904"
            class="indexterm"></a><div
            class="para">
				With APT, packages can be added or removed from the system, respectively with <code
              class="command">apt install <em
                class="replaceable">package</em></code> and <code
              class="command">apt remove <em
                class="replaceable">package</em></code>. In both cases, APT will automatically install the necessary dependencies or delete the packages which depend on the package that is being removed. The <code
              class="command">apt purge <em
                class="replaceable">package</em></code> command involves a complete uninstallation — the configuration files are also deleted.
			</div><a
            id="idm140065044773872"
            class="indexterm"></a><a
            id="idm140065044772752"
            class="indexterm"></a><a
            id="idm140065044771632"
            class="indexterm"></a><a
            id="idm140065044770512"
            class="indexterm"></a><a
            id="idm140065044769392"
            class="indexterm"></a><a
            id="idm140065044768272"
            class="indexterm"></a><a
            id="idm140065044767152"
            class="indexterm"></a><a
            id="idm140065044766032"
            class="indexterm"></a><a
            id="idm140065044764912"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Installer la même sélection de paquets plusieurs fois</strong></p></div></div></div><div
              class="para">
				Il est parfois souhaitable de pouvoir installer systématiquement la même liste de paquets sur plusieurs ordinateurs. C'est possible assez facilement.
			</div><div
              class="para">
				Récupérons d'abord la liste des paquets installés sur l'ordinateur qui servira de « modèle » à dupliquer.
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;liste-pkg</code></strong></pre><div
              class="para">
				The <code
                class="filename">pkg-list</code> file then contains the list of installed packages. Next, transfer the <code
                class="filename">pkg-list</code> file onto the computers you want to update and use the following commands:
			</div><pre
              class="screen">## Mettre à jour la base de données des paquets connus par dpkg
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## Mettre à jour les sélections de dpkg
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## Demander à apt-get d'installer les paquets sélectionnés
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				La première commande enregistre la liste des paquets disponibles dans la base de données de dpkg, puis <code
                class="command">dpkg --set-selections</code> restaure les vœux de paquets à installer, que l'invocation d'<code
                class="command">apt-get</code> exauce ensuite ! <code
                class="command">aptitude</code> n'offre pas cette commande.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Supprimer et installer en même temps</strong></p></div></div></div><div
              class="para">
				It is possible to ask <code
                class="command">apt</code> (or <code
                class="command">apt-get</code>, or <code
                class="command">aptitude</code>) to install certain packages and remove others on the same command line by adding a suffix. With an <code
                class="command">apt install</code> command, add “<code
                class="literal">-</code>” to the names of the packages you wish to remove. With an <code
                class="command">apt remove</code> command, add “<code
                class="literal">+</code>” to the names of the packages you wish to install.
			</div><div
              class="para">
				L'exemple suivant montre deux manières d'installer <em
                class="replaceable">paquet1</em> et de supprimer <em
                class="replaceable">paquet2</em>.
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>
[...]
</pre><div
              class="para">
				Ceci permet également d'exclure des paquets qui seraient installés sinon, par exemple à cause d'un champ <code
                class="literal">Recommends</code>. De manière générale, le résolveur de dépendances utilisera cette information pour ajuster sa recherche de solutions alternatives.
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt --reinstall</code> and <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="idm140065044740640"
              class="indexterm"></a><div
              class="para">
				The system can sometimes be damaged after the removal or modification of files in a package. The easiest way to retrieve these files is to reinstall the affected package. Unfortunately, the packaging system finds that the latter is already installed and politely refuses to reinstall it; to avoid this, use the <code
                class="literal">--reinstall</code> option of the <code
                class="command">apt</code> and <code
                class="command">apt-get</code> commands. The following command reinstalls <span
                class="pkg pkg">postfix</span> even if it is already present:
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt --reinstall install postfix</code></strong></pre><div
              class="para">
				La ligne de commande d'<code
                class="command">aptitude</code> est un peu différente, mais le même effet s'obtient avec <code
                class="command">aptitude reinstall postfix</code>.
			</div><div
              class="para">
				Le problème ne se pose pas avec <code
                class="command">dpkg</code>, mais il est rare que l'administrateur emploie directement ce dernier.
			</div><div
              class="para">
				Be careful! Using <code
                class="command">apt --reinstall</code> to restore packages modified during an attack will certainly not recover the system as it was. <a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">Section 14.7, « En cas de piratage »</a> details the necessary steps to take with a compromised system.
			</div></div><div
            class="para">
				If the file <code
              class="filename">sources.list</code> mentions several distributions, it is possible to give the version of the package to install. A specific version number can be requested with <code
              class="command">apt install <em
                class="replaceable">package</em>=<em
                class="replaceable">version</em></code>, but indicating its distribution of origin (<span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span>) — with <code
              class="command">apt install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> — is usually preferred. With this command, it is possible to go back to an older version of a package (if for instance you know that it works well), provided that it is still available in one of the sources referenced by the <code
              class="filename">sources.list</code> file. Otherwise the <code
              class="literal">snapshot.debian.org</code> archive can come to the rescue (see sidebar <a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>POUR ALLER PLUS LOIN</em></span> Anciennes versions des paquets : <code
                class="literal">snapshot.debian.org</code></a>).
			</div><div
            class="example"><a
              id="idm140065044723952"></a><p
              class="title"><strong>Exemple 6.3. Installation de la version <span
                  class="distribution distribution">Unstable</span> de <span
                  class="pkg pkg">spamassassin</span></strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>POUR ALLER PLUS LOIN</em></span> Cache des fichiers <code
                        class="filename">.deb</code></strong></p></div></div></div><div
              class="para">
				APT keeps a copy of each downloaded <code
                class="filename">.deb</code> file in the directory <code
                class="filename">/var/cache/apt/archives/</code>. In case of frequent updates, this directory can quickly take a lot of disk space with several versions of each package; you should regularly sort through them. Two commands can be used: <code
                class="command">apt-get clean</code> entirely empties the directory; <code
                class="command">apt-get autoclean</code> only removes packages which can no longer be downloaded (because they have disappeared from the Debian mirror) and are therefore clearly useless (the configuration parameter <code
                class="literal">APT::Clean-Installed</code> can prevent the removal of <code
                class="filename">.deb</code> files that are currently installed). Note that <code
                class="command">apt</code> does not support those commands.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-upgrade"></a>6.2.3. Mise à jour</h3></div></div></div><a
            id="idm140065044713776"
            class="indexterm"></a><a
            id="idm140065044712336"
            class="indexterm"></a><a
            id="idm140065044711216"
            class="indexterm"></a><a
            id="idm140065044710096"
            class="indexterm"></a><div
            class="para">
				Regular upgrades are recommended, because they include the latest security updates. To upgrade, use <code
              class="command">apt upgrade</code>, <code
              class="command">apt-get upgrade</code> or <code
              class="command">aptitude safe-upgrade</code> (of course after <code
              class="command">apt update</code>). This command looks for installed packages which can be upgraded without removing any packages. In other words, the goal is to ensure the least intrusive upgrade possible. <code
              class="command">apt-get</code> is slightly more demanding than <code
              class="command">aptitude</code> or <code
              class="command">apt</code> because it will refuse to install packages which were not installed beforehand.
			</div><div
            class="sidebar"><a
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Mise à jour incrémentale</strong></p></div></div></div><div
              class="para">
				As we explained earlier, the aim of the <code
                class="command">apt update</code> command is to download for each package source the corresponding <code
                class="filename">Packages</code> (or <code
                class="filename">Sources</code>) file. However, even after a <code
                class="command">bzip2</code> compression, these files can remain rather large (the <code
                class="filename">Packages.xz</code> for the <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> section of <span
                class="distribution distribution">Jessie</span> takes more than 6 MB). If you wish to upgrade regularly, these downloads can take up a lot of time.
			</div><div
              class="para">
				To speed up the process APT can download “diff” files containing the changes since the previous update, as opposed to the entire file. To achieve this, official Debian mirrors distribute different files which list the differences between one version of the <code
                class="filename">Packages</code> file and the following version. They are generated at each update of the archives and a history of one week is kept. Each of these “diff” files only takes a few dozen kilobytes for <span
                class="distribution distribution">Unstable</span>, so that the amount of data downloaded by a weekly <code
                class="command">apt update</code> is often divided by 10. For distributions like <span
                class="distribution distribution">Stable</span> and <span
                class="distribution distribution">Testing</span>, which change less, the gain is even more noticeable.
			</div><div
              class="para">
				On notera cependant qu'il est parfois intéressant de forcer le téléchargement du fichier <code
                class="filename">Packages</code> complet, notamment lorsque la dernière mise à jour est vraiment trop ancienne et que le mécanisme des différences incrémentales n'apporterait rien. Cela peut également être intéressant dans les cas où l'accès réseau est très rapide mais où le processeur de la machine à mettre à jour est relativement lent, le temps gagné sur le téléchargement des fichiers étant plus que perdu lors du calcul des nouvelles versions de ces fichiers à partir des anciennes versions et des différences téléchargées. Pour cela, on pourra utiliser le paramètre de configuration <code
                class="literal">Acquire::Pdiffs</code>, que l'on règlera à <code
                class="literal">false</code>.
			</div></div><div
            class="para">
				<code
              class="command">apt</code> will generally select the most recent version number (except for packages from <span
              class="distribution distribution">Experimental</span> and <span
              class="distribution distribution">stable-backports</span>, which are ignored by default whatever their version number). If you specified <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span> in your <code
              class="filename">sources.list</code>, <code
              class="command">apt upgrade</code> will switch most of your <span
              class="distribution distribution">Stable</span> system to <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span>, which might not be what you intended.
			</div><div
            class="para">
				To tell <code
              class="command">apt</code> to use a specific distribution when searching for upgraded packages, you need to use the <code
              class="literal">-t</code> or <code
              class="literal">--target-release</code> option, followed by the name of the distribution you want (for example: <code
              class="command">apt -t stable upgrade</code>). To avoid specifying this option every time you use <code
              class="command">apt</code>, you can add <code
              class="literal">APT::Default-Release "stable";</code> in the file <code
              class="filename">/etc/apt/apt.conf.d/local</code>.
			</div><a
            id="idm140065038991296"
            class="indexterm"></a><a
            id="idm140065038990176"
            class="indexterm"></a><a
            id="idm140065038989056"
            class="indexterm"></a><a
            id="idm140065038987936"
            class="indexterm"></a><a
            id="idm140065038986816"
            class="indexterm"></a><div
            class="para">
				For more important upgrades, such as the change from one major Debian version to the next, you need to use <code
              class="command">apt full-upgrade</code>. With this instruction, <code
              class="command">apt</code> will complete the upgrade even if it has to remove some obsolete packages or install new dependencies. This is also the command used by users who work daily with the Debian <span
              class="distribution distribution">Unstable</span> release and follow its evolution day by day. It is so simple that it hardly needs explanation: APT's reputation is based on this great functionality.
			</div><div
            class="para">
				Unlike <code
              class="command">apt</code> and <code
              class="command">aptitude</code>, <code
              class="command">apt-get</code> doesn't know the <code
              class="command">full-upgrade</code> command. Instead, you should use <code
              class="command">apt-get dist-upgrade</code> (”distribution upgrade”), the historical and well-known command that <code
              class="command">apt</code> and <code
              class="command">aptitude</code> also accept for the convenience of users who got used to it.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-config"></a>6.2.4. Options de configuration</h3></div></div></div><a
            id="idm140065038977984"
            class="indexterm"></a><a
            id="idm140065038976544"
            class="indexterm"></a><a
            id="idm140065038975424"
            class="indexterm"></a><div
            class="para">
				Outre les éléments de configuration déjà mentionnés, il est possible de configurer quelques aspects d'APT en ajoutant des directives dans un fichier du répertoire <code
              class="filename">/etc/apt/apt.conf.d/</code>. Rappelons par exemple qu'il est possible pour APT d'indiquer à <code
              class="command">dpkg</code> d'ignorer les erreurs de collision de fichiers en précisant <code
              class="literal">DPkg::Options { "--force-overwrite"; }</code>.
			</div><div
            class="para">
				Si l'accès au Web n'est possible qu'à travers un mandataire (proxy), il faut ajouter une ligne semblable à <code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">monproxy</em>:3128"</code>. Pour un proxy FTP, on écrira <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">monproxy</em>"</code>. Découvrez par vous-même les autres options de configuration en consultant la page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span>, avec la commande <code
              class="command">man apt.conf</code> (pour plus de détails sur les pages de manuel, voir <a
              class="xref"
              href="solving-problems.html#sect.manual-pages">Section 7.1.1, « Les pages de manuel »</a>).
			</div><div
            class="sidebar"><a
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>B.A.-BA</em></span> Répertoire en <code
                        class="filename">.d</code></strong></p></div></div></div><a
              id="idm140065038965680"
              class="indexterm"></a><div
              class="para">
				Les répertoires de suffixe <code
                class="filename">.d</code> sont de plus en plus souvent employés. Chacun abrite des fichiers ventilant un fichier de configuration. Ainsi, tous les fichiers contenus dans <code
                class="filename">/etc/apt/apt.conf.d/</code> constituent les instructions de configuration d'APT. APT les inclura dans l'ordre alphabétique, de sorte que les derniers pourront modifier un élément de configuration défini dans l'un des premiers.
			</div><div
              class="para">
				Cette structure apporte une certaine souplesse à l'administrateur de la machine et aux mainteneurs de paquets. En effet, l'administrateur peut facilement modifier la configuration du logiciel en déposant un fichier tout prêt dans le répertoire en question sans devoir modifier de fichier existant. Les mainteneurs de paquets ont la même problématique lorsqu'ils doivent adapter la configuration d'un autre logiciel pour assurer une parfaite cohabitation avec le leur. La charte Debian interdit explicitement toute modification de fichiers de configuration relevant d'autres paquets, interdiction justifiée par le fait que seuls les utilisateurs sont habilités à intervenir ainsi. Rappelons en effet que <code
                class="command">dpkg</code> invite l'utilisateur, lors d'une installation, à choisir la version du fichier de configuration qu'il souhaite conserver lorsqu'une modification y est détectée. Toute modification externe du fichier déclencherait une telle requête, qui ne manquerait pas de perturber l'administrateur certain de n'avoir rien altéré.
			</div><div
              class="para">
				Without a <code
                class="filename">.d</code> directory, it is impossible for an external package to change the settings of a program without modifying its configuration file. Instead it must invite the user to do it themselves and lists the operations to be done in the file <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">package</em>/README.Debian</code>.
			</div><div
              class="para">
				Selon les applications, le répertoire <code
                class="filename">.d</code> est directement exploité, ou géré par un script externe qui en concaténera tous les fichiers pour créer le fichier de configuration à proprement parler. Il est alors important d'exécuter ce script après toute intervention dans ce répertoire pour que les plus récentes modifications soient prises en compte. De même, on prendra soin de ne pas travailler directement sur le fichier de configuration construit automatiquement, sous peine de tout perdre lors de l'exécution suivante du script. Le choix de la méthode (répertoire <code
                class="filename">.d</code> utilisé directement ou fichier généré à partir de ce répertoire) est généralement dicté par des contraintes de mise en œuvre, mais dans les deux cas, les gains en termes de souplesse de configuration compensent largement les petites complications induites. Comme exemple de la méthode du fichier généré, on peut citer le serveur de messagerie Exim 4, dont la configuration peut être découpée en plusieurs fichiers (<code
                class="filename">/etc/exim4/conf.d/*</code>) qui sont agrégés en un seul (<code
                class="filename">/var/lib/exim4/config.autogenerated</code>) par la commande <code
                class="command">update-exim4.conf</code>.
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt.priorities"></a>6.2.5. Gérer les priorités associées aux paquets</h3></div></div></div><div
            class="para">
				Une des problématiques les plus importantes dans la configuration d'APT est la gestion des priorités des différentes sources de paquets. Il arrive en effet assez fréquemment qu'on souhaite compléter une distribution d'un ou deux paquets plus récents issus de <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span>, ou <span
              class="distribution distribution">Experimental</span>. Il est possible d'affecter une priorité à chaque paquet disponible (un même paquet pouvant recevoir plusieurs priorités, selon sa version ou sa distribution d'appartenance). Ces priorités dicteront à APT son comportement : pour chaque paquet, il sélectionnera systématiquement la version de plus haute priorité (sauf si cette version est plus ancienne que celle installée et si la priorité associée est inférieure à 1000).
			</div><a
            id="idm140065038950032"
            class="indexterm"></a><a
            id="idm140065038948432"
            class="indexterm"></a><a
            id="idm140065038947504"
            class="indexterm"></a><a
            id="idm140065038946064"
            class="indexterm"></a><a
            id="idm140065038944624"
            class="indexterm"></a><a
            id="idm140065038943184"
            class="indexterm"></a><a
            id="idm140065038942064"
            class="indexterm"></a><div
            class="para">
				APT définit un certain nombre de priorités par défaut. Chaque version de paquetage déjà installée a une priorité de 100, une version non installée reçoit une priorité de 500 sauf si elle fait partie de la distribution cible (<span
              class="foreignphrase"><em
                class="foreignphrase">Target Release</em></span>), qu'on spécifie avec l'option <code
              class="literal">-t</code> ou la directive <code
              class="literal">APT::Default-Release</code>, auquel cas sa priorité passe à 990.
			</div><div
            class="para">
				On modifiera ces priorités en intervenant sur le fichier <code
              class="filename">/etc/apt/preferences</code> pour y ajouter des entrées de quelques lignes décrivant le nom des paquets concernés, leur version, leur origine et leur nouvelle priorité.
			</div><div
            class="para">
				APT refusera toujours d'installer une version antérieure d'un paquet (portant un numéro de version inférieur à celui de la version actuelle), sauf si la priorité du paquet concerné est supérieure à 1000. APT installera toujours la version de priorité la plus élevée. Si deux versions ont la même priorité, APT installe la plus récente (de numéro de version le plus grand). Si deux paquets de même version ont la même priorité mais diffèrent par leurs contenus, APT installe la version qui n'est pas installée (cette règle doit couvrir le cas d'une mise à jour de paquet sans incrément — normalement indispensable — du numéro de révision).
			</div><div
            class="para">
				Concrètement, un paquet de priorité inférieure à 0 ne sera jamais installé. Un paquet de priorité comprise entre 0 et 100 ne sera installé que si aucune autre version du même paquet n'est installée. Avec une priorité comprise entre 100 et 500, le paquet ne sera installé que s'il n'en existe aucune version plus récente, installée ou disponible dans une autre distribution. Un paquet de priorité entre 501 et 990 ne sera installé qu'à défaut de version plus récente, installée ou disponible dans la distribution cible. Une priorité entre 990 et 1000 fera installer le paquet, sauf si la version installée est plus récente. Une priorité supérieure à 1000 provoquera l'installation du paquet, même si cela force APT à installer une version plus ancienne que la version actuelle.
			</div><div
            class="para">
				When APT checks <code
              class="filename">/etc/apt/preferences</code>, it first takes into account the most specific entries (often those specifying the concerned package), then the more generic ones (including for example all the packages of a distribution). If several generic entries exist, the first match is used. The available selection criteria include the package's name and the source providing it. Every package source is identified by the information contained in a <code
              class="filename">Release</code> file that APT downloads together with the <code
              class="filename">Packages</code> files. It specifies the origin (usually “Debian” for the packages of official mirrors, but it can also be a person's or an organization's name for third-party repositories). It also gives the name of the distribution (usually <span
              class="distribution distribution">Stable</span>, <span
              class="distribution distribution">Testing</span>, <span
              class="distribution distribution">Unstable</span> or <span
              class="distribution distribution">Experimental</span> for the standard distributions provided by Debian) together with its version (for example 8 for Debian <span
              class="distribution distribution">Jessie</span>). Let's have a look at its syntax through some realistic case studies of this mechanism.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAS PARTICULIER</em></span> Priorité d'<span
                        class="distribution distribution">Experimental</span></strong></p></div></div></div><a
              id="idm140065038926976"
              class="indexterm"></a><div
              class="para">
				Si vous avez inscrit <span
                class="distribution distribution">Experimental</span> dans votre fichier <code
                class="filename">sources.list</code>, les paquets correspondants ne seront quasiment jamais installés, leur priorité APT étant de 1. C'est un cas particulier qui évite que les utilisateurs installent des paquets <span
                class="distribution distribution">Experimental</span> par erreur et les oblige à opérer en tapant <code
                class="command">aptitude install <em
                  class="replaceable">paquet</em>/experimental</code> — ils ont donc pleinement conscience des risques encourus. Il est possible, mais ce n'est <span
                class="emphasis"><em>pas</em></span> recommandé, de considérer les paquets <span
                class="distribution distribution">Experimental</span> comme ceux des autres distributions en leur affectant une priorité de 500 grâce à une entrée dans le fichier <code
                class="filename">/etc/apt/preferences</code> :
			</div><div
              class="informalexample"><pre
                class="programlisting">
Package: *
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div><div
            class="para">
				Supposons qu'on souhaite utiliser exclusivement des paquets provenant de la version stable de Debian, sans jamais installer ceux des autres versions sauf demande explicite. Il est possible d'écrire ce qui suit dans le fichier <code
              class="filename">/etc/apt/preferences</code> :
			</div><div
            class="informalexample"><pre
              class="programlisting">
Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10
</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> précise le nom de la distribution concernée. <code
              class="literal">o=Debian</code> restreint l'entrée aux paquets dont l'origine est « Debian ». Le terme <span
              class="foreignphrase"><em
                class="foreignphrase">pin</em></span> (épingle en anglais), est généralement traduit, dans ce contexte, par « étiquetage », car il permet d'accrocher à un paquet une étiquette désignant de quelle distribution il doit provenir.
			</div><div
            class="para">
				Let's now assume that you have a server with several local programs depending on the version 5.14 of Perl and that you want to ensure that upgrades will not install another version of it. You could use this entry:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001
</pre></div><div
            class="para">
				La documentation de référence sur ce fichier de configuration est disponible dans la page de manuel <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span>, accessible par la commande <code
              class="command">man apt_preferences</code>.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> Commentaires dans <code
                        class="filename">/etc/apt/preferences</code></strong></p></div></div></div><a
              id="idm140065038909424"
              class="indexterm"></a><a
              id="idm140065038908304"
              class="indexterm"></a><a
              id="idm140065038907184"
              class="indexterm"></a><div
              class="para">
				Il n'existe pas de syntaxe standard pour introduire des commentaires dans le fichier <code
                class="filename">/etc/apt/preferences</code>, mais il est possible d'y expliquer le rôle de chaque entrée à l'aide d'un ou plusieurs champs « <code
                class="literal">Explanation</code> » (explication) placés en début de bloc :
			</div><div
              class="informalexample"><pre
                class="programlisting">
Explanation: Le paquet xserver-xorg-video-intel contenu dans
Explanation: experimental peut être utilisé
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500
</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-mix-distros"></a>6.2.6. Travailler avec plusieurs distributions</h3></div></div></div><div
            class="para">
				<code
              class="command">apt</code> being such a marvelous tool, it is tempting to pick packages coming from other distributions. For example, after having installed a <span
              class="distribution distribution">Stable</span> system, you might want to try out a software package available in <span
              class="distribution distribution">Testing</span> or <span
              class="distribution distribution">Unstable</span> without diverging too much from the system's initial state.
			</div><div
            class="para">
				Even if you will occasionally encounter problems while mixing packages from different distributions, <code
              class="command">apt</code> manages such coexistence very well and limits risks very effectively. The best way to proceed is to list all distributions used in <code
              class="filename">/etc/apt/sources.list</code> (some people always put the three distributions, but remember that <span
              class="distribution distribution">Unstable</span> is reserved for experienced users) and to define your reference distribution with the <code
              class="literal">APT::Default-Release</code> parameter (see <a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">Section 6.2.3, « Mise à jour »</a>).
			</div><div
            class="para">
				Let's suppose that <span
              class="distribution distribution">Stable</span> is your reference distribution but that <span
              class="distribution distribution">Testing</span> and <span
              class="distribution distribution">Unstable</span> are also listed in your <code
              class="filename">sources.list</code> file. In this case, you can use <code
              class="command">apt install <em
                class="replaceable">package</em>/testing</code> to install a package from <span
              class="distribution distribution">Testing</span>. If the installation fails due to some unsatisfiable dependencies, let it solve those dependencies within <span
              class="distribution distribution">Testing</span> by adding the <code
              class="literal">-t testing</code> parameter. The same obviously applies to <span
              class="distribution distribution">Unstable</span>.
			</div><div
            class="para">
				In this situation, upgrades (<code
              class="command">upgrade</code> and <code
              class="command">full-upgrade</code>) are done within <span
              class="distribution distribution">Stable</span> except for packages already upgraded to another distribution: those will follow updates available in the other distributions. We will explain this behavior with the help of the default priorities set by APT below. Do not hesitate to use <code
              class="command">apt-cache policy</code> (see sidebar) to verify the given priorities.
			</div><div
            class="para">
				Tout est lié au fait que APT ne considère que les paquets de version supérieure ou égale à la version installée (sauf configuration particulière dans <code
              class="filename">/etc/apt/preferences</code> forçant la priorité de certains paquets au-delà de 1000).
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ASTUCE</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				Pour mieux comprendre le mécanisme des priorités, n'hésitez pas à employer <code
                class="command">apt-cache policy</code> pour voir la priorité par défaut associée à chaque source de paquets, et <code
                class="command">apt-cache policy <em
                  class="replaceable">paquet</em></code> pour consulter les priorités des différentes versions disponibles d'un paquet donné.
			</div></div><div
            class="para">
				Considérons un premier paquet installé depuis <span
              class="distribution distribution">Stable</span> et qui en est à la version 1, dont la version 2 se trouve dans <span
              class="distribution distribution">Testing</span> et la 3 dans <span
              class="distribution distribution">Unstable</span>. La version installée a une priorité de 100, mais la version disponible dans <span
              class="distribution distribution">Stable</span> (la même) a une priorité de 990 (en tant que version dans la distribution cible). Les paquets de <span
              class="distribution distribution">Testing</span> et <span
              class="distribution distribution">Unstable</span> ont une priorité de 500 (priorité par défaut d'une version non installée). Le vainqueur est donc la version 1 avec une priorité de 990. Le paquet « reste dans <span
              class="distribution distribution">Stable</span> ».
			</div><div
            class="para">
				Prenons le cas d'un autre paquet, dont la version 2 a été installée depuis <span
              class="distribution distribution">Testing</span> ; la version 1 est disponible dans <span
              class="distribution distribution">Stable</span> et la 3 dans <span
              class="distribution distribution">Unstable</span>. La version 1 (de priorité 990 — donc inférieure à 1000) est ignorée car plus petite que la version installée. Restent donc les versions 2 et 3, toutes deux de priorité 500. Face à ce choix, APT choisit la version la plus récente, celle de la distribution <span
              class="distribution distribution">Unstable</span>. Si vous ne souhaitez pas qu'un paquet installé depuis <span
              class="distribution distribution">Testing</span> puisse migrer vers <span
              class="distribution distribution">Unstable</span> il faut associer une priorité inférieure à 500 (par exemple, 490) aux paquets provenant d'<span
              class="distribution distribution">Unstable</span> en modifiant <code
              class="filename">/etc/apt/preferences</code> :
			</div><pre
            class="programlisting">
Package: *
Pin: release a=unstable
Pin-Priority: 490
</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.automatic-tracking"></a>6.2.7. Suivi des paquets installés automatiquement</h3></div></div></div><div
            class="para">
				One of the essential functionalities of <code
              class="command">apt</code> is the tracking of packages installed only through dependencies. These packages are called “automatic”, and often include libraries for instance.
			</div><div
            class="para">
				With this information, when packages are removed, the package managers can compute a list of automatic packages that are no longer needed (because there is no “manually installed” packages depending on them). <code
              class="command">apt-get autoremove</code> will get rid of those packages. <code
              class="command">aptitude</code> and <code
              class="command">apt</code> do not have this command: the former because it removes them automatically as soon as they are identified, and the latter probably because the user should not have to manually run such a command. In all cases, the tools display a clear message listing the affected packages.
			</div><a
            id="idm140065038862304"
            class="indexterm"></a><a
            id="idm140065038861184"
            class="indexterm"></a><a
            id="idm140065038860064"
            class="indexterm"></a><a
            id="idm140065038858944"
            class="indexterm"></a><div
            class="para">
				Il est sain d'adopter l'habitude de marquer comme automatiques les paquets dont on n'a pas besoin directement, de sorte qu'ils soient automatiquement supprimés lorsqu'ils ne sont plus nécessaires. <code
              class="command">apt-mark auto <em
                class="replaceable">paquet</em></code> marque le paquet concerné comme automatique et <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> fait le contraire. <code
              class="command">aptitude markauto</code> et <code
              class="command">aptitude unmarkauto</code> fonctionnent de la même manière, mais offrent plus de fonctionnalités permettant de marquer plusieurs paquets d'un coup (voir <a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">Section 6.4.1, « <code
                class="command">aptitude</code> »</a>). L'interface interactive en mode semi-graphique d'<code
              class="command">aptitude</code> facilite également la maintenance de ce marqueur « automatique » sur de nombreux paquets.
			</div><a
            id="idm140065038853360"
            class="indexterm"></a><div
            class="para">
				People might want to know why an automatically installed package is present on the system. To get this information from the command line, you can use <code
              class="command">aptitude why <em
                class="replaceable">package</em></code> (<code
              class="command">apt</code> and <code
              class="command">apt-get</code> have no similar feature):
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code> aptitude why python-debian</code></strong>
<code
              class="computeroutput">i   aptitude         Recommande apt-xapian-index         
i A apt-xapian-index Dépend     python-debian (&gt;= 0.1.15)</code>
</pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> <code
                        class="command">deborphan</code> et <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="idm140065038846144"
              class="indexterm"></a><a
              id="idm140065038845024"
              class="indexterm"></a><div
              class="para">
				In days where <code
                class="command">apt</code>, <code
                class="command">apt-get</code> and <code
                class="command">aptitude</code> were not able to track automatic packages, there were two utilities producing lists of unnecessary packages: <code
                class="command">deborphan</code> and <code
                class="command">debfoster</code>.
			</div><div
              class="para">
				<code
                class="command">deborphan</code> is the most rudimentary of both. It simply scans the <code
                class="literal">libs</code> and <code
                class="literal">oldlibs</code> sections (in the absence of supplementary instructions) looking for the packages that are currently installed and that no other package depends on. The resulting list can then serve as a basis to remove unneeded packages.
			</div><div
              class="para">
				<code
                class="command">debfoster</code> a une approche plus évoluée, qui se rapproche un peu de celle d'APT : il maintient une liste de paquets installés explicitement et se rappelle d'une invocation sur l'autre quels paquets sont réellement requis. Si de nouveaux paquets sont apparus sur le système, et si <code
                class="command">debfoster</code> ne les connaît pas comme des paquets requis, ils seront présentés à l'écran, ainsi qu'une liste de leurs dépendances. Le programme propose alors un choix, permettant de supprimer le paquet (ainsi que ceux dont il dépend, le cas échéant), de le marquer comme explicitement requis, ou de l'ignorer temporairement.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>Précédent</strong>Chapitre 6. Maintenance et mise à jour : les outi...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Niveau supérieur</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Sommaire</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>Suivant</strong>6.3. Commande apt-cache</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.apt-get.html">ar-MA</a></li><li><a
              href="../da-DK/sect.apt-get.html">da-DK</a></li><li><a
              href="../de-DE/sect.apt-get.html">de-DE</a></li><li><a
              href="../el-GR/sect.apt-get.html">el-GR</a></li><li><a
              href="../en-US/sect.apt-get.html">en-US</a></li><li><a
              href="../es-ES/sect.apt-get.html">es-ES</a></li><li><a
              href="../fa-IR/sect.apt-get.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.apt-get.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.apt-get.html">hr-HR</a></li><li><a
              href="../id-ID/sect.apt-get.html">id-ID</a></li><li><a
              href="../it-IT/sect.apt-get.html">it-IT</a></li><li><a
              href="../ja-JP/sect.apt-get.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.apt-get.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.apt-get.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.apt-get.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.apt-get.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.apt-get.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.apt-get.html">zh-CN</a></li></ul></div></body></html>
