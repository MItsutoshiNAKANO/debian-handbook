<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">10.3. Quality of Service</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-zh-CN-1.0-1" /><meta
        name="keywords"
        content="Network, Gateway, TCP/IP, IPv6, DNS, Bind, DHCP, QoS" /><link
        rel="home"
        href="index.html"
        title="Debian 管理员手册" /><link
        rel="up"
        href="network-infrastructure.html"
        title="第 10 章 Network Infrastructure" /><link
        rel="prev"
        href="sect.virtual-private-network.html"
        title="10.2. Virtual Private Network" /><link
        rel="next"
        href="sect.dynamic-routing.html"
        title="10.4. Dynamic Routing" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/zh-CN/sect.quality-of-service.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.virtual-private-network.html"><strong>上一页</strong></a></li><li
          class="home">Debian 管理员手册</li><li
          class="next"><a
            accesskey="n"
            href="sect.dynamic-routing.html"><strong>下一页</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.quality-of-service"></a>10.3. Quality of Service</h2></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.qos-principe"></a>10.3.1. Principle and Mechanism</h3></div></div></div><div
            class="para">
				<span
              class="emphasis"><em>Quality of Service</em></span> (or <span
              class="emphasis"><em>QoS</em></span> for short) refers to a set of techniques that guarantee or improve the quality of the service provided to applications. The most popular such technique involves classifying the network traffic into categories, and differentiating the handling of traffic according to which category it belongs to. The main application of this differentiated services concept is <span
              class="emphasis"><em>traffic shaping</em></span>, which limits the data transmission rates for connections related to some services and/or hosts so as not to saturate the available bandwidth and starve important other services. Traffic shaping is a particularly good fit for TCP traffic, since this protocol automatically adapts to available bandwidth.
			</div><a
            id="idm139867179451712"
            class="indexterm"></a><a
            id="idm139867179450752"
            class="indexterm"></a><a
            id="idm139867179449792"
            class="indexterm"></a><a
            id="idm139867179448352"
            class="indexterm"></a><div
            class="para">
				It is also possible to alter the priorities on traffic, which allows prioritizing packets related to interactive services (such as <code
              class="command">ssh</code> and <code
              class="command">telnet</code>) or to services that only deal with small blocks of data.
			</div><div
            class="para">
				The Debian kernels include the features required for QoS along with their associated modules. These modules are many, and each of them provides a different service, most notably by way of special schedulers for the queues of IP packets; the wide range of available scheduler behaviors spans the whole range of possible requirements.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CULTURE</em></span> LARTC — <span
                        class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span></strong></p></div></div></div><div
              class="para">
				The <span
                class="emphasis"><em>Linux Advanced Routing &amp; Traffic Control</em></span> HOWTO is the reference document covering everything there is to know about network quality of service. <div
                class="url">→ <a
                  href="http://www.lartc.org/howto/">http://www.lartc.org/howto/</a></div>
			</div><a
              id="idm139867179441168"
              class="indexterm"></a><a
              id="idm139867179439728"
              class="indexterm"></a><a
              id="idm139867179438288"
              class="indexterm"></a></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.qos-config"></a>10.3.2. Configuring and Implementing</h3></div></div></div><div
            class="para">
				QoS parameters are set through the <code
              class="command">tc</code> command (provided by the <span
              class="pkg pkg">iproute</span> package). Since its interface is quite complex, using higher-level tools is recommended.
			</div><a
            id="idm139867179434112"
            class="indexterm"></a><a
            id="idm139867179432992"
            class="indexterm"></a><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.qos-wondershaper"></a>10.3.2.1. Reducing Latencies: <code
                      class="command">wondershaper</code></h4></div></div></div><div
              class="para">
					The main purpose of <code
                class="command">wondershaper</code> (in the similarly-named package) is to minimize latencies independent of network load. This is achieved by limiting total traffic to a value that falls just short of the link saturation value.
				</div><a
              id="idm139867179429280"
              class="indexterm"></a><a
              id="idm139867179428160"
              class="indexterm"></a><a
              id="idm139867179427200"
              class="indexterm"></a><div
              class="para">
					Once a network interface is configured, setting up this traffic limitation is achieved by running <code
                class="command">wondershaper <em
                  class="replaceable">interface</em> <em
                  class="replaceable">download_rate</em> <em
                  class="replaceable">upload_rate</em></code>. The interface can be <code
                class="literal">eth0</code> or <code
                class="literal">ppp0</code> for example, and both rates are expressed in kilobits per second. The <code
                class="command">wondershaper remove <em
                  class="replaceable">interface</em></code> command disables traffic control on the specified interface.
				</div><div
              class="para">
					For an Ethernet connection, this script is best called right after the interface is configured. This is done by adding <code
                class="literal">up</code> and <code
                class="literal">down</code> directives to the <code
                class="filename">/etc/network/interfaces</code> file allowing declared commands to be run, respectively, after the interface is configured and before it is deconfigured. For example:
				</div><div
              class="example"><a
                id="example.network-interfaces"></a><p
                class="title"><strong>例 10.9. Changes in the <code
                    class="filename">/etc/network/interfaces</code> file</strong></p><div
                class="example-contents"><pre
                  class="programlisting">
iface eth0 inet dhcp
    up /sbin/wondershaper eth0 500 100
    down /sbin/wondershaper remove eth0
</pre></div></div><div
              class="para">
					In the PPP case, creating a script that calls <code
                class="command">wondershaper</code> in <code
                class="filename">/etc/ppp/ip-up.d/</code> will enable traffic control as soon as the connection is up.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>GOING FURTHER</em></span> Optimal configuration</strong></p></div></div></div><div
                class="para">
					The <code
                  class="filename">/usr/share/doc/wondershaper/README.Debian.gz</code> file describes, in some detail, the configuration method recommended by the package maintainer. In particular, it advises measuring the download and upload speeds so as to best evaluate real limits.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="sect.qos-config-standard"></a>10.3.2.2. Standard Configuration</h4></div></div></div><div
              class="para">
					Barring a specific QoS configuration, the Linux kernel uses the <code
                class="literal">pfifo_fast</code> queue scheduler, which provides a few interesting features by itself. The priority of each processed IP packet is based on the ToS field (<span
                class="emphasis"><em>Type of Service</em></span>) of this packet; modifying this field is enough to take advantage of the scheduling features. There are five possible values:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							Normal-Service (0);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Minimize-Cost (2);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Maximize-Reliability (4);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Maximize-Throughput (8);
						</div></li><li
                  class="listitem"><div
                    class="para">
							Minimize-Delay (16).
						</div></li></ul></div><a
              id="idm139867177721856"
              class="indexterm"></a><a
              id="idm139867177720896"
              class="indexterm"></a><div
              class="para">
					The ToS field can be set by applications that generate IP packets, or modified on the fly by <span
                class="emphasis"><em>netfilter</em></span>. The following rules are sufficient to increase responsiveness for a server's SSH service:
				</div><pre
              class="programlisting scale">
iptables -t mangle -A PREROUTING -p tcp --sport ssh -j TOS --set-tos Minimize-Delay
iptables -t mangle -A PREROUTING -p tcp --dport ssh -j TOS --set-tos Minimize-Delay
</pre></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.virtual-private-network.html"><strong>上一页</strong>10.2. Virtual Private Network</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上一级</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>起始页</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.dynamic-routing.html"><strong>下一页</strong>10.4. Dynamic Routing</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.quality-of-service.html">ar-MA</a></li><li><a
              href="../da-DK/sect.quality-of-service.html">da-DK</a></li><li><a
              href="../de-DE/sect.quality-of-service.html">de-DE</a></li><li><a
              href="../el-GR/sect.quality-of-service.html">el-GR</a></li><li><a
              href="../en-US/sect.quality-of-service.html">en-US</a></li><li><a
              href="../es-ES/sect.quality-of-service.html">es-ES</a></li><li><a
              href="../fa-IR/sect.quality-of-service.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.quality-of-service.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.quality-of-service.html">hr-HR</a></li><li><a
              href="../id-ID/sect.quality-of-service.html">id-ID</a></li><li><a
              href="../it-IT/sect.quality-of-service.html">it-IT</a></li><li><a
              href="../ja-JP/sect.quality-of-service.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.quality-of-service.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.quality-of-service.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.quality-of-service.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.quality-of-service.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.quality-of-service.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.quality-of-service.html">zh-CN</a></li></ul></div></body></html>
