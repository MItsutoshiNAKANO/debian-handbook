<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">فصل 15. إنشاء حزمة دبيان</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ar-MA-1.0-1" /><meta
        name="keywords"
        content="نقل خلفي, إعادة بناء, حزمة مصدرية, أرشيف, حزمة فوقية, مطور دبيان, مشرف" /><link
        rel="home"
        href="index.html"
        title="دفتر مدير دبيان" /><link
        rel="up"
        href="index.html"
        title="دفتر مدير دبيان" /><link
        rel="prev"
        href="sect.dealing-with-compromised-machine.html"
        title="14.7. التعامل مع جهاز مُختَرَق" /><link
        rel="next"
        href="sect.building-first-package.html"
        title="15.2. بناء حزمتك الأولى" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ar-MA/debian-packaging.html" /></head><body
      dir="rtl"
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>السابق</strong></a></li><li
          class="home">دفتر مدير دبيان</li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>التالي</strong></a></li></ul><div
        xml:lang="ar-MA"
        class="chapter"
        lang="ar-MA"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  id="debian-packaging"></a>فصل 15. إنشاء حزمة دبيان</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="debian-packaging.html#sect.rebuilding-package">15.1. إعادة بناء حزمة من المصدر</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="debian-packaging.html#idm140534160269760">15.1.1. الحصول على المصادر</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#idm140534157651536">15.1.2. إجراء التغييرات</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#idm140534160472544">15.1.3. بدء إعادة البناء</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.building-first-package.html">15.2. بناء حزمتك الأولى</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#idm140534138524304">15.2.1. الحزم الفوقية أو الحزم الزائفة</a></span></dt><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#idm140534139283120">15.2.2. أرشيف ملفات بسيط</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.setup-apt-package-repository.html">15.3. إنشاء مستودع حزم للأداة APT</a></span></dt><dt><span
                class="section"><a
                  href="sect.becoming-package-maintainer.html">15.4. كيف تصبح مشرف حزم</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#idm140534139951408">15.4.1. تعلم إنشاء الحزم</a></span></dt><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#idm140534139888224">15.4.2. عملية القبول</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		من الشائع جداً، بين مديري النظم الذين يتعاملون مع حزم جبيان بشكل منتظم، أن يصلوا إلى مرحلة يحتاجون فيها لإنشاء حزم خاصة بهم، أو لتعديل حزمة سابقة. يهدف هذا الفصل للإجابة عن أكثر الأسئلة شيوعاً في هذا المجال، وتقديم العناصر اللازمة للاستفادة من بنية دبيان التحتية بأفضل طريقة ممكنة. ومع بعض الحظ، قد تشعر ‒بعد تجربة مهاراتك في الحزم المحلية‒ بالحاجة للغوص أكثر من ذلك وتنضم لمشروع دبيان نفسه!
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    id="sect.rebuilding-package"></a>15.1. إعادة بناء حزمة من المصدر</h2></div></div></div><div
            class="para">
			Rebuilding a binary package is required under several sets of circumstances. In some cases, the administrator needs a software feature that requires the software to be compiled from sources, with a particular compilation option; in others, the software as packaged in the installed version of Debian is not recent enough. In the latter case, the administrator will usually build a more recent package taken from a newer version of Debian — such as <span
              class="distribution distribution">Testing</span> or even <span
              class="distribution distribution">Unstable</span> — so that this new package works in their <span
              class="distribution distribution">Stable</span> distribution; this operation is called “backporting”. As usual, care should be taken, before undertaking such a task, to check whether it has been done already — a quick look on the Debian Package Tracker for that package will reveal that information. <div
              class="url">→ <a
                href="https://tracker.debian.org/">https://tracker.debian.org/</a></div> <a
              id="idm140534142416688"
              class="indexterm"></a>
		</div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="idm140534160269760"></a>15.1.1. الحصول على المصادر</h3></div></div></div><div
              class="para">
				Rebuilding a Debian package starts with getting its source code. The easiest way is to use the <code
                class="command">apt-get source <em
                  class="replaceable">source-package-name</em></code> command. This command requires a <code
                class="literal">deb-src</code> line in the <code
                class="filename">/etc/apt/sources.list</code> file, and up-to-date index files (i.e. <code
                class="command">apt-get update</code>). These conditions should already be met if you followed the instructions from the chapter dealing with APT configuration (see <a
                class="xref"
                href="apt.html#sect.apt-sources.list">قسم 6.1, “تعبئة الملف <code
                  class="filename">sources.list</code>”</a>). Note however, that you will be downloading the source packages from the Debian version mentioned in the <code
                class="literal">deb-src</code> line. If you need another version, you may need to download it manually from a Debian mirror or from the web site. This involves fetching two or three files (with extensions <code
                class="filename">*.dsc</code> — for <span
                class="emphasis"><em>Debian Source Control</em></span> — <code
                class="filename">*.tar.<em
                  class="replaceable">comp</em></code>, and sometimes <code
                class="filename">*.diff.gz</code> or <code
                class="filename">*.debian.tar.<em
                  class="replaceable">comp</em></code> — <em
                class="replaceable">comp</em> taking one value among <code
                class="literal">gz</code>, <code
                class="literal">bz2</code> or <code
                class="literal">xz</code> depending on the compression tool in use), then run the <code
                class="command">dpkg-source -x <em
                  class="replaceable">file.dsc</em></code> command. If the <code
                class="filename">*.dsc</code> file is directly accessible at a given URL, there is an even simpler way to fetch it all, with the <code
                class="command">dget <em
                  class="replaceable">URL</em></code> command. This command (which can be found in the <span
                class="pkg pkg">devscripts</span> package) fetches the <code
                class="filename">*.dsc</code> file at the given address, then analyzes its contents, and automatically fetches the file or files referenced within. Once everything has been downloaded, it extracts the source package (unless the <code
                class="literal">-d</code> or <code
                class="literal">--download-only</code> option is used).
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="idm140534157651536"></a>15.1.2. إجراء التغييرات</h3></div></div></div><div
              class="para">
				The source of the package is now available in a directory named after the source package and its version (for instance, <span
                class="emphasis"><em>samba-4.1.17+dfsg</em></span>); this is where we'll work on our local changes.
			</div><div
              class="para">
				The first thing to do is to change the package version number, so that the rebuilt packages can be distinguished from the original packages provided by Debian. Assuming the current version is <code
                class="literal">2:4.1.17+dfsg-2</code>, we can create version <code
                class="literal">2:4.1.17+dfsg-2falcot1</code>, which clearly indicates the origin of the package. This makes the package version number higher than the one provided by Debian, so that the package will easily install as an update to the original package. Such a change is best effected with the <code
                class="command">dch</code> command (<span
                class="emphasis"><em>Debian CHangelog</em></span>) from the <span
                class="pkg pkg">devscripts</span> package, with an command such as <code
                class="command">dch --local falcot</code>. This invokes a text editor (<code
                class="command">sensible-editor</code> — this should be your favorite editor if it is mentioned in the <code
                class="varname">VISUAL</code> or <code
                class="varname">EDITOR</code> environment variables, and the default editor otherwise) to allow documenting the differences brought by this rebuild. This editor shows us that <code
                class="command">dch</code> really did change the <code
                class="filename">debian/changelog</code> file.
			</div><div
              class="para">
				When a change in build options is required, the changes need to be made in <code
                class="filename">debian/rules</code>, which drives the steps in the package build process. In the simplest cases, the lines concerning the initial configuration (<code
                class="literal">./configure …</code>) or the actual build (<code
                class="literal">$(MAKE) …</code> or <code
                class="literal">make …</code>) are easy to spot. If these commands are not explicitly called, they are probably a side effect of another explicit command, in which case please refer to their documentation to learn more about how to change the default behavior. With packages using <code
                class="command">dh</code>, you might need to add an override for the <code
                class="command">dh_auto_configure</code> or <code
                class="command">dh_auto_build</code> commands (see their respective manual pages for explanations on how to achieve this).
			</div><div
              class="para">
				قد تحتاج تحديث الملف <code
                class="filename">debian/control</code> أيضاً اعتماداً على طبيعة التغييرات المحلية التي أجريتها على الحزمة، يحوي هذا الملف وصفاً للحزم المولّدة. على وجه الخصوص، يحوي هذا الملف سطور <code
                class="literal">Build-Depends</code> تتحكم بقائمة الاعتماديات التي يجب تلبيتها عند بناء الحزمة. تشير هذه الاعتماديات غالباً إلى نسخ الحزم الموجودة في التوزيعة التي أتت منها الحزمة المصدرية، لكنها قد لا تكون متوفرة في التوزيعة المستخدمة للبناء. لا توجد طريقة مؤتمتة تبيّن هل الاعتمادية حقيقية أم أنها محددة فقط لضمان محاولة البناء باستخدام آخر نسخة من المكتبة — هذه هي الطريقة الوحيدة المتاحة لإجبار البانيات الآلية (<span
                class="emphasis"><em>autobuilder</em></span>) على استخدام نسخة معينة من الحزمة أثناء البناء، لذلك يستخدم مشرفو دبيان في كثير من الأحيان اعتماديات لها أرقام محددة.
			</div><div
              class="para">
				إذا كنت متأكداً أن هذه الاعتماديات صارمة أكثر من اللازم، يمكنك تخفيفها محلياً. ستساعدك قراءة الملفات التي توثق الطريقة المعيارية لبناء البرنامج — هذه الملفات تدعى <code
                class="filename">INSTALL</code> غالباً — على معرفة الاعتماديات المناسبة. في الحالة المثالية، يجب أن تتمكن من تلبية الاعتماديات ضمن التوزيعة المستخدمة للبناء؛ إذا لم تتمكن من ذلك، ستبدأ عملية تعاودية، حيث يجب نقل الحزم المذكورة في الحقل <code
                class="literal">Build-Depends</code> خلفاً قبل أن تتمكن من نقل الحزمة المستهدفة. قد لا تحتاج بعض الحزم أن تنقلها خلفياً، ويمكن تثبيتها كما هي أثناء عملية البناء (إحدى الأمثلة البارزة هي <span
                class="pkg pkg">debhelper</span>). لاحظ أن عملية النقل الخلفي قد تتعقد سريعاً إذا لم تكن حذراً. لذلك، يجب تقليل المنقولات الخلفية إلى أقل ما يمكن.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>تلميح</em></span> تثبيت <code
                          class="literal">Build-Depends</code></strong></p></div></div></div><a
                id="idm140534160477248"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">apt-get</code> allows installing all packages mentioned in the <code
                  class="literal">Build-Depends</code> fields of a source package available in a distribution mentioned in a <code
                  class="literal">deb-src</code> line of the <code
                  class="filename">/etc/apt/sources.list</code> file. This is a simple matter of running the <code
                  class="command">apt-get build-dep <em
                    class="replaceable">source-package</em></code> command.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="idm140534160472544"></a>15.1.3. بدء إعادة البناء</h3></div></div></div><div
              class="para">
				بعد تطبيق كل التغييرات التي تحتاجها إلى الكود المصدري، يمكننا توليد الحزمة الثنائية (ملف <code
                dir="ltr"
                class="filename">.deb</code>). يدير الأمر <code
                class="command">dpkg-buildpackage</code> العملية كلها.
			</div><div
              class="example"><a
                id="idm140534139842592"></a><p
                class="title"><strong>مثال 15.1. إعادة بناء حزمة</strong></p><div
                class="example-contents"><pre
                  class="screen">
<code
                    class="computeroutput">$ </code><strong
                    class="userinput"><code>dpkg-buildpackage -us -uc</code></strong>
[...]
</pre></div></div><div
              class="sidebar"><a
                id="sidebar.fakeroot"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>أدوات</em></span> <code
                          class="command">fakeroot</code></strong></p></div></div></div><div
                class="para">
				في الحقيقة، عملية إنشاء الحزم ما هي إلا تجميع لمجموعة ملفات سابقة (أو مبنية) في أرشيف واحد؛ ينتهي الحال بمعظم الملفات داخل الأرشيف بأن تصبح ملكاً للمستخدم <span
                  class="emphasis"><em>root</em></span>. لكن بناء الحزمة بالكامل تحت صلاحيات هذا المستخدم يعني زيادة المخاطر؛ لحسن الحظ، يمكنك تفادي ذلك باستخدام الأمر <code
                  class="command">fakeroot</code>. يمكن استخدام هذه الأداة لتشغيل برنامج وإعطائه انطباعاً أنه يعمل بصلاحيات <span
                  class="emphasis"><em>root</em></span> وينشئ ملفات لها ملكية وصلاحيات كيفيّة. عندما ينشئ البرنامج الأرشيف الذي سيصبح حزمة دبيان، سوف يخدع وينشئ أرشيفاً يحوي ملفات تنتمي لمالكين غير محددين، بما فيهم <span
                  class="emphasis"><em>root</em></span>. هذه العملية مريحة جداً لدرجة أن <code
                  class="command">dpkg-buildpackage</code> يستخدم <code
                  class="command">fakeroot</code> افتراضياً عند بناء الحزم.
			</div><div
                class="para">
				لاحظ أن البرنامج يخدع فقط حتى ”يصدق“ أنه يعمل بصلاحيات حساب إداري، لكن العملية تعمل فعلياً تحت صلاحيات المستخدم الحالي الذي استدعى <code
                  class="command">fakeroot <em
                    class="replaceable">program</em></code> (وسوف تنشأ الملفات في الحقيقة بصلاحيات ذلك المستخدم). لا تمنح أي صلاحيات إدارية يستطيع البرنامج إساءة استخدامها نهائياً.
			</div></div><div
              class="para">
				قد يفشل الأمر السابق إذا لم تُحدَّث حقول <code
                class="literal">Build-Depends</code>، أو إذا لم تُثبَّت الحزم المناسبة. في هذه الحالات، يمكن تجاوز عملية التحقق عبر تمرير الخيار <code
                dir="ltr"
                class="literal">-d</code> إلى <code
                class="command">dpkg-buildpackage</code>. لكن تجاهل هذه الاعتماديات صراحة يعرضك لخطر إخفاق عملية البناء في مرحلة لاحقة. وأسوأ من ذلك، قد يبدو أن الحزمة تبنى بشكل صحيح لكنها لا تعمل بشكل سليم لاحقاً: فبعض البرامج تعطّل بعض مزاياها آلياً إذا لم تعثر على إحدى المكتبات المطلوبة أثناء البناء.
			</div><div
              class="para">
				في معظم الأحيان، يستخدم مطورو دبيان برنامجاً عالي المستوى مثل <code
                class="command">debuild</code>؛ الذي يستدعي <code
                class="command">dpkg-buildpackage</code> كالعادة لكنه يضيف أيضاً استدعاءً لبرنامج يجري عدة فحوصات للتحقق من اتفاق الحزم المولّدة مع سياسة دبيان. كما يُنظِّف هذا السكربت البيئة بحيث لا ”تُلوّث“ متغيرات البيئة المحلية عملية بناء الحزمة. الأمر <code
                class="command">debuild</code> هو أحد الأدوات من المجموعة <span
                class="emphasis"><em>devscripts</em></span>، التي تتناسق مع بعضها وتشترك في بعض الإعدادات حتى تسهِّل مهمة مشرف الحزمة.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>نظرة سريعة</em></span> <code
                          class="command">pbuilder</code></strong></p></div></div></div><a
                id="idm140534138532624"
                class="indexterm"></a><div
                class="para">
				يسمح البرنامج <code
                  class="command">pbuilder</code> (في الحزمة ذات الاسم نفسه) ببناء حزمة دبيان في بيئة لها جذر مختلف (<span
                  class="emphasis"><em>chrooted</em></span> environment). ينشئ البرنامج أولاً مجلداً مؤقتاً يحوي النظام المصغر اللازم لبناء الحزمة (يتضمن الحزم المذكورة في <span
                  class="emphasis"><em>Build-Depends</em></span> أيضاً). بعدها يستخدم هذا المجلد كمجلد جذر (<code
                  class="filename">/</code>) أثناء عملية البناء، وذلك باستخدام الأمر <code
                  class="command">chroot</code>.
			</div><div
                class="para">
				تسمح هذه الأداة بإجراء عملية البناء في بيئة لم تمسها تعديلات المستخدمين. يسمح هذا باكتشاف اعتماديات البناء المفقودة فوراً (لأن البناء لن ينجح ما لم تكن الاعتماديات المناسبة موثقة). أخيراً، تسمح هذه الأداة أيضاً ببناء حزمة لنسخة دبيان تختلف عن النسخة التي يستخدمها النظام ككل: فقد يستخدم الجهاز دبيان <span
                  class="distribution distribution">المستقرة</span> في أعماله العادية، وتستطيع <code
                  class="command">pbuilder</code> على الجهاز نفسه استخدام <span
                  class="distribution distribution">غير المستقرة</span> لبناء الحزم.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>السابق</strong>14.7. التعامل مع جهاز مُختَرَق</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>أعلى</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>البداية</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>التالي</strong>15.2. بناء حزمتك الأولى</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/debian-packaging.html">ar-MA</a></li><li><a
              href="../da-DK/debian-packaging.html">da-DK</a></li><li><a
              href="../de-DE/debian-packaging.html">de-DE</a></li><li><a
              href="../el-GR/debian-packaging.html">el-GR</a></li><li><a
              href="../en-US/debian-packaging.html">en-US</a></li><li><a
              href="../es-ES/debian-packaging.html">es-ES</a></li><li><a
              href="../fa-IR/debian-packaging.html">fa-IR</a></li><li><a
              href="../fr-FR/debian-packaging.html">fr-FR</a></li><li><a
              href="../hr-HR/debian-packaging.html">hr-HR</a></li><li><a
              href="../id-ID/debian-packaging.html">id-ID</a></li><li><a
              href="../it-IT/debian-packaging.html">it-IT</a></li><li><a
              href="../ja-JP/debian-packaging.html">ja-JP</a></li><li><a
              href="../pl-PL/debian-packaging.html">pl-PL</a></li><li><a
              href="../pt-BR/debian-packaging.html">pt-BR</a></li><li><a
              href="../ro-RO/debian-packaging.html">ro-RO</a></li><li><a
              href="../ru-RU/debian-packaging.html">ru-RU</a></li><li><a
              href="../tr-TR/debian-packaging.html">tr-TR</a></li><li><a
              href="../zh-CN/debian-packaging.html">zh-CN</a></li></ul></div></body></html>
