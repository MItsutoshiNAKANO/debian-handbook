<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">Глава 15. Создание пакета Debian</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Бэкпортирование, Пересборка, Пакет с исходным кодом, Архив, Метапакет, Разработчик Debian, Сопровождающий" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="prev"
        href="sect.dealing-with-compromised-machine.html"
        title="14.7. Dealing with a Compromised Machine" /><link
        rel="next"
        href="sect.building-first-package.html"
        title="15.2. Сборка вашего первого пакета" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ru-RU/debian-packaging.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>След.</strong></a></li></ul><div
        xml:lang="ru-RU"
        class="chapter"
        lang="ru-RU"><div
          class="titlepage"><div><div><h1
                class="title"><a
                  id="debian-packaging"></a>Глава 15. Создание пакета Debian</h1></div></div></div><div
          class="toc"><dl
            class="toc"><dt><span
                class="section"><a
                  href="debian-packaging.html#sect.rebuilding-package">15.1. Пересборка пакета из его исходного кода</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="debian-packaging.html#idm140254124469712">15.1.1. Получение исходного кода</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#idm140254110589040">15.1.2. Внесение изменений</a></span></dt><dt><span
                    class="section"><a
                      href="debian-packaging.html#idm140254102606144">15.1.3. Запуск пересборки</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.building-first-package.html">15.2. Сборка вашего первого пакета</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#idm140254103063168">15.2.1. Метапакеты или пакеты-пустышки</a></span></dt><dt><span
                    class="section"><a
                      href="sect.building-first-package.html#idm140254103049152">15.2.2. Простое файловое хранилище</a></span></dt></dl></dd><dt><span
                class="section"><a
                  href="sect.setup-apt-package-repository.html">15.3. Создание репозитория пакетов для APT</a></span></dt><dt><span
                class="section"><a
                  href="sect.becoming-package-maintainer.html">15.4. Как стать сопровождающим пакета</a></span></dt><dd><dl><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#idm140254101470128">15.4.1. Учимся создавать пакеты</a></span></dt><dt><span
                    class="section"><a
                      href="sect.becoming-package-maintainer.html#idm140254101407680">15.4.2. Процесс принятия</a></span></dt></dl></dd></dl></div><div
          class="highlights"><div
            class="para">
		Нередко администратор, постоянно имеющий дело с пакетами Debian, со временем чувствует необходимость в создании своих собственных пакетов или изменении существующего пакета. Цель этой главы состоит в том, чтобы ответить на наиболее распространенные вопросы в этой области, а также предоставить необходимые базовые знания для использования инфраструктуры Debian наилучшим образом. Если повезет, после попытки приложить руку к созданию локальных пакетов вы даже можете почувствовать потребность в том, чтобы пойти дальше и присоединиться к самому Проекту Debian!
	</div></div><div
          class="section"><div
            class="titlepage"><div><div><h2
                  class="title"><a
                    id="sect.rebuilding-package"></a>15.1. Пересборка пакета из его исходного кода</h2></div></div></div><div
            class="para">
			Rebuilding a binary package is required under several sets of circumstances. In some cases, the administrator needs a software feature that requires the software to be compiled from sources, with a particular compilation option; in others, the software as packaged in the installed version of Debian is not recent enough. In the latter case, the administrator will usually build a more recent package taken from a newer version of Debian — such as <span
              class="distribution distribution">Testing</span> or even <span
              class="distribution distribution">Unstable</span> — so that this new package works in their <span
              class="distribution distribution">Stable</span> distribution; this operation is called “backporting”. As usual, care should be taken, before undertaking such a task, to check whether it has been done already — a quick look on the Debian Package Tracker for that package will reveal that information. <div
              class="url">→ <a
                href="https://tracker.debian.org/">https://tracker.debian.org/</a></div> <a
              id="idm140254105986272"
              class="indexterm"></a>
		</div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="idm140254124469712"></a>15.1.1. Получение исходного кода</h3></div></div></div><div
              class="para">
				Rebuilding a Debian package starts with getting its source code. The easiest way is to use the <code
                class="command">apt-get source <em
                  class="replaceable">source-package-name</em></code> command. This command requires a <code
                class="literal">deb-src</code> line in the <code
                class="filename">/etc/apt/sources.list</code> file, and up-to-date index files (i.e. <code
                class="command">apt-get update</code>). These conditions should already be met if you followed the instructions from the chapter dealing with APT configuration (see <a
                class="xref"
                href="apt.html#sect.apt-sources.list">Раздел 6.1, «Filling in the <code
                  class="filename">sources.list</code> File»</a>). Note however, that you will be downloading the source packages from the Debian version mentioned in the <code
                class="literal">deb-src</code> line. If you need another version, you may need to download it manually from a Debian mirror or from the web site. This involves fetching two or three files (with extensions <code
                class="filename">*.dsc</code> — for <span
                class="emphasis"><em>Debian Source Control</em></span> — <code
                class="filename">*.tar.<em
                  class="replaceable">comp</em></code>, and sometimes <code
                class="filename">*.diff.gz</code> or <code
                class="filename">*.debian.tar.<em
                  class="replaceable">comp</em></code> — <em
                class="replaceable">comp</em> taking one value among <code
                class="literal">gz</code>, <code
                class="literal">bz2</code> or <code
                class="literal">xz</code> depending on the compression tool in use), then run the <code
                class="command">dpkg-source -x <em
                  class="replaceable">file.dsc</em></code> command. If the <code
                class="filename">*.dsc</code> file is directly accessible at a given URL, there is an even simpler way to fetch it all, with the <code
                class="command">dget <em
                  class="replaceable">URL</em></code> command. This command (which can be found in the <span
                class="pkg pkg">devscripts</span> package) fetches the <code
                class="filename">*.dsc</code> file at the given address, then analyzes its contents, and automatically fetches the file or files referenced within. Once everything has been downloaded, it extracts the source package (unless the <code
                class="literal">-d</code> or <code
                class="literal">--download-only</code> option is used).
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="idm140254110589040"></a>15.1.2. Внесение изменений</h3></div></div></div><div
              class="para">
				The source of the package is now available in a directory named after the source package and its version (for instance, <span
                class="emphasis"><em>samba-4.1.17+dfsg</em></span>); this is where we'll work on our local changes.
			</div><div
              class="para">
				The first thing to do is to change the package version number, so that the rebuilt packages can be distinguished from the original packages provided by Debian. Assuming the current version is <code
                class="literal">2:4.1.17+dfsg-2</code>, we can create version <code
                class="literal">2:4.1.17+dfsg-2falcot1</code>, which clearly indicates the origin of the package. This makes the package version number higher than the one provided by Debian, so that the package will easily install as an update to the original package. Such a change is best effected with the <code
                class="command">dch</code> command (<span
                class="emphasis"><em>Debian CHangelog</em></span>) from the <span
                class="pkg pkg">devscripts</span> package, with an command such as <code
                class="command">dch --local falcot</code>. This invokes a text editor (<code
                class="command">sensible-editor</code> — this should be your favorite editor if it is mentioned in the <code
                class="varname">VISUAL</code> or <code
                class="varname">EDITOR</code> environment variables, and the default editor otherwise) to allow documenting the differences brought by this rebuild. This editor shows us that <code
                class="command">dch</code> really did change the <code
                class="filename">debian/changelog</code> file.
			</div><div
              class="para">
				When a change in build options is required, the changes need to be made in <code
                class="filename">debian/rules</code>, which drives the steps in the package build process. In the simplest cases, the lines concerning the initial configuration (<code
                class="literal">./configure …</code>) or the actual build (<code
                class="literal">$(MAKE) …</code> or <code
                class="literal">make …</code>) are easy to spot. If these commands are not explicitly called, they are probably a side effect of another explicit command, in which case please refer to their documentation to learn more about how to change the default behavior. With packages using <code
                class="command">dh</code>, you might need to add an override for the <code
                class="command">dh_auto_configure</code> or <code
                class="command">dh_auto_build</code> commands (see their respective manual pages for explanations on how to achieve this).
			</div><div
              class="para">
				В зависимости от локальных изменений в пакетах может потребоваться также обновление файла <code
                class="filename">debian/control</code>, который содержит описание создаваемых пакетов. В частности, этот файл содержит строки <code
                class="literal">Build-Depends</code>, контролирующие список зависимостей, которые должны быть удовлетворены на этапе сборки пакета. Они часто ссылаются на версии пакетов, содержащиеся в дистрибутиве, откуда взят исходный код, но которые могут быть недоступны в дистрибутиве, используемом для пересборки. Не существует автоматизированного способа определить, является ли зависимость реальной, или же она указана только с целью гарантировать выполнение сборки исключительно с последней версией библиотеки, — это единственный доступный способ заставить <span
                class="emphasis"><em>autobuilder</em></span> использовать данную версию пакета во время сборки, из-за чего сопровождающие Debian часто используют строго версионированые сборочные зависимости.
			</div><div
              class="para">
				Если вы точно знаете, что эти сборочные зависимости слишком строги, не стесняйтесь ослабить их локально. Чтение файлов, документирующих стандартный способ сборки программного обеспечения — эти файлы часто называют <code
                class="filename">INSTALL</code> — поможет выяснить соответствующие зависимости. В идеале все зависимости должны быть удовлетворены из дистрибутива, используемого для пересборки; в противном случае начинается рекурсивный процесс, в результате которого пакеты, упомянутые в поле <code
                class="literal">Build-Depends</code>, должны быть бэкпортированы раньше целевого пакета. Некоторые пакеты могут не требовать бэкпортирования, и их можно установить как есть в процессе сборки (ярким примером является <span
                class="pkg pkg">debhelper</span>). Обратите внимание, что процесс бэкпортирования может стать лавинообразным, если вы не будете осторожны. Поэтому бэкпорты должны быть сведены к абсолютному минимуму, насколько это возможно.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>СОВЕТ</em></span> Установка <code
                          class="literal">Build-Depends</code></strong></p></div></div></div><a
                id="idm140254102610848"
                class="indexterm"></a><div
                class="para">
				<code
                  class="command">apt-get</code> allows installing all packages mentioned in the <code
                  class="literal">Build-Depends</code> fields of a source package available in a distribution mentioned in a <code
                  class="literal">deb-src</code> line of the <code
                  class="filename">/etc/apt/sources.list</code> file. This is a simple matter of running the <code
                  class="command">apt-get build-dep <em
                    class="replaceable">source-package</em></code> command.
			</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h3
                    class="title"><a
                      id="idm140254102606144"></a>15.1.3. Запуск пересборки</h3></div></div></div><div
              class="para">
				Когда все необходимые изменения внесены в исходный код, мы можем запустить создание собственно двоичного пакета (файл <code
                class="filename">.deb</code>). Весь процесс управляется командой <code
                class="command">dpkg-buildpackage</code>.
			</div><div
              class="example"><a
                id="idm140254102603760"></a><p
                class="title"><strong>Пример 15.1. Пересборка пакета</strong></p><div
                class="example-contents"><pre
                  class="screen">
<code
                    class="computeroutput">$ </code><strong
                    class="userinput"><code>dpkg-buildpackage -us -uc</code></strong>
[...]
</pre></div></div><div
              class="sidebar"><a
                id="sidebar.fakeroot"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ИНСТРУМЕНТ</em></span> <code
                          class="command">fakeroot</code></strong></p></div></div></div><div
                class="para">
				В сущности процесс создания пакета является простым сбором в архив набора существующих (или скомпилированных) файлов; большинство файлов архива будут иметь в конечном итоге владельца <span
                  class="emphasis"><em>root</em></span>. Тем не менее, сборка всего пакета от имени этого пользователя подразумевала бы повышенный риск; к счастью, этого можно избежать с помощью команды <code
                  class="command">fakeroot</code>. Этот инструмент может быть использован для запуска программы и создания у неё впечатления, что она запущена от имени <span
                  class="emphasis"><em>root</em></span> и создает файлы с произвольным владельцем и правами. Когда программа создает архив, который станет пакетом Debian, она хитрым образом внедряется в процесс создания архива, содержащего файлы, помеченные как принадлежащие произвольным владельцам, в том числе <span
                  class="emphasis"><em>root</em></span>. Это поведение настолько удобно, что <code
                  class="command">dpkg-buildpackage</code> использует <code
                  class="command">fakeroot</code> по умолчанию при сборке пакетов.
			</div><div
                class="para">
				Заметьте, что программу только заставляют «поверить» в то, что она работает под привилегированной учетной записью, но процесс на самом деле выполняется от имени пользователя, запустившего <code
                  class="command">fakeroot <em
                    class="replaceable">программа</em></code> (и права на создаваемые файлы в действительности принадлежат этому пользователю). Фактически программа ни в какой момент времени не получает привилегий суперпользователя, которыми могла бы злоупотреблять.
			</div></div><div
              class="para">
				Предыдущая команда может завершиться ошибкой, если поле <code
                class="literal">Build-Depends</code> не было обновлено или соответствующие пакеты не установлены. В таком случае можно исключить эту проверку, передав параметр <code
                class="literal">-d</code> команде <code
                class="command">dpkg-buildpackage</code>. Тем не менее, явное игнорирование зависимостей влечёт риск ошибки сборки на более позднем этапе. Хуже того, пакет может казаться собранным корректно, но не запуститься надлежащим образом: некоторые программы автоматически отключают часть своего функционала, если требующаяся библиотека была недоступна во время сборки.
			</div><div
              class="para">
				В большинстве случаев разработчики Debian используют программу более высокого уровня, такую как <code
                class="command">debuild</code>; она запускает <code
                class="command">dpkg-buildpackage</code> как обычно, но также добавляет вызов программы, выполняющей множество проверок пакета на соответствие политике Debian. Этот сценарий также очищает окружение, так что локальные переменные окружения не «загрязняют» сборку пакета. Команда <code
                class="command">debuild</code> — один из инструментов набора <span
                class="emphasis"><em>devscripts</em></span>, который берёт на себя часть работы по обеспечению постоянства и настройке, чтобы сделать задачу сопровождающего более легкой.
			</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>КРАТКИЙ ОБЗОР</em></span> <code
                          class="command">pbuilder</code></strong></p></div></div></div><a
                id="idm140254103072128"
                class="indexterm"></a><div
                class="para">
				Программа <code
                  class="command">pbuilder</code> (в пакете с таким же названием) позволяет собирать пакет Debian в <span
                  class="emphasis"><em>изолированном</em></span> окружении. Она сперва создает временный каталог, содержащий минимальную систему, требующуюся для сборки пакета (включая пакеты, упомянутые в поле <span
                  class="emphasis"><em>Build-Depends</em></span>). Этот каталог в дальнейшем используется в качестве корневого каталога (<code
                  class="filename">/</code>) командой <code
                  class="command">chroot</code> для сборки пакета.
			</div><div
                class="para">
				Этот инструмент позволяет выполнять процесс сборки в окружении, не затрагиваемом пользовательскими манипуляциями. Он также позволяет быстро обнаружить недостающие сборочные зависимости (так как сборка завершится неудачно, если соответствующие зависимости не документированы). И наконец, он позволяет собрать пакет для версии Debian, отличной от установленной на данной машине: для обычной работы может использоваться <span
                  class="distribution distribution">Stable</span>, а в <code
                  class="command">pbuilder</code>, запущенном на том же оборудовании, для сборки пакетов может использоваться <span
                  class="distribution distribution">Unstable</span>.
			</div></div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.dealing-with-compromised-machine.html"><strong>Пред.</strong>14.7. Dealing with a Compromised Machine</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.building-first-package.html"><strong>След.</strong>15.2. Сборка вашего первого пакета</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/debian-packaging.html">ar-MA</a></li><li><a
              href="../da-DK/debian-packaging.html">da-DK</a></li><li><a
              href="../de-DE/debian-packaging.html">de-DE</a></li><li><a
              href="../el-GR/debian-packaging.html">el-GR</a></li><li><a
              href="../en-US/debian-packaging.html">en-US</a></li><li><a
              href="../es-ES/debian-packaging.html">es-ES</a></li><li><a
              href="../fa-IR/debian-packaging.html">fa-IR</a></li><li><a
              href="../fr-FR/debian-packaging.html">fr-FR</a></li><li><a
              href="../hr-HR/debian-packaging.html">hr-HR</a></li><li><a
              href="../id-ID/debian-packaging.html">id-ID</a></li><li><a
              href="../it-IT/debian-packaging.html">it-IT</a></li><li><a
              href="../ja-JP/debian-packaging.html">ja-JP</a></li><li><a
              href="../pl-PL/debian-packaging.html">pl-PL</a></li><li><a
              href="../pt-BR/debian-packaging.html">pt-BR</a></li><li><a
              href="../ro-RO/debian-packaging.html">ro-RO</a></li><li><a
              href="../ru-RU/debian-packaging.html">ru-RU</a></li><li><a
              href="../tr-TR/debian-packaging.html">tr-TR</a></li><li><a
              href="../zh-CN/debian-packaging.html">zh-CN</a></li></ul></div></body></html>
