<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.4. Работа с пакетами при помощи dpkg</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Двоичный пакет, Пакет исходных кодов, dpkg, зависимости, конфликт" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="packaging-system.html"
        title="Глава 5. Пакетная система: Инструменты и основные принципы" /><link
        rel="prev"
        href="sect.source-package-structure.html"
        title="5.3. Структура исходного пакета" /><link
        rel="next"
        href="sect.coexistence-with-other-packaging-systems.html"
        title="5.5. Сосуществование с другими пакетными системами" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ru-RU/sect.manipulating-packages-with-dpkg.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.manipulating-packages-with-dpkg"></a>5.4. Работа с пакетами при помощи <code
                  class="command">dpkg</code></h2></div></div></div><a
          id="idm140247822594528"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">dpkg</code> is the base command for handling Debian packages on the system. If you have <code
            class="filename">.deb</code> packages, it is <code
            class="command">dpkg</code> that allows installation or analysis of their contents. But this program only has a partial view of the Debian universe: it knows what is installed on the system, and whatever it is given on the command line, but knows nothing of the other available packages. As such, it will fail if a dependency is not met. Tools such as <code
            class="command">apt</code>, on the contrary, will create a list of dependencies to install everything as automatically as possible.
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>NOTE</em></span> <code
                      class="command">dpkg</code> or <code
                      class="command">apt</code>?</strong></p></div></div></div><div
            class="para">
			<code
              class="command">dpkg</code> should be seen as a system tool (backend), and <code
              class="command">apt</code> as a tool closer to the user, which overcomes the limitations of the former. These tools work together, each one with its particularities, suited to specific tasks.
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140247822586832"></a>5.4.1. Установка пакетов</h3></div></div></div><a
            id="idm140247822586064"
            class="indexterm"></a><a
            id="idm140247822584656"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">dpkg</code> — это, прежде всего, инструмент для установки уже доступных пакетов Debian (поскольку он ничего не загружает). Чтобы установить пакет, используется опция <code
              class="literal">-i</code> или <code
              class="literal">--install</code>.
			</div><div
            class="example"><a
              id="idm140247822581040"></a><p
              class="title"><strong>Пример 5.2. Установка пакета при помощи <code
                  class="command">dpkg</code></strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -i man-db_2.6.2-1_amd64.deb</code></strong>
<code
                  class="computeroutput">(Чтение базы данных … на данный момент установлено 96357 файлов и каталогов.)
Подготовка к замене пакета man-db 2.6.1-3 (используется файл man-db_2.6.2-1_amd64.deb) …
Распаковывается замена для пакета man-db …
Настраивается пакет man-db (2.6.2-1) …
Building database of manual pages ... </code></pre></div></div><div
            class="para">
				Мы можем видеть каждый этап, выполняемый <code
              class="command">dpkg</code>, поэтому мы знаем, в каком месте могла произойти какая-либо ошибка. Установку также можно выполнить в два этапа: сперва распаковка, затем конфигурация. Благодаря этому <code
              class="command">apt-get</code> делает меньше обращений к <code
              class="command">dpkg</code> (каждый такой запрос является дорогостоящей операцией из-за необходимости загрузки в память базы данных, включая весь список уже установленных файлов).
			</div><div
            class="example"><a
              id="idm140247820469152"></a><p
              class="title"><strong>Пример 5.3. Раздельная распаковка и настройка</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg --unpack man-db_2.6.2-1_amd64.deb</code></strong>
<code
                  class="computeroutput">(Чтение базы данных … на данный момент установлено 96357 файлов и каталогов.)
Подготовка к замене пакета man-db 2.6.2-1 (используется файл man-db_2.6.2-1_amd64.deb) …
Распаковывается замена для пакета man-db …
# </code><strong
                  class="userinput"><code> dpkg --configure man-db</code></strong>
<code
                  class="computeroutput">Настраивается пакет man-db (2.6.2-1) …
Building database of manual pages ...</code></pre></div></div><a
            id="idm140247820465088"
            class="indexterm"></a><a
            id="idm140247820463648"
            class="indexterm"></a><div
            class="para">
				Иногда <code
              class="command">dpkg</code> по той или иной причине не может установить пакет и возвращает ошибку; если пользователь даёт указание проигнорировать эту ошибку, будет выдано лишь предупреждение; для этого существуют различные опции <code
              class="literal">--force-*</code>. Команда <code
              class="command">dpkg --force-help</code>, или документация этой команды, выдаст полный список таких опций. Самой частой ошибкой, с которой вам придётся рано или поздно столкнуться, является конфликт файлов. Когда пакет содержит файл, который уже установлен другим пакетом, <code
              class="command">dpkg</code> откажется устанавливать его, и мы получим такое сообщение:
			</div><pre
            class="screen">
<code
              class="computeroutput">Распаковывается пакет libgdm (из файла .../libgdm_3.8.3-2_amd64.deb) …
dpkg: ошибка при обработке параметра /var/cache/apt/archives/libgdm_3.8.3-2_amd64.deb (--unpack):
 попытка перезаписать «/usr/bin/gdmflexiserver», который уже имеется в пакете gdm3 3.4.1-9</code></pre><div
            class="para">
				В этом случае, если вы считаете, что замена этого файла не представляет существенной опасности для стабильности вашей системы (зачастую это именно так), вы можете использовать опцию <code
              class="literal">--force-overwrite</code>, которая сообщит <code
              class="command">dpkg</code> о необходимости проигнорировать эту ошибку и перезаписать файл.
			</div><div
            class="para">
				Хотя есть много опций <code
              class="literal">--force-*</code>, только <code
              class="literal">--force-overwrite</code> рекомендуется для регулярного использования. Остальные предназначены только для исключительных случаев, и лучше не трогать их, пока это возможно, чтобы соблюдать правила, заложенные при создании пакета. Не забывайте, что эти правила являются гарантией целостности и стабильности системы.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ВНИМАНИЕ</em></span> Эффективное использование <code
                        class="literal">--force-*</code></strong></p></div></div></div><a
              id="idm140247820452640"
              class="indexterm"></a><div
              class="para">
				Если вы не будете осторожны, использование опции <code
                class="literal">--force-*</code> может привести к тому, что команды APT перестанут работать. Некоторые из этих опций позволяют установить пакет с неудовлетворёнными зависимостями или при наличии конфликта. В результате согласованность системы с точки зрения зависимостей нарушается, и команды APT откажутся выполнять какие-либо действия кроме тех, которые вернут систему в согласованное состояние (это обычно сводится к установке отсутствующей зависимости или удалению проблемного пакета). Вот пример сообщения, сигнализирующего о такой ошибке, которое получено после установки новой версии <span
                class="pkg pkg">rdesktop</span> с игнорированием зависимости от более новой версии <span
                class="pkg pkg">libc6</span>:
			</div><pre
              class="programlisting"># apt full-upgrade
[...]
You might want to run 'apt-get -f install' to correct these.
The following packages have unmet dependencies:
  rdesktop: Depends: libc6 (&gt;= 2.5) but 2.3.6.ds1-13etch7 is installed
E: Unmet dependencies. Try using -f.
</pre><div
              class="para">
				A courageous administrator who is certain of the correctness of their analysis may choose to ignore a dependency or conflict and use the corresponding <code
                class="literal">--force-*</code> option. In this case, if they want to be able to continue to use <code
                class="command">apt</code> or <code
                class="command">aptitude</code>, they must edit <code
                class="filename">/var/lib/dpkg/status</code> to delete/modify the dependency, or conflict, that they chose to override.
			</div><div
              class="para">
				Редакрирование данного файла — это грязный хак, и не стоит прибегать к нему, кроме как в самых крайних случаях. Зачастую лучшим решением является пересборка пакета, вызывающего проблему (см. <a
                class="xref"
                href="debian-packaging.html#sect.rebuilding-package">Раздел 15.1, «Пересборка пакета из его исходного кода»</a>) или использование его новой версии (вероятно исправленной) из такого репозитория как <code
                class="literal">stable-backports</code> (см. <a
                class="xref"
                href="apt.html#sect.backports">Раздел 6.1.2.4, «Stable Backports»</a>).
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140247820442048"></a>5.4.2. Удаление пакета</h3></div></div></div><a
            id="idm140247820441280"
            class="indexterm"></a><a
            id="idm140247820440352"
            class="indexterm"></a><a
            id="idm140247820439424"
            class="indexterm"></a><a
            id="idm140247820437984"
            class="indexterm"></a><div
            class="para">
				Запуск <code
              class="command">dpkg</code> с опцией <code
              class="literal">-r</code> или <code
              class="literal">--remove</code>, за которой следует имя пакета, приведет к удалению этого пакета. Это удаление, однако, не полное: все конфигурационные файлы, сценарии сопровождающего, файлы журналов (системные журналы) и другие пользовательские данные, используемые этим пакетом, останутся. Таким путём легко избавиться от программы, деинсталлировав её, но при этом сохраняется возможность установить её ещё раз с той же конфигурацией. Для полного удаления всего, связанного с пакетом, используется опция <code
              class="literal">-P</code> или <code
              class="literal">--purge</code>, сопровождающаяся именем пакета.
			</div><div
            class="example"><a
              id="idm140247820432800"></a><p
              class="title"><strong>Пример 5.4. Полное удаление пакета <span
                  class="emphasis"><em>debian-cd</em></span></strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -r debian-cd</code></strong>
<code
                  class="computeroutput">(Чтение базы данных … на данный момент установлено 97747 файлов и каталогов.)
Удаляется пакет debian-cd …
# </code><strong
                  class="userinput"><code>dpkg -P debian-cd</code></strong>
<code
                  class="computeroutput">(Чтение базы данных … на данный момент установлен 97401 файл и каталог.)
Удаляется пакет debian-cd …
Вычищаются файлы настройки пакета debian-cd …</code></pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140247820428752"></a>5.4.3. Запросы к базе данных <code
                    class="command">dpkg</code> и анализ файлов <code
                    class="filename">.deb</code></h3></div></div></div><a
            id="idm140247820427216"
            class="indexterm"></a><a
            id="idm140247820425776"
            class="indexterm"></a><a
            id="idm140247820424368"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>К ОСНОВАМ</em></span> Синтаксис опций команд</strong></p></div></div></div><div
              class="para">
				Для большинста опций существуют «длинные» (одно или несколько слов, перед которыми ставится двойной дефис) и «короткие» варианты (одна буква, часто первая буква «длинного» варианта, после одного дефиса). Это соглашение так распространено, что уже является стандартом POSIX.
			</div></div><div
            class="para">
				Прежде чем завершить этот раздел, рассмотрим опции <code
              class="command">dpkg</code> для запросов к внутренней базе данных для получения различной информации. При этом сперва будут указываться длинные, а затем соответствующие короткие опции (которые, разумеется, принимают те же самые аргументы). Так, <code
              class="literal">--listfiles <em
                class="replaceable">пакет</em></code> (или <code
              class="literal">-L</code>) выводит список файлов, установленых пакетом; <code
              class="literal">--search <em
                class="replaceable">файл</em></code> (или <code
              class="literal">-S</code>) ищет пакет, к которому относится этот файл; <code
              class="literal">--status <em
                class="replaceable">пакет</em></code> (or <code
              class="literal">-s</code>) выводит информацию о том или ином установленном пакете; <code
              class="literal">--list</code> (или <code
              class="literal">-l</code>) показывает список пакетов, известных системе, и их статус; <code
              class="literal">--contents <em
                class="replaceable">file.deb</em></code> (или <code
              class="literal">-c</code>) показывает список файлов в этом пакете; <code
              class="literal">--info<em
                class="replaceable"> file.deb </em></code> (или <code
              class="literal">-I</code>) показывает информацию о пакете Debian.
			</div><div
            class="example"><a
              id="idm140247820411808"></a><p
              class="title"><strong>Пример 5.5. Получение информации с помощью <code
                  class="command">dpkg</code></strong></p><div
              class="example-contents"><pre
                class="screen scale"
                width="80">
<code
                  class="computeroutput">$ </code><strong
                  class="userinput"><code>dpkg -L base-passwd</code></strong>
<code
                  class="computeroutput">/.
/usr
/usr/sbin
/usr/sbin/update-passwd
/usr/share
/usr/share/man
/usr/share/man/ru
/usr/share/man/ru/man8
/usr/share/man/ru/man8/update-passwd.8.gz
/usr/share/man/pl
/usr/share/man/pl/man8
/usr/share/man/pl/man8/update-passwd.8.gz
/usr/share/man/man8
/usr/share/man/man8/update-passwd.8.gz
/usr/share/man/fr
/usr/share/man/fr/man8
/usr/share/man/fr/man8/update-passwd.8.gz
/usr/share/doc-base
/usr/share/doc-base/users-and-groups
/usr/share/base-passwd
/usr/share/base-passwd/passwd.master
/usr/share/base-passwd/group.master
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/base-passwd
/usr/share/doc
/usr/share/doc/base-passwd
/usr/share/doc/base-passwd/copyright
/usr/share/doc/base-passwd/users-and-groups.html
/usr/share/doc/base-passwd/changelog.gz
/usr/share/doc/base-passwd/users-and-groups.txt.gz
/usr/share/doc/base-passwd/README
$ </code><strong
                  class="userinput"><code>dpkg -S /bin/date</code></strong>
<code
                  class="computeroutput">coreutils: /bin/date
$ </code><strong
                  class="userinput"><code>dpkg -s coreutils</code></strong>
<code
                  class="computeroutput">Package: coreutils
Essential: yes
Status: install ok installed
Priority: required
Section: utils
Installed-Size: 13822
Maintainer: Michael Stone &lt;mstone@debian.org&gt;
Architecture: amd64
Multi-Arch: foreign
Version: 8.13-3.5
Replaces: mktemp, timeout
Depends: dpkg (&gt;= 1.15.4) | install-info
Pre-Depends: libacl1 (&gt;= 2.2.51-8), libattr1 (&gt;= 1:2.4.46-8), libc6 (&gt;= 2.7), libselinux1 (&gt;= 1.32)
Conflicts: timeout
Description: GNU core utilities
 This package contains the basic file, shell and text manipulation
 utilities which are expected to exist on every operating system.
 .
 Specifically, this package includes:
 arch base64 basename cat chcon chgrp chmod chown chroot cksum comm cp
 csplit cut date dd df dir dircolors dirname du echo env expand expr
 factor false flock fmt fold groups head hostid id install join link ln
 logname ls md5sum mkdir mkfifo mknod mktemp mv nice nl nohup nproc od
 paste pathchk pinky pr printenv printf ptx pwd readlink rm rmdir runcon
 sha*sum seq shred sleep sort split stat stty sum sync tac tail tee test
 timeout touch tr true truncate tsort tty uname unexpand uniq unlink
 users vdir wc who whoami yes
Homepage: http://gnu.org/software/coreutils
$ </code><strong
                  class="userinput"><code>dpkg -l 'b*'</code></strong>
<code
                  class="computeroutput">Желаемый=неизвестно[u]/установить[i]/удалить[r]/вычистить[p]/зафиксировать[h]
| Состояние=не[n]/установлен[i]/настроен[c]/распакован[U]/частично настроен[F]/
            частично установлен[H]/trig-aWait/Trig-pend
|/ Ошибка?=(нет)/требуется переустановка[R] (верхний регистр
в полях состояния и ошибки указывает на ненормальную ситуацию)
||/ Имя          Версия         Архитектура    Описание
+++-============-==============-==============-================================
un  backupninja  &lt;нет&gt;                        (описание недоступно)
un  base         &lt;нет&gt;                        (описание недоступно)
un  base-config  &lt;нет&gt;                        (описание недоступно)
ii  base-files   7.1            amd64          Debian base system miscellaneous
ii  base-passwd  3.5.26         amd64          Debian base system master passwo
[...]
$ </code><strong
                  class="userinput"><code>dpkg -c /var/cache/apt/archives/gnupg_1.4.12-7_amd64.deb</code></strong>
<code
                  class="computeroutput">drwxr-xr-x root/root         0 2013-01-02 19:28 ./
drwxr-xr-x root/root         0 2013-01-02 19:28 ./usr/
drwxr-xr-x root/root         0 2013-01-02 19:28 ./usr/share/
drwxr-xr-x root/root         0 2013-01-02 19:28 ./usr/share/doc/
drwxr-xr-x root/root         0 2013-01-02 19:28 ./usr/share/doc/gnupg/
-rw-r--r-- root/root      3258 2012-01-20 10:51 ./usr/share/doc/gnupg/TODO
-rw-r--r-- root/root       308 2011-12-02 18:34 ./usr/share/doc/gnupg/FAQ
-rw-r--r-- root/root      3543 2012-02-20 18:41 ./usr/share/doc/gnupg/Upgrading_From_PGP.txt
-rw-r--r-- root/root       690 2012-02-20 18:41 ./usr/share/doc/gnupg/README.Debian
-rw-r--r-- root/root      1418 2012-02-20 18:41 ./usr/share/doc/gnupg/TODO.Debian
[...]
$ </code><strong
                  class="userinput"><code>dpkg -I /var/cache/apt/archives/gnupg_1.4.12-7_amd64.deb</code></strong>
<code
                  class="computeroutput"> новый пакет debian, версия 2.0.
 размер 1952176 байт(а): управляющий архив длиной 3312 байт(а).
    1449 байт(а),    30 строк      control              
    4521 байт(а),    65 строк      md5sums              
     479 байт(а),    13 строк   *  postinst             #!/bin/sh
     473 байт(а),    13 строк   *  preinst              #!/bin/sh
 Package: gnupg
 Version: 1.4.12-7
 Architecture: amd64
 Maintainer: Debian GnuPG-Maintainers &lt;pkg-gnupg-maint@lists.alioth.debian.org&gt;
 Installed-Size: 4627
 Depends: libbz2-1.0, libc6 (&gt;= 2.4), libreadline6 (&gt;= 6.0), libusb-0.1-4 (&gt;= 2:0.1.12), zlib1g (&gt;= 1:1.1.4), dpkg (&gt;= 1.15.4) | install-info, gpgv
 Recommends: libldap-2.4-2 (&gt;= 2.4.7), gnupg-curl
 Suggests: gnupg-doc, xloadimage | imagemagick | eog, libpcsclite1
 Section: utils
 Priority: important
 Multi-Arch: foreign
 Homepage: http://www.gnupg.org
 Description: GNU privacy guard - a free PGP replacement
  GnuPG is GNU's tool for secure communication and data storage.
  It can be used to encrypt data and to create digital signatures.
  It includes an advanced key management facility and is compliant
  with the proposed OpenPGP Internet standard as described in RFC 4880.
[...]</code></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Сравнение версий</strong></p></div></div></div><a
              id="idm140247820397936"
              class="indexterm"></a><a
              id="idm140247820397008"
              class="indexterm"></a><div
              class="para">
				Так как <code
                class="command">dpkg</code> является программой для работы с пакетами Debian, она, помимо всего прочего, содержит эталонную реализацию логики сравнения номеров версий. Поэтому у неё есть опция <code
                class="literal">--compare-versions</code>, используемая внешними программами (главным образом — сценариями настройки, запускаемыми самой <code
                class="command">dpkg</code>). Для этой опции требуются три параметра: номер версии, оператор сравнения и второй номер версии. Допустимые операторы сравнения — <code
                class="literal">lt</code> (строго меньше), <code
                class="literal">le</code> (меньше или равна), <code
                class="literal">eq</code> (равна), <code
                class="literal">ne</code> (не равна), <code
                class="literal">ge</code> (больше или равна), и <code
                class="literal">gt</code> (строго больше). Если сравнение верно, <code
                class="command">dpkg</code> возвращает 0 (успех), если нет, то ненулевое значение (признак ошибки).
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 gt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 lt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1</code></pre><div
              class="para">
				Обратите внимание на неожиданный сбой последнего сравнения: для <code
                class="command">dpkg</code> буквы <code
                class="literal">pre</code>, обозначающие, как правило, предварительный выпуск, не имеет никакого особого значения, и буквенные символы сравниваются таким же образом, как и числа (a &lt; b &lt; c ...), в алфавитном порядке. Именно поэтому <code
                class="command">dpkg</code> считает, что «<code
                class="literal">0pre3</code>» больше, чем «<code
                class="literal">0</code>». При необходимости указать в номере версии, что она относится к предварительному выпуску, используется символ тильды «<code
                class="literal">~</code>»:
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0~pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0</code></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140247820377904"></a>5.4.4. Файл журнала <code
                    class="command">dpkg</code></h3></div></div></div><div
            class="para">
				<code
              class="command">dpkg</code> сохраняет журнал всех своих действий в <code
              class="filename">/var/log/dpkg.log</code>. Этот журнал чрезвычайно подробный: в нём задокументированы все этапы обработки пакетов <code
              class="command">dpkg</code>. Этот журнал помогает не только отследить поведение dpkg, но и сохранить историю изменений в системе: можно найти точный момент, когда каждый пакет был установлен или обновлён, и эта информация может быть чрезвычайно полезной при выяснении причин изменения поведения системы в целом. Кроме того, ведётся запись информации обо всех версиях, и её легко сверить с <code
              class="filename">changelog.Debian.gz</code> из соответствующего пакета или с отчётами об ошибках онлайн.
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.multi-arch"></a>5.4.5. Поддержка мультиархитектуры</h3></div></div></div><a
            id="idm140247820372272"
            class="indexterm"></a><a
            id="idm140247820371344"
            class="indexterm"></a><div
            class="para">
				Все пакеты Debian имеют поле <code
              class="literal">Architecture</code> в своих метаданных. Это поле может содержать либо значение «<code
              class="literal">all</code>» (для пакетов, которые не зависят от архитектуры), либо название конкретной архитектуры, для которой пакет предназначен (например «amd64», «armhf», …). В последнем случае <code
              class="command">dpkg</code> по умолчанию допустит установку пакета только в том случае, если его архитектура соответствует архитектуре системы, возвращаемой <code
              class="command">dpkg --print-architecture</code>.
			</div><div
            class="para">
				Это ограничение гарантирует, что в системе не окажется двоичных файлов, скомпилированных для неправильной архитектуры. Всё было бы прекрасно, но на (некоторых) компьютерах можно запускать двоичные файлы для разных архитектур, нативно (к примеру, на системах «amd64» работают двоичные файлы для «i386») или через эмуляторы.
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140247820365936"></a>5.4.5.1. Включение мультиархитектуры</h4></div></div></div><div
              class="para">
					<code
                class="command">dpkg</code>'s multi-arch support allows users to define “foreign architectures” that can be installed on the current system. This is simply done with <code
                class="command">dpkg --add-architecture</code> like in the example below. There is a corresponding <code
                class="command">dpkg --remove-architecture</code> to drop support of a foreign architecture, but it can only be used when no packages of this architecture remain.
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-architecture</code></strong>
<code
                class="computeroutput">amd64
# </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -i gcc-4.7-base_4.7.2-5_armhf.deb</code></strong>
<code
                class="computeroutput">dpkg: ошибка при обработке параметра gcc-4.7-base_4.7.2-5_armhf.deb (--install):
 архитектура пакета (armhf) не соответствует архитектуре системы (amd64)
При обработке следующих пакетов произошли ошибки:
 gcc-4.7-base_4.7.2-5_armhf.deb
# </code><strong
                class="userinput"><code>dpkg --add-architecture armhf</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --add-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf
armel
# </code><strong
                class="userinput"><code>dpkg -i gcc-4.7-base_4.7.2-5_armhf.deb</code></strong>
<code
                class="computeroutput">Выбор ранее не выбранного пакета gcc-4.7-base:armhf.
(Чтение базы данных … на данный момент установлено 97399 файлов и каталогов.)
Распаковывается пакет gcc-4.7-base:armhf (из файла gcc-4.7-base_4.7.2-5_armhf.deb) ...
Настраивается пакет gcc-4.7-base:armhf (4.7.2-5) …
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armhf</code></strong>
<code
                class="computeroutput">dpkg: ошибка: невозможно удалить архитектуру «armhf», которая в данный момент используется в базе данных
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ЗАМЕТКА</em></span> Поддержка мультиархитектуры в APT</strong></p></div></div></div><div
                class="para">
					APT автоматически определит, если dpkg будет настроен на поддержку чужеродных архитектур, и начнёт загрузку соответствующих файлов <code
                  class="filename">Packages</code> в процессе обновления.
				</div><div
                class="para">
					Foreign packages can then be installed with <code
                  class="command">apt install <em
                    class="replaceable">package</em>:<em
                    class="replaceable">architecture</em></code>.
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>НА ПРАКТИКЕ</em></span> Использование собственнических двоичных файлов i386 в системах amd64</strong></p></div></div></div><div
                class="para">
					Есть несколько случаев, когда может пригодиться мультиархитектура, но самым распространённымным из них является обеспечение возможности запуска 32-битных файллов (i386) на 64-битных системах (amd64), в частности потому что некоторые популярные собственнические приложения (вроде Skype) доступны только в виде 32-разрядных версий.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140247820346896"></a>5.4.5.2. Изменения, связанные с мультиархитектурой</h4></div></div></div><div
              class="para">
					To make multi-arch actually useful and usable, libraries had to be repackaged and moved to an architecture-specific directory so that multiple copies (targeting different architectures) can be installed alongside. Such updated packages contain the “<code
                class="literal">Multi-Arch: same</code>” header field to tell the packaging system that the various architectures of the package can be safely co-installed (and that those packages can only satisfy dependencies of packages of the same architecture). Since multi-arch made its debut in Debian <span
                class="distribution distribution">Wheezy</span>, not all libraries have been converted yet.
				</div><pre
              class="screen">
$ <strong
                class="userinput"><code>dpkg -s gcc-4.7-base</code></strong>
dpkg-query: ошибка: --status  требует корректное имя пакета, «gcc-4.7-base» таковым не является: неоднозначное имя пакета «gcc-4.7-base» с более чем одним установленным экземпляром

Используйте параметр --help для вывода справки по запросам пакетов.
$ <strong
                class="userinput"><code>dpkg -s gcc-4.7-base:amd64 gcc-4.7-base:armhf | grep ^Multi</code></strong>
Multi-Arch: same
Multi-Arch: same
$ <strong
                class="userinput"><code>dpkg -L libgcc1:amd64 |grep .so</code></strong>
/lib/x86_64-linux-gnu/libgcc_s.so.1
$ <strong
                class="userinput"><code>dpkg -S /usr/share/doc/gcc-4.7-base/copyright</code></strong>
gcc-4.7-base:armhf, gcc-4.7-base:amd64: /usr/share/doc/gcc-4.7-base/copyright
</pre><div
              class="para">
					Стоит отметить, что для пакетов с полем <code
                class="literal">Multi-Arch: same</code> следует указывать имена с названием архитектуры, чтобы их можно было однозначно идентифицировать. Они также могут иметь общие файлы с другими экземплярами того же пакета; <code
                class="command">dpkg</code> в этом случае гарантирует, что все пакеты имеют бит-в-бит идентичные общие файлы. Все экземпляры пакета должны быть одной и той же версии, так что и обновляться они должны вместе.
				</div><div
              class="para">
					Поддержка мультиархитектуры также привносит некоторые интересные особенности в механизм обработки зависимосей. Для удовлетворения зависимости требуется либо пакет, помеченный «<code
                class="literal">Multi-Arch: foreign</code>», или пакет с такой же архитектурой (при разрешении зависимости архитектуро-независимые пакеты считаются имеющими ту же архитектуру, что и система). Зависимость может также быть ослаблена, чтобы позволить пакету любой архитектуры удовлетворять её, с помощью синтаксиса <code
                class="literal"><em
                  class="replaceable">пакет</em>:any</code>, но но чужеродные пакеты могут удовлетворять такую зависимость, только если они помечены «<code
                class="literal">Multi-Arch: allowed</code>».
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>Пред.</strong>5.3. Структура исходного пакета</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>След.</strong>5.5. Сосуществование с другими пакетными системами</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.manipulating-packages-with-dpkg.html">ar-MA</a></li><li><a
              href="../da-DK/sect.manipulating-packages-with-dpkg.html">da-DK</a></li><li><a
              href="../de-DE/sect.manipulating-packages-with-dpkg.html">de-DE</a></li><li><a
              href="../el-GR/sect.manipulating-packages-with-dpkg.html">el-GR</a></li><li><a
              href="../en-US/sect.manipulating-packages-with-dpkg.html">en-US</a></li><li><a
              href="../es-ES/sect.manipulating-packages-with-dpkg.html">es-ES</a></li><li><a
              href="../fa-IR/sect.manipulating-packages-with-dpkg.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.manipulating-packages-with-dpkg.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.manipulating-packages-with-dpkg.html">hr-HR</a></li><li><a
              href="../id-ID/sect.manipulating-packages-with-dpkg.html">id-ID</a></li><li><a
              href="../it-IT/sect.manipulating-packages-with-dpkg.html">it-IT</a></li><li><a
              href="../ja-JP/sect.manipulating-packages-with-dpkg.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.manipulating-packages-with-dpkg.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.manipulating-packages-with-dpkg.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.manipulating-packages-with-dpkg.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.manipulating-packages-with-dpkg.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.manipulating-packages-with-dpkg.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.manipulating-packages-with-dpkg.html">zh-CN</a></li></ul></div></body></html>
