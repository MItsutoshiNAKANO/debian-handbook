<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.2. Метаинформация пакета</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ru-RU-1.0-1" /><meta
        name="keywords"
        content="Двоичный пакет, Пакет исходных кодов, dpkg, зависимости, конфликт" /><link
        rel="home"
        href="index.html"
        title="Настольная книга администратора Debian" /><link
        rel="up"
        href="packaging-system.html"
        title="Глава 5. Пакетная система: Инструменты и основные принципы" /><link
        rel="prev"
        href="packaging-system.html"
        title="Глава 5. Пакетная система: Инструменты и основные принципы" /><link
        rel="next"
        href="sect.source-package-structure.html"
        title="5.3. Структура исходного пакета" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ru-RU/sect.package-meta-information.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>Пред.</strong></a></li><li
          class="home">Настольная книга администратора Debian</li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>След.</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.package-meta-information"></a>5.2. Метаинформация пакета</h2></div></div></div><a
          id="idm140254107926016"
          class="indexterm"></a><a
          id="idm140254107925088"
          class="indexterm"></a><div
          class="para">
			The Debian package is not only an archive of files intended for installation. It is part of a larger whole, and it describes its relationship with other Debian packages (dependencies, conflicts, suggestions). It also provides scripts that enable the execution of commands at different stages in the package's lifecycle (installation, removal, upgrades). These data are used by the package management tools but are not part of the packaged software; they are, within the package, what is called its “meta-information” (information about other information).
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.control"></a>5.2.1. Описание: файл <code
                    class="filename">control</code></h3></div></div></div><a
            id="idm140254106703264"
            class="indexterm"></a><a
            id="idm140254106702336"
            class="indexterm"></a><a
            id="idm140254106700928"
            class="indexterm"></a><div
            class="para">
				This file uses a structure similar to email headers (as defined by RFC 2822). For example, for <span
              class="pkg pkg">apt</span>, the <code
              class="filename">control</code> file looks like the following:
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>apt-cache show apt</code></strong>
<code
              class="computeroutput">Package: apt
Version: 1.0.9.6
Installed-Size: 3788
Maintainer: APT Development Team &lt;deity@lists.debian.org&gt;
Architecture: amd64
Replaces: manpages-it (&lt;&lt; 2.80-4~), manpages-pl (&lt;&lt; 20060617-3~), openjdk-6-jdk (&lt;&lt; 6b24-1.11-0ubuntu1~), sun-java5-jdk (&gt;&gt; 0), sun-java6-jdk (&gt;&gt; 0)
Depends: libapt-pkg4.12 (&gt;= 1.0.9.6), libc6 (&gt;= 2.15), libgcc1 (&gt;= 1:4.1.1), libstdc++6 (&gt;= 4.9), debian-archive-keyring, gnupg
Suggests: aptitude | synaptic | wajig, dpkg-dev (&gt;= 1.17.2), apt-doc, python-apt
Conflicts: python-apt (&lt;&lt; 0.7.93.2~)
Breaks: manpages-it (&lt;&lt; 2.80-4~), manpages-pl (&lt;&lt; 20060617-3~), openjdk-6-jdk (&lt;&lt; 6b24-1.11-0ubuntu1~), sun-java5-jdk (&gt;&gt; 0), sun-java6-jdk (&gt;&gt; 0)
Description-en: commandline package manager
 This package provides commandline tools for searching and
 managing as well as querying information about packages
 as a low-level access to all features of the libapt-pkg library.
 .
 These include:
  * apt-get for retrieval of packages and information about them
    from authenticated sources and for installation, upgrade and
    removal of packages together with their dependencies
  * apt-cache for querying available information about installed
    as well as installable packages
  * apt-cdrom to use removable media as a source for packages
  * apt-config as an interface to the configuration settings
  * apt-key as an interface to manage authentication keys
Description-md5: 9fb97a88cb7383934ef963352b53b4a7
Tag: admin::package-management, devel::lang:ruby, hardware::storage,
 hardware::storage:cd, implemented-in::c++, implemented-in::perl,
 implemented-in::ruby, interface::commandline, network::client,
 protocol::ftp, protocol::http, protocol::ipv6, role::program,
 role::shared-lib, scope::application, scope::utility, sound::player,
 suite::debian, use::downloading, use::organizing, use::searching,
 works-with::audio, works-with::software:package, works-with::text
Section: admin
Priority: important
Filename: pool/main/a/apt/apt_1.0.9.6_amd64.deb
Size: 1107560
MD5sum: a325ccb14e69fef2c50da54e035a4df4
SHA1: 635d09fcb600ec12810e3136d51e696bcfa636a6
SHA256: 371a559ce741394b59dbc6460470a9399be5245356a9183bbeea0f89ecaabb03</code></pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>К ОСНОВАМ</em></span> RFC — стандарты Интернета</strong></p></div></div></div><a
              id="idm140254106693728"
              class="indexterm"></a><a
              id="idm140254106692768"
              class="indexterm"></a><div
              class="para">
				RFC — это аббревиатура, означающая «Request For Comments» или, по-русски, «Рабочее предложение». RFC представляет собой технический документ, в котором описано, чему предстоит стать стандартом Интернета. Перед окончательным утверждением и прекращением внесения изменений стандарты публикуются для общественного рассмотрения (отсюда их название). IETF (Internet Engineering Task Force) принимает решение о статусе этих документов (предлагаемый стандарт, проект стандарта или стандарт).
			</div><div
              class="para">
				RFC 2026 определяет процесс стандартизации интернет-протоколов. <div
                class="url">→ <a
                  href="http://www.faqs.org/rfcs/rfc2026.html">http://www.faqs.org/rfcs/rfc2026.html</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254106689120"></a>5.2.1.1. Зависимости: поле <code
                      class="literal">Depends</code></h4></div></div></div><a
              id="idm140254107870832"
              class="indexterm"></a><a
              id="idm140254107869872"
              class="indexterm"></a><a
              id="idm140254107868624"
              class="indexterm"></a><div
              class="para">
					The dependencies are defined in the <code
                class="literal">Depends</code> field in the package header. This is a list of conditions to be met for the package to work correctly — this information is used by tools such as <code
                class="command">apt</code> in order to install the required libraries, in appropriate versions fulfilling the dependencies of the package to be installed. For each dependency, it is possible to restrict the range of versions that meet that condition. In other words, it is possible to express the fact that we need the package <span
                class="pkg pkg">libc6</span> in a version equal to or greater than “2.15” (written “<code
                class="command">libc6 (&gt;= 2.15)</code>”). Version comparison operators are as follows:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="itemizedlist"><ul><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;&lt;</code>: меньше;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&lt;=</code>: меньше или равна;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">=</code>: равна (однако «<code
                      class="literal">2.6.1</code>» — не то же самое, что и «<code
                      class="literal">2.6.1-1</code>»);
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;=</code>: больше или равна;
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">&gt;&gt;</code>: больше.
						</div></li></ul></div><div
              class="para">
					В списке условий запятая играет роль разделителя. Её следует интерпретировать как логическое «и». Внутри условий вертикальная черта («|») означает логическое «или» (включающее «или», а не исключающее «строго одно из»). Поскольку оно имеет более высокий приоритет, чем «и», его можно использовать столько раз, сколько потребуется. Так, зависимость «(A или B) и C» записывается в виде <code
                class="command">A | B, C</code>. Напротив, выражение «A или (B и C)» следует записывать как «(A или B) и (A или C)», поскольку поле <code
                class="literal">Depends</code> не допускает использования скобок, меняющих порядок приоритетов между логическими операторами «или» и «и». То есть должно писаться <code
                class="command">A | B, A | C</code>. <div
                class="url">→ <a
                  href="http://www.debian.org/doc/debian-policy/ch-relationships.html">http://www.debian.org/doc/debian-policy/ch-relationships.html</a></div>
				</div><a
              id="idm140254107852032"
              class="indexterm"></a><div
              class="para">
					Система зависимостей — хороший механизм для обеспечения работоспособности программ, но у него есть и другое применение — «метапакеты». Это пустые пакеты, в которых описаны только зависимости. Они обеспечивают установку группы взаимосвязанных программ, выбранных сопровождающим метапакета; соответственно, <code
                class="command">apt-get install <em
                  class="replaceable">метапакет</em></code> автоматически установит все эти программы с помощью зависимостей метапакета. Пакеты <span
                class="pkg pkg">gnome</span>, <span
                class="pkg pkg">kde-full</span> и <span
                class="pkg pkg">linux-image-amd64</span> — это примеры метапакетов.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ПОЛИТИКА DEBIAN</em></span> <code
                          class="literal">Pre-Depends</code>,более требовательное <code
                          class="literal">Depends</code></strong></p></div></div></div><a
                id="idm140254107845216"
                class="indexterm"></a><a
                id="idm140254107843968"
                class="indexterm"></a><div
                class="para">
					«Предварительные зависимости», перечисленные в поле «<code
                  class="literal">Pre-Depends</code>» заголовков пакетов, дополняют обычные зависимости; их синтаксис аналогичен. Обычная зависимость показывает, что пакет должен быть распакован и настроен до настройки зависимого пакета. Предварительная зависимость оговаривает, что пакет должен быть распакован и настроен до запуска предустановочного сценария пакета, для которого указана предварительная зависимость, то есть до его установки.
				</div><div
                class="para">
					Предварительная зависимость очень требовательна к <code
                  class="command">apt</code>, поскольку добавляет строгие ограничения на порядок установки пакетов. Поэтому использование предварительных зависимостей без крайней необходимости не поощряется. Более того, перед добавлением предварительной зависимости рекомендовано проконсультироваться с другими разработчиками в <code
                  class="email"><a
                    class="email"
                    href="mailto:debian-devel@lists.debian.org">debian-devel@lists.debian.org</a></code>. Как правило удаётся найти другое решение или обходной путь.
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ПОЛИТИКА DEBIAN</em></span> Поля <code
                          class="literal">Recommends</code>, <code
                          class="literal">Suggests</code> и <code
                          class="literal">Enhances</code></strong></p></div></div></div><a
                id="idm140254107836720"
                class="indexterm"></a><a
                id="idm140254107835472"
                class="indexterm"></a><div
                class="para">
					В полях <code
                  class="literal">Recommends</code> и <code
                  class="literal">Suggests</code> указываются зависимости, не являющиеся обязательными. «Рекомендуемые» зависимости, более важные, значительно улучшают функциональность, предоставляемую пакетом, но не являются совершенно необходимыми для его работы. «Предлагаемые» зависимости, следующие по значимости, означают, что некоторые пакеты могут дополнить устанавливаемый или быть полезными в связке с ним, но вполне целесообразной будет и установка одного без других.
				</div><div
                class="para">
					Следует всегда устанавливать «рекомендуемые» пакеты, если вы только не знаете абсолютно точно, почему они вам не нужны. И наоборот, нет смысла устанавливать «предлагаемые» пакеты, если вы не знаете, зачем они вам нужны.
				</div><a
                id="idm140254107831120"
                class="indexterm"></a><div
                class="para">
					В поле <code
                  class="literal">Enhances</code> также указывается предложение, но другого рода. Оно на самом деле находится в предлагаемом пакете, а не в пакете, который выиграет от такого предложения. Смысл этого в том, что становится возможным добавить предложение, не меняя затрагиваемый пакет. Так, все дополнения, плагины и прочие расширения программы смогут появиться в списке предложений, относящихся к программе. Хотя оно существует уже несколько лет, это поле до сих пор по большей части игнорируется такими программами, как <code
                  class="command">apt-get</code> и <code
                  class="command">synaptic</code>. Смысл этого в том, чтобы предложения, вносимые через поле <code
                  class="literal">Enhances</code>, отображались пользователю в дополнение к обычным предложениям — тем, которые находятся в поле <code
                  class="literal">Suggests</code>.
				</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254107825536"></a>5.2.1.2. Конфликты: поле <code
                      class="literal">Conflicts</code></h4></div></div></div><a
              id="idm140254107824448"
              class="indexterm"></a><a
              id="idm140254107823488"
              class="indexterm"></a><a
              id="idm140254107822240"
              class="indexterm"></a><div
              class="para">
					Поле <code
                class="literal">Conflicts</code> указывает на то, что пакет не может быть установлен, если уже установлен другой пакет. Наиболее распространенными причинами для этого является включение обоими пакетами файлов с одинаковыми именами, или предоставление сервисов на одном и том же порту TCP, или мешающих работе друг друга.
				</div><div
              class="para">
					<code
                class="command">dpkg</code> откажется установить пакет, если он вызовет конфликт с уже установленным пакетом, за исключением тех случаев, когда новый пакет указывает, что он будет «заменять» установленный пакет, — тогда <code
                class="command">dpkg</code> заменит старый пакет на новый. <code
                class="command">apt-get</code> всегда следует вашим указаниям: если вы выберете установку нового пакета, он автоматически предложит удалить проблемный пакет.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254107816640"></a>5.2.1.3. Несовместимость: поле <code
                      class="literal">Breaks</code></h4></div></div></div><a
              id="idm140254107815552"
              class="indexterm"></a><a
              id="idm140254107814624"
              class="indexterm"></a><a
              id="idm140254107813376"
              class="indexterm"></a><div
              class="para">
					По своему действию поля <code
                class="literal">Breaks</code> похоже на поле <code
                class="literal">Conflicts</code>, но оно несёт особый смысл. Оно сообщает, что установка пакета «поломает» другой пакет (или конкретные его версии). Как правило, такая несовместимость между пакетами имеет временный характер, и <code
                class="literal">Breaks</code> указывает на конкретные несовместимые версии.
				</div><div
              class="para">
					<code
                class="command">dpkg</code> откажется установить пакет, который поломает уже установленный пакет, и <code
                class="command">apt-get</code> попытается решить проблему путём обновления пакета, который оказался бы сломанным, до более новой версии (которая, как предполагается, будет исправленной и, таким образом, снова совместимой).
				</div><div
              class="para">
					Подобные ситуации могут возникнуть в случае обновления без обратной совместимости: это происходит, если новая версия работает не так, как старая, что приводит к сбою в другой программе, если не принять должных мер. Поле <code
                class="literal">Breaks</code> помогает пользователю не сталкиваться с такими проблемами.
				</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254113409280"></a>5.2.1.4. Предоставляемое пакетом: поле <code
                      class="literal">Provides</code></h4></div></div></div><a
              id="idm140254113408112"
              class="indexterm"></a><div
              class="para">
					Это поле вводит очень интересную концепцию «виртуального пакета». Она имеет много применений, два из которых особенно важны. Первое состоит в использовании виртуального пакета, чтобы привязать к нему общее название сервиса (пакет «предоставляет» сервис). Вторая показывает, что пакет полностью заменяет другой, и что при этом он может удовлетворять зависимости, которые удовлетворил бы другой. Таким образом, можно создать замену пакета без необходимости использовать то же самое имя пакета.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>СЛОВАРЬ</em></span> Метапакет и виртуальный пакет</strong></p></div></div></div><a
                id="idm140254113404320"
                class="indexterm"></a><a
                id="idm140254113403360"
                class="indexterm"></a><a
                id="idm140254113401952"
                class="indexterm"></a><div
                class="para">
					Очень важно четко понимать различие между метапакетами и виртуальными пакетами. Первые являются настоящими пакетами (то есть файлами <code
                  class="filename">.deb</code>), единственное назначение которых состоит в том, чтобы сообщить о зависимостях.
				</div><div
                class="para">
					Виртуальные пакеты, напротив, не существует физически; они являются только средством идентификации реальных пакетов на основании общих, логических критериев (предоставляемого сервиса, совместимости со стандартной программой или ранее созданным пакетом и т. д.).
				</div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="idm140254113398576"></a>5.2.1.4.1. Предоставление «сервиса»</h5></div></div></div><div
                class="para">
						Let us discuss the first case in greater detail with an example: all mail servers, such as <span
                  class="pkg pkg">postfix</span> or <span
                  class="pkg pkg">sendmail</span> are said to “provide” the <span
                  class="pkg pkg">mail-transport-agent</span> virtual package. Thus, any package that needs this service to be functional (e.g. a mailing list manager, such as <span
                  class="pkg pkg">smartlist</span> or <span
                  class="pkg pkg">sympa</span>) simply states in its dependencies that it requires a <span
                  class="pkg pkg">mail-transport-agent</span> instead of specifying a large yet incomplete list of possible solutions (e.g. <code
                  class="command">postfix | sendmail | exim4 | …</code>). Furthermore, it is useless to install two mail servers on the same machine, which is why each of these packages declares a conflict with the <span
                  class="pkg pkg">mail-transport-agent</span> virtual package. A conflict between a package and itself is ignored by the system, but this technique will prohibit the installation of two mail servers side by side.
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>ПОЛИТИКА DEBIAN</em></span> Список виртуальных пакетов</strong></p></div></div></div><a
                  id="idm140254113390832"
                  class="indexterm"></a><div
                  class="para">
						Чтобы от виртуального пакета была польза, все должны прийти к соглашению о его имени. Именно поэтому имена стандартизированы в политике Debian. Список, помимо всего прочего, включает в себя <span
                    class="pkg pkg">mail-transport-agent</span> для почтовых серверов, <span
                    class="pkg pkg">c-compiler</span> для компиляторов языка программирования C, <span
                    class="pkg pkg">www-browser</span> для веб-браузеров, <span
                    class="pkg pkg">httpd</span> для веб-серверов, <span
                    class="pkg pkg">ftp-server</span> для FTP-серверов, <span
                    class="pkg pkg">x-terminal-emulator</span> для эмуляторов терминала в графическом режиме (<code
                    class="command">xterm</code>) и <span
                    class="pkg pkg">x-window-manager</span> для оконных менеджеров.
					</div><div
                  class="para">
						Полный список можно найти в Сети: <div
                    class="url">→ <a
                      href="http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt">http://www.debian.org/doc/packaging-manuals/virtual-package-names-list.txt</a></div>
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="idm140254113382128"></a>5.2.1.4.2. Взаимозаменяемость другим пакетом</h5></div></div></div><div
                class="para">
						The <code
                  class="literal">Provides</code> field is also interesting when the content of a package is included in a larger package. For example, the <span
                  class="pkg pkg">libdigest-md5-perl</span> Perl module was an optional module in Perl 5.6, and has been integrated as standard in Perl 5.8 (and later versions, such as 5.20 present in <span
                  class="distribution distribution">Jessie</span>). As such, the package <span
                  class="pkg pkg">perl</span> has since version 5.8 declared <code
                  class="literal">Provides: libdigest-md5-perl</code> so that the dependencies on this package are met if the user has Perl 5.8 (or newer). The <span
                  class="pkg pkg">libdigest-md5-perl</span> package itself has eventually been deleted, since it no longer had any purpose when old Perl versions were removed.
					</div><div
                class="figure"><a
                  id="idm140254113376944"></a><div
                  class="figure-contents"><div
                    class="mediaobject"><img
                      src="images/virtual-package.png"
                      alt="Использование поля Provides для того, чтобы не нарушать зависимости" /></div></div><p
                  class="title"><strong>Рисунок 5.1. Использование поля <code
                      class="literal">Provides</code> для того, чтобы не нарушать зависимости</strong></p></div><div
                class="para">
						Эта функция очень полезна, поскольку никогда нельзя предвидеть превратности процесса разработки, и важно иметь возможность подстроиться к переименованию устаревшего ПО или другим автоматическим заменам.
					</div><div
                class="sidebar"><div
                  class="titlepage"><div><div><p
                        class="title"><strong><span
                            class="emphasis"><em>К ОСНОВАМ</em></span> Perl, язык программирования</strong></p></div></div></div><a
                  id="idm140254113371808"
                  class="indexterm"></a><a
                  id="idm140254113370848"
                  class="indexterm"></a><div
                  class="para">
						Perl (<span
                    class="foreignphrase"><em
                      class="foreignphrase">Practical Extraction and Report Language</em></span> — практический язык для извлечения данных и составления отчётов) — очень популярный язык программирования. Для него существует много модулей, которые используются для широкого спектра задач и распространяются с помощью серверов CPAN (<span
                    class="foreignphrase"><em
                      class="foreignphrase">Comprehensive Perl Archive Network</em></span> — всеобъемлющая сеть архивов Perl), исчерпывающей сети пакетов Perl. <div
                    class="url">→ <a
                      href="http://www.perl.org/">http://www.perl.org/</a></div> <div
                    class="url">→ <a
                      href="http://www.cpan.org/">http://www.cpan.org/</a></div>
					</div><div
                  class="para">
						Так как это интерпретируемый язык, программа, написанная на Perl, не требуют компиляции перед выполнением. Поэтому они называются «сценариями Perl».
					</div></div></div><div
              class="section"><div
                class="titlepage"><div><div><h5
                      class="title"><a
                        id="idm140254113365520"></a>5.2.1.4.3. Past Limitations</h5></div></div></div><div
                class="para">
						Virtual packages used to suffer from some limitations, the most significant of which was the absence of a version number. To return to the previous example, a dependency such as <code
                  class="literal">Depends: libdigest-md5-perl (&gt;= 1.6)</code>, despite the presence of Perl 5.10, would never be considered as satisfied by the packaging system — while in fact it most likely is satisfied. Unaware of this, the package system chose the least risky option, assuming that the versions do not match.
					</div><div
                class="para">
						This limitation has been lifted in <span
                  class="pkg pkg">dpkg</span> 1.17.11, and is no longer relevant in Jessie.
					</div></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254113361968"></a>5.2.1.5. Замена файлов: поле <code
                      class="literal">Replaces</code></h4></div></div></div><a
              id="idm140254113360880"
              class="indexterm"></a><a
              id="idm140254113359920"
              class="indexterm"></a><a
              id="idm140254113358672"
              class="indexterm"></a><div
              class="para">
					The <code
                class="literal">Replaces</code> field indicates that the package contains files that are also present in another package, but that the package is legitimately entitled to replace them. Without this specification, <code
                class="command">dpkg</code> fails, stating that it can not overwrite the files of another package (technically, it is possible to force it to do so with the <code
                class="literal">--force-overwrite</code> option, but that's not considered standard operation). This allows identification of potential problems and requires the maintainer to study the matter prior to choosing whether to add such a field.
				</div><div
              class="para">
					Это поле используется при изменении имени пакета, или когда один пакет включается в состав другого. Это также происходит в случае, если сопровождающий решает распределить файлы по-другому между двоичными пакетами, полученными из одного и того же исходного: заменённый файл больше не принадлежит старому пакету, а только новому.
				</div><div
              class="para">
					Если все файлы в установленном пакете были заменены, принимается решение об удалении пакета. Наконец, это поле также указывает <code
                class="command">dpkg</code> удалить заменённый пакет в случае конфликта.
				</div><div
              class="sidebar"><a
                id="sidebar.debtags"></a><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Поле <code
                          class="literal">Tag</code></strong></p></div></div></div><div
                class="para">
					В приведенном выше примере <span
                  class="pkg pkg">apt</span> можно заметить еще не рассмотренное нами поле <code
                  class="literal">Tag</code>. Это поле не описывает какую-либо связь между пакетами. Это просто способ отнести пакет к той или иной тематической категории. Такая классификация пакетов по нескольким критериям (тип интерфейса, язык программирования, область применения и т. д.) существует уже давно. Несмотря на это, не все пакеты имеют точные теги, и она интегрирована еще не во все инструменты Debian; <code
                  class="command">aptitude</code> отображает эти теги и позволяет использовать их в качестве критериев поиска. Тем, кому не импонируют критерии поиска <code
                  class="command">aptitude</code>, следующий веб-сайт позволяет использовать навигацию по базе тегов: <div
                  class="url">→ <a
                    href="http://debtags.alioth.debian.org/">http://debtags.alioth.debian.org/</a></div>
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140254113346192"></a>5.2.2. Сценарии настройки</h3></div></div></div><a
            id="idm140254113345424"
            class="indexterm"></a><a
            id="idm140254113344304"
            class="indexterm"></a><a
            id="idm140254113343184"
            class="indexterm"></a><a
            id="idm140254113342064"
            class="indexterm"></a><a
            id="idm140254113340944"
            class="indexterm"></a><div
            class="para">
				Кроме файла <code
              class="filename">control</code> архив <code
              class="filename">control.tar.gz</code> в каждом пакете Debian может содержать несколько сценариев, вызываемых <code
              class="command">dpkg</code> на разных этапах обработки пакета. В Политике Debian подробно описаны все возможные случаи, в которых вызываются сценарии, и какие аргументы они при этом получают. Эти последовательности могут быть довольно сложными, поскольку если один из сценариев завершается с ошибкой, <code
              class="command">dpkg</code> будет пытаться вернуться к нормальному состоянию (насколько это возможно) путём отмены текущей установки или удаления.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> База данных <code
                        class="command">dpkg</code></strong></p></div></div></div><a
              id="idm140254113335216"
              class="indexterm"></a><a
              id="idm140254113334096"
              class="indexterm"></a><div
              class="para">
				Все сценарии настройки для установленных пакетов храняться в каталоге <code
                class="filename">/var/lib/dpkg/info/</code> в виде файла, префикс имени которого совпадает с именем пакета. В этом каталоге также содержатся файлы с расширением <code
                class="filename">.list</code> для каждого пакета, содержащие список файлов, принадлежащих каждому пакету.
			</div><div
              class="para">
				Файл <code
                class="filename">/var/lib/dpkg/status</code> содержит последовательности блоков данных (в формате небезызветстных почтовых заголовков, RFC 2822) с описанием статуса каждого пакета. Информация из файла <code
                class="filename">control</code> установленного пакета также дублируется сюда.
			</div></div><div
            class="para">
				Если вкратце, сценарий <code
              class="filename">preinst</code> вызывается перед установкой пакета, а <code
              class="filename">postinst</code> после неё. Аналогично, <code
              class="filename">prerm</code> запускается перед удалением пакета, а <code
              class="filename">postrm</code> — после. Обновление пакета эквивалентно удалению предыдущей версии и установке более новой. Все возможные ситуации описать здесь не получится, но мы рассмотрим две, встречающиеся чаще всего: установку/обновление и удаление.
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ВНИМАНИЕ</em></span> Сиволические имена сценариев</strong></p></div></div></div><div
              class="para">
				В последовательностях, описанных в этом разделе, сценарии вызываются по особым именам, таким как <code
                class="command">old-prerm</code> или <code
                class="command">new-postinst</code>. Это, соответственно, сценарий <code
                class="command">prerm</code>, содержавшийся в старой версии пакета (установленной до обновления), и сценарий <code
                class="command">postinst</code>, содержащийся в новой версии (установленной при обновлении).
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>СОВЕТ</em></span> Диаграммы состояний</strong></p></div></div></div><div
              class="para">
				Манож Сривастава нарисовал диаграммы, иллюстрирующие вызов конфигурационных сценариев <code
                class="command">dpkg</code>. Похожие диаграммы также были разработаны проектом Debian Women; они несколько проще для понимания, но менее полные. <div
                class="url">→ <a
                  href="http://people.debian.org/~srivasta/MaintainerScripts.html">http://people.debian.org/~srivasta/MaintainerScripts.html</a></div> <div
                class="url">→ <a
                  href="http://wiki.debian.org/MaintainerScripts">http://wiki.debian.org/MaintainerScripts</a></div>
			</div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254113318032"></a>5.2.2.1. Установка и обновление</h4></div></div></div><a
              id="idm140254113317264"
              class="indexterm"></a><div
              class="para">
					Вот что происходит во время установки пакета (или его обновления):
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							Для обновления <code
                      class="command">dpkg</code> запускает <code
                      class="command">old-prerm upgrade <em
                        class="replaceable">новая-версия</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Также для обновления <code
                      class="command">dpkg</code> запускает <code
                      class="command">new-preinst upgrade <em
                        class="replaceable">старая-версия</em></code>; при установке запускается <code
                      class="command">new-preinst install</code>. Последним параметром может быть добавлена старая версия, если пакет уже устанавливался раньше, но был удалён (но не вычищен, то есть конфигурационные файлы сохранились).
						</div></li><li
                  class="listitem"><div
                    class="para">
							После этого распаковываются файлы нового пакета. Если файл уже существует, он заменяется, но создаётся временная резервная копия.
						</div></li><li
                  class="listitem"><div
                    class="para">
							При обновлении <code
                      class="command">dpkg</code> вызывает <code
                      class="command">old-postrm upgrade <em
                        class="replaceable">новая-версия</em></code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> обновляет все внутренние данные (список файлов, сценарии настройки и т. п.) и удаляет резервные копии заменённых файлов. Теперь обратного пути нет: <code
                      class="command">dpkg</code> более недоступны все элементы, необходимые для отката к предыдущему состоянию.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> обновит все конфигурационные файлы, выводя запрос пользователю, если это невозможно сделать автоматически. Подробности этой процедуры рассмотрены в <a
                      class="xref"
                      href="sect.package-meta-information.html#sect.conffiles">Раздел 5.2.3, «Контрольные суммы, список конфигурационных файлов»</a>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Наконец, <code
                      class="command">dpkg</code> настраивает пакет, запуская <code
                      class="command">new-postinst configure <em
                        class="replaceable">последняя-настроенная-версия</em></code>.
						</div></li></ol></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140254113299248"></a>5.2.2.2. Удаление пакета</h4></div></div></div><div
              class="para">
					Вот что происходит во время удаления пакета:
				</div><div
              xmlns:d="http://docbook.org/ns/docbook"
              class="orderedlist"><ol><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> запускает <code
                      class="command">prerm remove</code>.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> удаляет все файлы пакета за исключением конфигурационных файлов и сценариев настройки.
						</div></li><li
                  class="listitem"><div
                    class="para">
							<code
                      class="command">dpkg</code> запускает <code
                      class="command">postrm remove</code>. Все сценарии настройки, за исключением <code
                      class="filename">postrm</code>, удаляются. Если пользователь не использует опцию «purge», процесс удаления заканчивается на этом шаге.
						</div></li><li
                  class="listitem"><div
                    class="para">
							Для полного удаления пакета (в случае использования команды <code
                      class="command">dpkg --purge</code> или <code
                      class="command">dpkg -P</code>) также удаляются конфигурационные файлы и их копии (<code
                      class="filename">*.dpkg-tmp</code>, <code
                      class="filename">*.dpkg-old</code>, <code
                      class="filename">*.dpkg-new</code>) и временные файлы; после этого <code
                      class="command">dpkg</code> запускает <code
                      class="command">postrm purge</code>.
						</div></li></ol></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>СЛОВАРЬ</em></span> Purge, полное удаление</strong></p></div></div></div><a
                id="idm140254113285856"
                class="indexterm"></a><div
                class="para">
					При удалении пакета Debian конфигурационные файлы сохраняются в целях облегчения возможной повторной установки. Кроме того, сохраняется данные, созданные демонами (например содержимое каталога сервера LDAP или содержимое базы данных SQL-сервера).
				</div><div
                class="para">
					Для полного удаления всех данных, относящихся к пакету, необходимо «вычистить» (<span
                  class="foreignphrase"><em
                    class="foreignphrase">purge</em></span>) пакет с помощью команды <code
                  class="command">dpkg -P <em
                    class="replaceable">пакет</em></code>, <code
                  class="command">apt-get remove --purge <em
                    class="replaceable">пакет</em></code> или <code
                  class="command">aptitude purge <em
                    class="replaceable">пакет</em></code>.
				</div><div
                class="para">
					Given the definitive nature of such data removals, a purge should not be taken lightly.
				</div></div><a
              id="idm140254113279824"
              class="indexterm"></a><div
              class="para">
					Четыре сценария, описанные выше, дополняются сценарием <code
                class="filename">config</code>, предоставляемым пакетами, которые используют <code
                class="command">debconf</code> для запроса у пользователя информации для настройки. Этот сценарий определяет вопросы, которые будут заданы <code
                class="command">debconf</code> во время установки. Ответы заносятся в базу данных <code
                class="command">debconf</code> для дальнейшего использования. Эти сценарии обычно выполняются <code
                class="command">apt</code> до установки пакетов, последовательно, чтобы сгруппировать вопросы и задать их пользовтелю в начале процесса. Пред- и послеустановочные сценарии могут впоследствии использовать эту информацию, чтобы действовать в соответствии с пожеланиями пользователей.
				</div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>ИНСТРУМЕНТ</em></span> <code
                          class="command">debconf</code></strong></p></div></div></div><a
                id="idm140254113273008"
                class="indexterm"></a><div
                class="para">
					<code
                  class="command">debconf</code> создали для решения постоянно повторявшейся в Debian проблемы. Все пакеты Debian, которые не могли работать без минимума настроечной информации, задавали вопросы, вызывая команды <code
                  class="command">echo</code> и <code
                  class="command">read</code> в послеустановочных сценариях оболочки (и других похожих сценариях). Но это означало, что во время большой установки или обновления пользователь должен был оставаться у компьютера, чтобы отвечать на различные вопросы, которые могли появляться время от времени. Необходимость в таких ручных вмешательствах теперь почти полностью отпала благодаря инструменту <code
                  class="command">debconf</code>.
				</div><div
                class="para">
					У <code
                  class="command">debconf</code> множество интересных возможностей: взаимодействие с пользователем задаётся разработчиком; возможна локализация всех строк, отображаемых пользователю (все переводы хранятся в файле <code
                  class="filename">templates</code>, описывающем взаимодействия); у него есть несколько фронт-эндов (для текстового, графического и неинтерактивного режимов); а также возможно создание центральной базы данных ответов для распространения одной конфигурации по нескольким компьютерам... но наиболее важным является то, что теперь возможно задать все вопросы пользователю подряд, до начала длительного процесса установки или обновления. Пользователь может отойти по своим делам, пока система санимается собственно установкой, а не глядеть неотрывно на экран в ожидании вопросов.
				</div></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.conffiles"></a>5.2.3. Контрольные суммы, список конфигурационных файлов</h3></div></div></div><a
            id="idm140254113264064"
            class="indexterm"></a><a
            id="idm140254113831152"
            class="indexterm"></a><a
            id="idm140254113830032"
            class="indexterm"></a><a
            id="idm140254113829104"
            class="indexterm"></a><a
            id="idm140254113827696"
            class="indexterm"></a><div
            class="para">
				В дополнение к сценариям сопровождающего и контрольным данным, уже рассмотренным в предыдущих разделах, архив <code
              class="filename">control.tar.gz</code> пакета Debian может содержать другие интересные файлы. Первый, <code
              class="filename">md5sums</code>, содержит контрольные суммы MD5 для всех файлов пакета. Благодаря ему можно с помощью такого инструмента, как <code
              class="command">debsums</code> (который будет изучаться в <a
              class="xref"
              href="sect.supervision.html#sect.debsums">Раздел 14.3.3.2, «Auditing Packages: <code
                class="command">debsums</code> and its Limits»</a>), проверить, изменялись ли эти файлы с момента установки. Обратите внимание, что при отсутствии этого файла <code
              class="command">dpkg</code> создаст его динамически во время установки (и сохранит его в базе данных dpkg, как и другие контрольные файлы).
			</div><div
            class="para">
				В <code
              class="filename">conffiles</code> содержится список файлов, которые должны быть обработаны как конфигурационные файлы. Конфигурационные файлы могут быть изменены администратором, и <code
              class="command">dpkg</code> постарается сохранить эти изменения во время обновления пакета.
			</div><div
            class="para">
				Действительно, в этой ситуации <code
              class="command">dpkg</code> ведёт себя настолько интеллектуально, насколько это возможно: если стандартный конфигурационный файл не изменился между двумя версиями, она ничего не делает. Если, однако, файл был изменен, она будет пытаться обновить его. Возможны два варианта развития событий: если администратор не трогал конфигурационный файл, <code
              class="command">dpkg</code> автоматически установит новую версию; если же файл был изменен, <code
              class="command">dpkg</code> спросит администратора, какую версию он хочет использовать (старую с изменениями или новую из пакета). Для помощи в принятии решения <code
              class="command">dpkg</code> показывает «<code
              class="command">diff</code>», то есть различия между двумя версиями. Если пользователь предпочтёт оставить старую версию, новая будет храниться в том же месте, в файле с суффиксом <code
              class="filename">.dpkg-dist</code>. Если же пользователь выбирает новую версию, старая сохраняется в файле с суффиксом <code
              class="filename">.dpkg-old</code>. Другой вариант заключается в том, чтобы немедленно прервать <code
              class="command">dpkg</code> и отредактировать файл, попытавшись внести нужные изменения (ранее обнаруженные с помощью <code
              class="command">diff</code>).
			</div><div
            class="sidebar"><a
              id="sidebar.questions-conffiles"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Как избежать вопросов по поводу конфигурационных файлов</strong></p></div></div></div><div
              class="para">
				Хотя <code
                class="command">dpkg</code> сама заботится об обновлении конфигурационных файлов, она всё же регулярно прерывает свою работу, запрашивая ввод у администратора. Это весьма малоприятно для тех, кто хочет, чтобы обновление выполнялось неинтерактивно. Поэтому у программы имеются опции, позволяющие системе выбирать ответы автоматически, руководствуясь одной и той же логикой: <code
                class="command">--force-confold</code> оставляет старую версию файла; <code
                class="command">--force-confnew</code> использует более новую версию файла (этот выбор применяется, даже если файл не изменялся администратором, что крайне редко является желаемым эффектом). Добавление опции <code
                class="command">--force-confdef</code> указывает <code
                class="command">dpkg</code>, что решения должны по возможности приниматься автоматически (в тех случаях, когда конфигурационный файл не менялся), а <code
                class="command">--force-confnew</code> или <code
                class="command">--force-confold</code> надо применять в остальных случаях.
			</div><div
              class="para">
				Эти опции применимы для <code
                class="command">dpkg</code>, но администратор чаще имеет дело с программами <code
                class="command">aptitude</code> или <code
                class="command">apt-get</code>. Поэтому важно знать синтаксис, используемый для передаче опций команде <code
                class="command">dpkg</code> (интерфейсы командной строки <code
                class="command">aptitude</code> и <code
                class="command">apt-get</code> очень похожи).
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt-get -o DPkg::options::="--force-confdef" -o DPkg::options::="--force-confold" dist-upgrade</code></strong></pre><div
              class="para">
				Эти опции можно записать непосредственно в конфигурации <code
                class="command">apt</code>. Для этого нужно добавить следующую строку в файл <code
                class="filename">/etc/apt/apt.conf.d/local</code>:
			</div><div
              class="informalexample"><pre
                class="programlisting">
DPkg::options { "--force-confdef"; "--force-confold"; }
</pre></div><div
              class="para">
				Включение этой опции в конфигурационный файл означает, что она будет распространяться и на графический интерфейс, в частности <code
                class="command">aptitude</code>.
			</div></div><div
            class="sidebar"><a
              id="sidebar.questions-conffiles-bis"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>УГЛУБЛЯЕМСЯ</em></span> Как заставить dpkg всегда задавать вопросы по поводу конфигурационных файлов</strong></p></div></div></div><div
              class="para">
				Опция <code
                class="command">--force-confask</code> вынуждает <code
                class="command">dpkg</code> отображать вопросы о конфигурационных файлах даже в тех случаях, когда в этом обычно нет необходимости. Таким образом, при переустановке пакета с этой опцией <code
                class="command">dpkg</code> будет задавать вопросы снова и снова для всех конфигурационных файлов, измененных администратором. Это очень удобно, особенно для переустановки оригинального конфигурационного файла, если он был удалён, и никакой другой экземпляр не доступен: обычная переустановка тут не сработает, так как <code
                class="command">dpkg</code> считает удаление формой нормального изменения, и поэтому не устанавливает желанный конфигурационный файл.
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="packaging-system.html"><strong>Пред.</strong>Глава 5. Пакетная система: Инструменты и основные...</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>Наверх</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>Начало</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.source-package-structure.html"><strong>След.</strong>5.3. Структура исходного пакета</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.package-meta-information.html">ar-MA</a></li><li><a
              href="../da-DK/sect.package-meta-information.html">da-DK</a></li><li><a
              href="../de-DE/sect.package-meta-information.html">de-DE</a></li><li><a
              href="../el-GR/sect.package-meta-information.html">el-GR</a></li><li><a
              href="../en-US/sect.package-meta-information.html">en-US</a></li><li><a
              href="../es-ES/sect.package-meta-information.html">es-ES</a></li><li><a
              href="../fa-IR/sect.package-meta-information.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.package-meta-information.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.package-meta-information.html">hr-HR</a></li><li><a
              href="../id-ID/sect.package-meta-information.html">id-ID</a></li><li><a
              href="../it-IT/sect.package-meta-information.html">it-IT</a></li><li><a
              href="../ja-JP/sect.package-meta-information.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.package-meta-information.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.package-meta-information.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.package-meta-information.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.package-meta-information.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.package-meta-information.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.package-meta-information.html">zh-CN</a></li></ul></div></body></html>
