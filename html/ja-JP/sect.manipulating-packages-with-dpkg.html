<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">5.4. dpkg を用いたパッケージの操作</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="バイナリパッケージ, ソースパッケージ, dpkg, 依存関係, 衝突" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="packaging-system.html"
        title="第5章 パッケージシステム: ツールと基本原則" /><link
        rel="prev"
        href="sect.source-package-structure.html"
        title="5.3. ソースパッケージの構造" /><link
        rel="next"
        href="sect.coexistence-with-other-packaging-systems.html"
        title="5.5. 他のパッケージ化システムとの共存" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ja-JP/sect.manipulating-packages-with-dpkg.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.manipulating-packages-with-dpkg"></a>5.4. <code
                  class="command">dpkg</code> を用いたパッケージの操作</h2></div></div></div><a
          id="idm140170056490768"
          class="indexterm"></a><div
          class="para">
			<code
            class="command">dpkg</code> はシステムの Debian パッケージを操作する基礎的なコマンドです。<code
            class="filename">.deb</code> パッケージがあれば、<code
            class="command">dpkg</code> でパッケージ内容をインストールしたり解析したりすることが可能です。しかしこのプログラムは Debian 世界のある一方向だけを見ているに過ぎません: このプログラムは、システムインストール済みのパッケージとコマンドラインで与えられたパッケージについては理解していますが、他の利用できるパッケージについては理解していません。このため、依存関係が満足されていなければパッケージを操作できません。これに対して、<code
            class="command">apt-get</code> などのツールは、可能な限り自動的にすべてをインストールするために、依存関係のリストを作成します。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>NOTE</em></span> <code
                      class="command">dpkg</code> か <code
                      class="command">apt-get</code> か?</strong></p></div></div></div><div
            class="para">
			<code
              class="command">dpkg</code> はシステムツール (バックエンド) と、<code
              class="command">apt-get</code> はユーザに近いツールととらえるべきです。後者は前者の制限を克服しています。これらのツールは互いに協力して作業を行います。両者は互いに異なる得意分野を持っており、それぞれが特定の作業を担当しています。
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170056482560"></a>5.4.1. パッケージのインストール</h3></div></div></div><a
            id="idm140170056481792"
            class="indexterm"></a><a
            id="idm140170056480384"
            class="indexterm"></a><div
            class="para">
				中でも、<code
              class="command">dpkg</code> は既に利用できる Debian パッケージのインストールを担当している (ダウンロード機能はありません) ツールです。インストールを行うには、<code
              class="literal">-i</code> または <code
              class="literal">--install</code> オプションを使ってください。
			</div><div
            class="example"><a
              id="idm140170066044496"></a><p
              class="title"><strong>例5.2 <code
                  class="command">dpkg</code> を使ったパッケージのインストール</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -i man-db_2.7.0.2-5_amd64.deb</code></strong>
<code
                  class="computeroutput">(データベースを読み込んでいます ... 現在 86425 個のファイルとディレクトリがインストールされています。)
man-db_2.7.0.2-5_amd64.deb を展開する準備をしています ...
man-db (2.7.0.2-5) で (2.7.0.2-4 に) 上書き展開しています ...
man-db (2.7.0.2-5) を設定しています ...
Updating database of manual pages ...
mime-support (3.58) のトリガを処理しています ...</code></pre></div></div><div
            class="para">
				<code
              class="command">dpkg</code> の実行する各作業段階が見て取れます; このため、どの時点でエラーが起きたかを識別できます。インストールを 2 段階に分けて実行することも可能です: 最初が解凍、その後設定です。<code
              class="command">apt-get</code> はこれをうまく利用して、<code
              class="command">dpkg</code> を呼び出す回数を減らしています (なぜなら呼び出される度にデータベース、特にインストール済みファイルのリスト、をメモリに読み込むため効率が悪いからです)。
			</div><div
            class="example"><a
              id="idm140170066038624"></a><p
              class="title"><strong>例5.3 解凍と設定を分けて実行</strong></p><div
              class="example-contents"><pre
                class="screen scale">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg --unpack man-db_2.7.0.2-5_amd64.deb</code></strong>
<code
                  class="computeroutput">(データベースを読み込んでいます ... 現在 86425 個のファイルとディレクトリがインストールされています。)
man-db_2.7.0.2-5_amd64.deb を展開する準備をしています ...
man-db (2.7.0.2-5) で (2.7.0.2-5 に) 上書き展開しています ...
mime-support (3.58) のトリガを処理しています ...
# </code><strong
                  class="userinput"><code>dpkg --configure man-db</code></strong>
<code
                  class="computeroutput">man-db (2.7.0.2-5) を設定しています ...
Updating database of manual pages ...
</code></pre></div></div><a
            id="idm140170066034720"
            class="indexterm"></a><a
            id="idm140170066033280"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">dpkg</code> がパッケージのインストールに失敗し、エラーを返すことがあります; ユーザが失敗を無視するように命令すれば、警告を表示するでしょう; これが異なる <code
              class="literal">--force-*</code> 系オプションがある理由です。このコマンドの文書によれば <code
              class="command">dpkg --force-help</code> コマンドでこれらのオプションの完全なリストを見ることが可能です。最もよくあるエラーはファイルの衝突で、遅かれ早かれこのエラーに遭遇するのは避けられません。パッケージが他のパッケージによってインストール済みのファイルを含んでいる場合、<code
              class="command">dpkg</code> はパッケージのインストールを拒否します。以下のメッセージが表示されます:
			</div><pre
            class="screen">
<code
              class="computeroutput">Unpacking libgdm (from .../libgdm_3.8.3-2_amd64.deb) ...
dpkg: error processing /var/cache/apt/archives/libgdm_3.8.3-2_amd64.deb (--unpack):
 trying to overwrite '/usr/bin/gdmflexiserver', which is also in package gdm3 3.4.1-9</code></pre><div
            class="para">
				この場合、ファイルを置き換えることでシステムの安定度が大きく阻害されない (通常は阻害されません) と考えるなら、<code
              class="literal">--force-overwrite</code> オプションを使うことで <code
              class="command">dpkg</code> にこのエラーを無視してファイルを上書きするように伝えられます。
			</div><div
            class="para">
				<code
              class="literal">--force-*</code> 系のオプションはたくさんありますが、日常的に使うのは <code
              class="literal">--force-overwrite</code> だけです。これらのオプションは例外的状況のためだけに用意されており、パッケージ化メカニズムの定める標準規則を尊重するためには、これらのオプションを使うことは可能な限り避けるべきです。これらの標準規則はシステムの一貫性と安定性を守るものであることを忘れないでください。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> <code
                        class="literal">--force-*</code> の効果的な使い方</strong></p></div></div></div><a
              id="idm140170066022864"
              class="indexterm"></a><div
              class="para">
				下手をすると <code
                class="literal">--force-*</code> オプションを使うことにより、そのシステム上で APT ファミリーのコマンドが動かなくなる場合があります。事実上、これらのオプションを使えば、依存関係が満足されていなくても、衝突していても、パッケージをインストールできてしまいます。この結果、システムは依存関係の観点からすると一貫性のない状況になります。APT コマンドはシステムを一貫性の有る状態に戻せるような操作 (多くの場合、依存関係を満足させるために必要なパッケージのインストール、問題のあるパッケージの削除が含まれています) を除き、その実行を拒否しますから、APT コマンドが実行できなくなります。その場合、たとえば以下のようなメッセージが表示されることがあります。これは、<span
                class="pkg pkg">rdesktop</span> の新しいバージョンが <span
                class="pkg pkg">libc6</span> のシステムにインストールされているバージョンよりも新しいバージョンに依存しているにも関わらず、その依存関係を無視して <span
                class="pkg pkg">rdesktop</span> をインストールした結果です。
			</div><pre
              class="programlisting"># apt-get dist-upgrade
[...]
You can run "apt-get -f install" to correct these problems.
The following packages contain unmet dependencies:
  rdesktop: Depends on: libc6 (&gt;= 2.5) but 2.3.6.ds1-13etch7 is installed
E: missing dependencies. Try to use the option -f.
</pre><div
              class="para">
				勇気ある管理者が自分の解析の正確さに自信を持っているなら、依存関係や衝突を無視して、対応する <code
                class="literal">--force-*</code> 系オプションを使うことを選ぶかもしれません。この場合に、管理者が <code
                class="command">apt-get</code> や <code
                class="command">aptitude</code> を使い続けたいと思うなら、管理者は無効にしたい依存関係や衝突を削除/変更するために <code
                class="filename">/var/lib/dpkg/status</code> を編集しなければいけません。
			</div><div
              class="para">
				この操作は最悪の対応策であり、本当にどうしても必要な場合を除いて、絶対に使うべきではありません。多くの場合、より適切な解決策は、問題を生じさせているパッケージを再コンパイルするか (<a
                class="xref"
                href="debian-packaging.html#sect.rebuilding-package">「ソースからパッケージを再ビルドする」</a>をご覧ください)、<code
                class="literal">stable-backports</code> などのリポジトリから新しい (修正済みの可能性がある) バージョンを使うか (<a
                class="xref"
                href="apt.html#sect.backports">「安定版バックポート」</a>をご覧ください) です。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170066011424"></a>5.4.2. パッケージの削除</h3></div></div></div><a
            id="idm140170066010656"
            class="indexterm"></a><a
            id="idm140170066009728"
            class="indexterm"></a><a
            id="idm140170066008800"
            class="indexterm"></a><a
            id="idm140170066007360"
            class="indexterm"></a><div
            class="para">
				<code
              class="command">dpkg</code> を実行する際に、<code
              class="literal">-r</code> または <code
              class="literal">--remove</code> オプションを付けてさらにパッケージの名前を続けると、パッケージを削除します。しかしながらこの削除は完璧ではありません: パッケージの取り扱うすべての設定ファイル、メンテナスクリプト、ログファイル (システムログ)、その他のユーザデータは残されたままです。プログラムを無効化するには、この方法でパッケージをアンインストールしてください。そうすれば、そのパッケージを同じ設定で再インストールして素早く利用できる状態にすることもまだ可能です。パッケージに関連するすべてを完全に削除するには、<code
              class="literal">-P</code> または <code
              class="literal">--purge</code> オプションつけてさらにパッケージの名前を続けてください。
			</div><div
            class="example"><a
              id="idm140170066002288"></a><p
              class="title"><strong>例5.4 <span
                  class="pkg pkg">debian-cd</span> パッケージの削除と完全消去</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>dpkg -r debian-cd</code></strong>
<code
                  class="computeroutput">(データベースを読み込んでいます ... 現在 97747 個のファイルとディレクトリがインストールされています。)
debian-cd (3.1.17) を削除しています ...
# </code><strong
                  class="userinput"><code>dpkg -P debian-cd</code></strong>
<code
                  class="computeroutput">(データベースを読み込んでいます ... 現在 97401 個のファイルとディレクトリがインストールされています。)
debian-cd (3.1.17) を削除しています ...
debian-cd (3.1.17) の設定ファイルを削除しています ...</code></pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170065997920"></a>5.4.3. <code
                    class="command">dpkg</code> のデータベースへの問い合わせと <code
                    class="filename">.deb</code> ファイルの調査</h3></div></div></div><a
            id="idm140170065996352"
            class="indexterm"></a><a
            id="idm140170065994912"
            class="indexterm"></a><a
            id="idm140170065993472"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> オプションの構文</strong></p></div></div></div><div
              class="para">
				ほとんどのオプションには「長い」もの (1 個以上の関連する単語、二重ダッシュで始まる) と「短い」もの (1 文字、長いオプションの頭文字の場合が多い、単独のダッシュで始まる) があります。これは POSIX 標準のプログラムでよく見られる慣例です。
			</div></div><div
            class="para">
				この節を締めくくる前に、内部データベースに問い合わせて情報を得る際に使う <code
              class="command">dpkg</code> のオプションについて学びましょう。表記は最初に長いオプション、そのあとに対応する短いオプション (両者は同じ引数を取るのは明らかです) です。<code
              class="literal">--listfiles <em
                class="replaceable">package</em></code> (または <code
              class="literal">-L</code>)、与えられたパッケージがインストールするファイルを表示します; <code
              class="literal">--search <em
                class="replaceable">file</em></code> (または <code
              class="literal">-S</code>)、ファイルを含むパッケージを探します; <code
              class="literal">--status <em
                class="replaceable">package</em></code> (または <code
              class="literal">-s</code>)、インストールされたパッケージのヘッダを表示します; <code
              class="literal">--list</code> (または <code
              class="literal">-l</code>)、システムが把握しているパッケージのリストとその状態を表示します; <code
              class="literal">--contents <em
                class="replaceable">file.deb</em></code> (または <code
              class="literal">-c</code>)、与えられた Debian パッケージに含まれるファイルを表示します; <code
              class="literal">--info<em
                class="replaceable"> file.deb </em></code> (または <code
              class="literal">-I</code>) Debian パッケージのヘッダを表示します。
			</div><div
            class="example"><a
              id="idm140170065981056"></a><p
              class="title"><strong>例5.5 <code
                  class="command">dpkg</code> にさまざまな情報を問い合わせる</strong></p><div
              class="example-contents"><pre
                class="screen scale"
                width="80">
<code
                  class="computeroutput">$ </code><strong
                  class="userinput"><code>dpkg -L base-passwd</code></strong>
<code
                  class="computeroutput">/.
/usr
/usr/sbin
/usr/sbin/update-passwd
/usr/share
/usr/share/lintian
/usr/share/lintian/overrides
/usr/share/lintian/overrides/base-passwd
/usr/share/doc-base
/usr/share/doc-base/users-and-groups
/usr/share/base-passwd
/usr/share/base-passwd/group.master
/usr/share/base-passwd/passwd.master
/usr/share/man
/usr/share/man/pl
/usr/share/man/pl/man8
/usr/share/man/pl/man8/update-passwd.8.gz
/usr/share/man/ru
/usr/share/man/ru/man8
/usr/share/man/ru/man8/update-passwd.8.gz
/usr/share/man/ja
/usr/share/man/ja/man8
/usr/share/man/ja/man8/update-passwd.8.gz
/usr/share/man/fr
/usr/share/man/fr/man8
/usr/share/man/fr/man8/update-passwd.8.gz
/usr/share/man/es
/usr/share/man/es/man8
/usr/share/man/es/man8/update-passwd.8.gz
/usr/share/man/de
/usr/share/man/de/man8
/usr/share/man/de/man8/update-passwd.8.gz
/usr/share/man/man8
/usr/share/man/man8/update-passwd.8.gz
/usr/share/doc
/usr/share/doc/base-passwd
/usr/share/doc/base-passwd/users-and-groups.txt.gz
/usr/share/doc/base-passwd/changelog.gz
/usr/share/doc/base-passwd/copyright
/usr/share/doc/base-passwd/README
/usr/share/doc/base-passwd/users-and-groups.html
$ </code><strong
                  class="userinput"><code>dpkg -S /bin/date</code></strong>
<code
                  class="computeroutput">coreutils: /bin/date
$ </code><strong
                  class="userinput"><code>dpkg -s coreutils</code></strong>
<code
                  class="computeroutput">Package: coreutils
Essential: yes
Status: install ok installed
Priority: required
Section: utils
Installed-Size: 13855
Maintainer: Michael Stone &lt;mstone@debian.org&gt;
Architecture: amd64
Multi-Arch: foreign
Version: 8.23-3
Replaces: mktemp, realpath, timeout
Pre-Depends: libacl1 (&gt;= 2.2.51-8), libattr1 (&gt;= 1:2.4.46-8), libc6 (&gt;= 2.17), libselinux1 (&gt;= 2.1.13)
Conflicts: timeout
Description: GNU core utilities
 This package contains the basic file, shell and text manipulation
 utilities which are expected to exist on every operating system.
 .
 Specifically, this package includes:
 arch base64 basename cat chcon chgrp chmod chown chroot cksum comm cp
 csplit cut date dd df dir dircolors dirname du echo env expand expr
 factor false flock fmt fold groups head hostid id install join link ln
 logname ls md5sum mkdir mkfifo mknod mktemp mv nice nl nohup nproc numfmt
 od paste pathchk pinky pr printenv printf ptx pwd readlink realpath rm
 rmdir runcon sha*sum seq shred sleep sort split stat stty sum sync tac
 tail tee test timeout touch tr true truncate tsort tty uname unexpand
 uniq unlink users vdir wc who whoami yes
Homepage: http://gnu.org/software/coreutils
$ </code><strong
                  class="userinput"><code>dpkg -l 'b*'</code></strong>
<code
                  class="computeroutput">要望=(U)不明/(I)インストール/(R)削除/(P)完全削除/(H)保持
| 状態=(N)無/(I)インストール済/(C)設定/(U)展開/(F)設定失敗/(H)半インストール/(W)トリガ待ち/(T)トリガ保留
|/ エラー?=(空欄)無/(R)要再インストール (状態,エラーの大文字=異常)
||/ 名前                    バージョン       アーキテクチャ   説明
+++-=======================-================-================-====================================================
un  backupninja             &lt;なし&gt;           &lt;なし&gt;           (説明 (description) がありません)
ii  backuppc                3.3.0-2          amd64            high-performance, enterprise-grade system for backin
un  base                    &lt;なし&gt;           &lt;なし&gt;           (説明 (description) がありません)
un  base-config             &lt;なし&gt;           &lt;なし&gt;           (説明 (description) がありません)
ii  base-files              8                amd64            Debian base system miscellaneous files
ii  base-passwd             3.5.37           amd64            Debian base system master password and group files
[...]
$ </code><strong
                  class="userinput"><code>dpkg -c /var/cache/apt/archives/gnupg_1.4.18-6_amd64.deb</code></strong>
<code
                  class="computeroutput">drwxr-xr-x root/root         0 2014-12-04 23:03 ./
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/udev/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./lib/udev/rules.d/
-rw-r--r-- root/root      2711 2014-12-04 23:03 ./lib/udev/rules.d/60-gnupg.rules
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/lib/
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/lib/gnupg/
-rwxr-xr-x root/root     39328 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_ldap
-rwxr-xr-x root/root     92872 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_hkp
-rwxr-xr-x root/root     47576 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_finger
-rwxr-xr-x root/root     84648 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_curl
-rwxr-xr-x root/root      3499 2014-12-04 23:03 ./usr/lib/gnupg/gpgkeys_mailto
drwxr-xr-x root/root         0 2014-12-04 23:03 ./usr/bin/
-rwxr-xr-x root/root     60128 2014-12-04 23:03 ./usr/bin/gpgsplit
-rwxr-xr-x root/root   1012688 2014-12-04 23:03 ./usr/bin/gpg
[...]
$ </code><strong
                  class="userinput"><code>dpkg -I /var/cache/apt/archives/gnupg_1.4.18-6_amd64.deb</code></strong>
<code
                  class="computeroutput"> 新形式 debian パッケージ、バージョン 2.0。
 サイズ 1148362 バイト: コントロールアーカイブ = 3422 バイト。
    1264 バイト、   26 行      control              
    4521 バイト、   65 行      md5sums              
     479 バイト、   13 行   *  postinst             #!/bin/sh
     473 バイト、   13 行   *  preinst              #!/bin/sh
 Package: gnupg
 Version: 1.4.18-6
 Architecture: amd64
 Maintainer: Debian GnuPG-Maintainers &lt;pkg-gnupg-maint@lists.alioth.debian.org&gt;
 Installed-Size: 4888
 Depends: gpgv, libbz2-1.0, libc6 (&gt;= 2.15), libreadline6 (&gt;= 6.0), libusb-0.1-4 (&gt;= 2:0.1.12), zlib1g (&gt;= 1:1.1.4)
 Recommends: gnupg-curl, libldap-2.4-2 (&gt;= 2.4.7)
 Suggests: gnupg-doc, libpcsclite1, parcimonie, xloadimage | imagemagick | eog
 Section: utils
 Priority: important
 Multi-Arch: foreign
 Homepage: http://www.gnupg.org
 Description: GNU privacy guard - a free PGP replacement
  GnuPG is GNU's tool for secure communication and data storage.
  It can be used to encrypt data and to create digital signatures.
  It includes an advanced key management facility and is compliant
  with the proposed OpenPGP Internet standard as described in RFC 4880.
[...]</code></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> バージョンの比較</strong></p></div></div></div><a
              id="idm140170065966752"
              class="indexterm"></a><a
              id="idm140170065965824"
              class="indexterm"></a><div
              class="para">
				<code
                class="command">dpkg</code> は Debian パッケージを取り扱うプログラムですから、バージョン番号の比較ロジックのリファレンス実装も提供します。このため、<code
                class="literal">--compare-versions</code> オプションがあり、外部プログラム (特に <code
                class="command">dpkg</code> 自身が呼び出す設定スクリプト) が使いやすいようになっています。このオプションは 3 つのパラメータを要求します: バージョン番号、比較演算子、2 番目のバージョン番号です。使える演算子は <code
                class="literal">lt</code> (より小さい)、<code
                class="literal">le</code> (以下)、<code
                class="literal">eq</code> (等しい)、<code
                class="literal">ne</code> (等しくない)、<code
                class="literal">ge</code> (以上)、<code
                class="literal">gt</code> (より大きい) です。比較が正しければ <code
                class="command">dpkg</code> は 0 (成功) を返します; 間違っていれば、非ゼロ (失敗) を返します。
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 gt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 1.2-3 lt 1.1-4</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1
$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">1</code></pre><div
              class="para">
				一見 0 (成功) を返すように思われる最後の比較が 1 (失敗) を返した点に注意しましょう: <code
                class="command">dpkg</code> にとって、通常は事前リリースを意味する <code
                class="literal">pre</code> には特別な意味がありません、このプログラムはアルファベット文字を数字と同じ方法で (a &lt; b &lt; c ...)、アルファベット順に、比較します。このため、「<code
                class="literal">0pre3</code>」は「<code
                class="literal">0</code>」より大きいというわけです。パッケージのバージョン番号に事前リリースであるという意味を持たせたい場合、チルダ文字「<code
                class="literal">~</code>」を使ってください。
			</div><pre
              class="screen">
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --compare-versions 2.6.0~pre3-1 lt 2.6.0-1</code></strong>
<code
                class="computeroutput">$ </code><strong
                class="userinput"><code>echo $?</code></strong>
<code
                class="computeroutput">0</code></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170065947552"></a>5.4.4. <code
                    class="command">dpkg</code> のログファイル</h3></div></div></div><div
            class="para">
				<code
              class="command">dpkg</code> は <code
              class="filename">/var/log/dpkg.log</code> に作業のすべてを記録します。このログは極めて詳細です、なぜなら <code
              class="command">dpkg</code> がパッケージに対して行った操作の各段階すべてを詳しく記録しているからです。dpkg の挙動を追跡する方法を提供することに加えて、これはシステムの変化の歴史を保存するのに役立ちます: パッケージがインストールされたり更新された正確な日時を探すことが可能ですし、この情報は最近の挙動変化を理解するのに極めて便利です。加えて、すべてのバージョンが記録されていますから、注目しているパッケージの <code
              class="filename">changelog.Debian.gz</code> またはオンラインバグ報告と情報を簡単に照合できます。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.multi-arch"></a>5.4.5. マルチアーキテクチャサポート</h3></div></div></div><a
            id="idm140170065942144"
            class="indexterm"></a><a
            id="idm140170065941216"
            class="indexterm"></a><div
            class="para">
				すべての Debian パッケージは<code
              class="literal">Architecture</code> フィールドがあります。このフィールドでは、「<code
              class="literal">all</code>」(アーキテクチャに依存しないパッケージ) または対象のアーキテクチャの名前 (「amd64」、「armhf」、…) のどちらか一方を指定します。後者の場合、初期設定では、<code
              class="command">dpkg</code> は <code
              class="command">dpkg --print-architecture</code> で返されるホストのアーキテクチャと一致するアーキテクチャ向けのパッケージのインストールだけを受け入れます。
			</div><div
            class="para">
				この制約は、ユーザが異なるアーキテクチャ向けにコンパイルされたバイナリを使う羽目にならないようにしています。(一部の) コンピュータが複数のアーキテクチャのバイナリを実行できる場合、たとえば元から可能な場合 (「amd64」システムが「i386」バイナリを実行できる) やエミュレータを介す場合、を除けばこれが理想的です。
			</div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140170065936144"></a>5.4.5.1. マルチアーキテクチャの有効化</h4></div></div></div><div
              class="para">
					<code
                class="command">dpkg</code> のマルチアーキテクチャサポートのおかげで、ユーザは現在のシステムにインストール可能な「外来アーキテクチャ」を定義できます。これを行うには、以下に示す通り <code
                class="command">dpkg --add-architecture</code> を使ってください。関連して、<code
                class="command">dpkg --remove-architecture</code> は外来アーキテクチャのサポートを取り止めますが、取り止めたいアーキテクチャのパッケージが残っていた場合には失敗します。
				</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-architecture</code></strong>
<code
                class="computeroutput">amd64
# </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg -i gcc-4.9-base_4.9.1-19_armhf.deb</code></strong>
<code
                class="computeroutput">dpkg: アーカイブ gcc-4.9-base_4.9.1-19_armhf.deb の処理中にエラーが発生しました (--install):
 パッケージアーキテクチャ (armhf) がシステム (amd64) と一致しません
処理中にエラーが発生しました:
 gcc-4.9-base_4.9.1-19_armhf.deb
# </code><strong
                class="userinput"><code>dpkg --add-architecture armhf</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --add-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf
armel
# </code><strong
                class="userinput"><code>dpkg -i gcc-4.9-base_4.9.1-19_armhf.deb</code></strong>
<code
                class="computeroutput">以前に未選択のパッケージ gcc-4.9-base:armhf を選択しています。
(データベースを読み込んでいます ... 現在 86425 個のファイルとディレクトリがインストールされています。)
gcc-4.9-base_4.9.1-19_armhf.deb を展開する準備をしています ...
gcc-4.9-base:armhf (4.9.1-19) を展開しています...
gcc-4.9-base:armhf (4.9.1-19) を設定しています ...
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armhf</code></strong>
<code
                class="computeroutput">dpkg: エラー: データベースで現在使用中のアーキテクチャ 'armhf' を削除できません
# </code><strong
                class="userinput"><code>dpkg --remove-architecture armel</code></strong>
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>dpkg --print-foreign-architectures</code></strong>
<code
                class="computeroutput">armhf</code></pre><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>NOTE</em></span> APT のマルチアーキテクチャサポート</strong></p></div></div></div><div
                class="para">
					APT は dpkg が外来アーキテクチャをサポートするように設定されているかを自動的に検出し、更新作業中に対応する <code
                  class="filename">Packages</code> ファイルをダウンロードします。
				</div><div
                class="para">
					外来パッケージをインストールするには <code
                  class="command">apt-get install <em
                    class="replaceable">package</em>:<em
                    class="replaceable">architecture</em></code> を使ってください。
				</div></div><div
              class="sidebar"><div
                class="titlepage"><div><div><p
                      class="title"><strong><span
                          class="emphasis"><em>IN PRACTICE</em></span> amd64 上でプロプライエタリな i386 バイナリを使う</strong></p></div></div></div><div
                class="para">
					マルチアーキテクチャには複数の使用事例がありますが、特に人気の用例は、32 ビットバイナリ (i386) が 64 ビットシステム (amd64) で実行可能になる例です。その具体的理由は、複数の人気のプロプライエタリアプリケーション (たとえば Skype) が 32 ビット版しか提供していないからです。
				</div><div
                class="para">
					マルチアーキテクチャ以前、32 ビットアプリケーションを 64 ビットシステムで実行したければ、<span
                  class="pkg pkg">ia32-libs</span> をインストールすることで、システム内に人気の高いライブラリの 32 ビット版を持つ必要がありました。このパッケージは amd64 パッケージ内の 32 ビットライブラリを再パッケージ化した大規模なハックでした。
				</div><a
                id="idm140170065916096"
                class="indexterm"></a></div></div><div
            class="section"><div
              class="titlepage"><div><div><h4
                    class="title"><a
                      id="idm140170065914352"></a>5.4.5.2. マルチアーキテクチャ関連の変更</h4></div></div></div><div
              class="para">
					マルチアーキテクチャを実際に便利で使いやすいものにするためには、ライブラリを再パッケージ化しなければいけませんでした。さらに複数のコピー (対象の異なるアーキテクチャ) を同時にインストールできるようにするために、マルチアーキテクチャ専用のディレクトリにライブラリを移動しなければいけませんでした。このようにして更新されたパッケージには、このパッケージはアーキテクチャが違っても安全に同時インストールできること (そしてこのパッケージは自分と異なるアーキテクチャのパッケージの依存関係を満足することはできないこと) をパッケージ化システムに伝えるための「<code
                class="literal">Multi-Arch: same</code>」ヘッダフィールドが含まれていました。マルチアーキテクチャモードは Debian <span
                class="distribution distribution">Wheezy</span> で初登場しましたから、まだすべてのライブラリが変換されたわけではありません (<span
                class="pkg pkg">ia32-libs</span> に組み込まれていたライブラリはすべて変換されました)。
				</div><pre
              class="screen">
$ <strong
                class="userinput"><code>dpkg -s gcc-4.9-base</code></strong>
dpkg-query: エラー: --status は有効なパッケージ名を必要としますが、`gcc-4.9-base' はそうではありません: 1つ以上のインストール済み実体がある、あいまいなパッケージ名 'gcc-4.9-base' です

パッケージ照会についてのヘルプには、--help を使用してください。
$ <strong
                class="userinput"><code>dpkg -s gcc-4.9-base:amd64 gcc-4.9-base:armhf | grep ^Multi</code></strong>
Multi-Arch: same
Multi-Arch: same
$ <strong
                class="userinput"><code>dpkg -L libgcc1:amd64 |grep .so</code></strong>
/lib/x86_64-linux-gnu/libgcc_s.so.1
$ <strong
                class="userinput"><code>dpkg -S /usr/share/doc/gcc-4.9-base/copyright</code></strong>
gcc-4.9-base:amd64, gcc-4.9-base:armhf: /usr/share/doc/gcc-4.9-base/copyright</pre><div
              class="para">
					<code
                class="literal">Multi-Arch: same</code> パッケージの場合、自分の名前にアーキテクチャの限定詞を付けて明確に識別できるようにしなければいけないことは注目に値します。このようなパッケージはアーキテクチャが異なる同じパッケージ間でファイルを共有する可能性を持っています; <code
                class="command">dpkg</code> は、共有されたファイルはアーキテクチャが異なる同じパッケージ間であってもビット単位で一致する、ことを期待します。最後に重要なことですが、パッケージはアーキテクチャごとにバージョンが違ってはいけません。アーキテクチャが異なるパッケージも必ず同時にアップグレードされなければいけません。
				</div><div
              class="para">
					マルチアーキテクチャサポートによって、依存関係の取り扱い方法にいくつかの興味深い挑戦がなされました。あるパッケージの依存関係を満足させるためには、必要とされる側のパッケージは「<code
                class="literal">Multi-Arch: foreign</code>」と宣言されているか、依存パッケージ群の 1 つのパッケージとアーキテクチャが一致しているかのどちらか一方、を必要とします (依存関係解決処理中、アーキテクチャに依存しないパッケージはホストと同じアーキテクチャと仮定されます)。依存関係は <code
                class="literal"><em
                  class="replaceable">package</em>:any</code> 構文があれば、どんなアーキテクチャでも依存関係を満足できるように弱められましたが、外来パッケージを使ってこの構文で表記された依存関係を満足できるのは「<code
                class="literal">Multi-Arch: allowed</code>」と宣言されていた場合のみです。
				</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.source-package-structure.html"><strong>戻る</strong>5.3. ソースパッケージの構造</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.coexistence-with-other-packaging-systems.html"><strong>次へ</strong>5.5. 他のパッケージ化システムとの共存</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.manipulating-packages-with-dpkg.html">ar-MA</a></li><li><a
              href="../da-DK/sect.manipulating-packages-with-dpkg.html">da-DK</a></li><li><a
              href="../de-DE/sect.manipulating-packages-with-dpkg.html">de-DE</a></li><li><a
              href="../el-GR/sect.manipulating-packages-with-dpkg.html">el-GR</a></li><li><a
              href="../en-US/sect.manipulating-packages-with-dpkg.html">en-US</a></li><li><a
              href="../es-ES/sect.manipulating-packages-with-dpkg.html">es-ES</a></li><li><a
              href="../fa-IR/sect.manipulating-packages-with-dpkg.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.manipulating-packages-with-dpkg.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.manipulating-packages-with-dpkg.html">hr-HR</a></li><li><a
              href="../id-ID/sect.manipulating-packages-with-dpkg.html">id-ID</a></li><li><a
              href="../it-IT/sect.manipulating-packages-with-dpkg.html">it-IT</a></li><li><a
              href="../ja-JP/sect.manipulating-packages-with-dpkg.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.manipulating-packages-with-dpkg.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.manipulating-packages-with-dpkg.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.manipulating-packages-with-dpkg.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.manipulating-packages-with-dpkg.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.manipulating-packages-with-dpkg.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.manipulating-packages-with-dpkg.html">zh-CN</a></li></ul></div></body></html>
