<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">6.2. aptitude と apt-get コマンド</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="apt-get, apt-cache, aptitude, synaptic, sources.list, apt-cdrom" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="apt.html"
        title="第6章 保守と更新: APT ツール" /><link
        rel="prev"
        href="apt.html"
        title="第6章 保守と更新: APT ツール" /><link
        rel="next"
        href="sect.apt-cache.html"
        title="6.3. apt-cache コマンド" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ja-JP/sect.apt-get.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.apt-get"></a>6.2. <code
                  class="command">aptitude</code> と <code
                  class="command">apt-get</code> コマンド</h2></div></div></div><a
          id="idm140393327787840"
          class="indexterm"></a><a
          id="idm140393327786720"
          class="indexterm"></a><div
          class="para">
			APT は巨大なプロジェクトで、当初の予定ではグラフィカルインターフェースを含んでいました。APT はライブラリに基づいており、ライブラリにはコアアプリケーションが含まれています。<code
            class="command">apt-get</code> は最初のフロントエンド - コマンドラインベース - で、APT プロジェクト内で開発されました。
		</div><div
          class="para">
			外部プロジェクトから、数多くのグラフィカルインターフェースが生まれました: <code
            class="command">synaptic</code>、<code
            class="command">aptitude</code> (テキストとグラフィカルモードインターフェース - まだ完成していません- の両方を含んでいます)、<code
            class="command">wajig</code> などです。最も推奨されるインターフェースは Debian のインストール中に使われる <code
            class="command">apt-get</code> で、この節ではこれを例に使います。<code
            class="command">aptitude</code> のコマンドライン構文はよく似ていることに注意してください。<code
            class="command">apt-get</code> と <code
            class="command">aptitude</code> に大きな違いがある場合は、違いを詳しく述べます。
		</div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140393327780112"></a>6.2.1. 初期設定</h3></div></div></div><div
            class="para">
				APT を使う作業では、事前に利用可能なパッケージのリストを更新しなければいけません; これを行うには <code
              class="command">apt-get update</code> を使ってください。ネットワークのスピードに依存しますが、この操作には少し時間がかかります。なぜなら、<code
              class="filename">Packages</code>/<code
              class="filename">Sources</code>/<code
              class="filename">Translation-<em
                class="replaceable">language-code</em></code> などのファイルをダウンロードするからです。これらのファイルは Debian の開発が進むにつれて徐々に大きくなります (<code
              class="literal">main</code> セクションの場合、データのサイズは少なく見積もっても 10 MB です)。もちろん CD-ROM セットからインストールする場合はダウンロードに時間は必要ありません - この場合、操作はとても速くなります。
			</div><a
            id="idm140393327775456"
            class="indexterm"></a><a
            id="idm140393327774336"
            class="indexterm"></a></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140393327773056"></a>6.2.2. インストールと削除</h3></div></div></div><a
            id="idm140393327772288"
            class="indexterm"></a><a
            id="idm140393327770848"
            class="indexterm"></a><a
            id="idm140393327769408"
            class="indexterm"></a><a
            id="idm140393327768000"
            class="indexterm"></a><div
            class="para">
				APT を使うと、システムからパッケージを追加したり削除したりできます。それぞれの操作は <code
              class="command">apt-get install <em
                class="replaceable">package</em></code> と <code
              class="command">apt-get remove <em
                class="replaceable">package</em></code> のようにして行います。どちらの場合も APT は自動的に、追加するパッケージの動作に必要なパッケージをインストールし、削除するパッケージの動作に必要だったパッケージを削除します。<code
              class="command">apt-get purge <em
                class="replaceable">package</em></code> コマンドを実行すれば完全にアンインストール、設定ファイルも削除、します。
			</div><a
            id="idm140393327763744"
            class="indexterm"></a><a
            id="idm140393327762624"
            class="indexterm"></a><a
            id="idm140393327761504"
            class="indexterm"></a><a
            id="idm140393327760384"
            class="indexterm"></a><a
            id="idm140393327759264"
            class="indexterm"></a><a
            id="idm140393327758144"
            class="indexterm"></a><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> パッケージを同じように選択してインストール</strong></p></div></div></div><div
              class="para">
				複数のコンピュータで同じパッケージ群を体系的にインストールするのは便利です。これは簡単にできます。
			</div><div
              class="para">
				最初に、コンピュータにインストールされたパッケージのリストを取得します。これを「ひな形」とします。
			</div><pre
              class="screen"><code
                class="computeroutput">$ </code><strong
                class="userinput"><code>dpkg --get-selections &gt;pkg-list</code></strong></pre><div
              class="para">
				<code
                class="filename">pkg-list</code> ファイルはインストールされたパッケージのリストです。次に、パッケージ群をインストールしたいコンピュータに <code
                class="filename">pkg-list</code> ファイルを移動し、以下のコマンドを実行します:
			</div><pre
              class="screen">## Update dpkg's database of known packages
# <strong
                class="userinput"><code>avail=`mktemp`</code></strong>
# <strong
                class="userinput"><code>apt-cache dumpavail &gt; "$avail"</code></strong>
# <strong
                class="userinput"><code>dpkg --merge-avail "$avail"</code></strong>
# <strong
                class="userinput"><code>rm -f "$avail"</code></strong>
## Update dpkg's selections
# <strong
                class="userinput"><code>dpkg --set-selections &lt; pkg-list</code></strong>
## Ask apt-get to install the selected packages
# <strong
                class="userinput"><code>apt-get dselect-upgrade</code></strong></pre><div
              class="para">
				最初のコマンド群で dpkg データベースで利用可能なパッケージのリストを記録し、<code
                class="command">dpkg --set-selections</code> でインストールしたいパッケージ群を選択し、<code
                class="command">apt-get</code> でインストール作業を実行します。<code
                class="command">aptitude</code> にこのコマンドはありません。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 同時に削除とインストールを行う</strong></p></div></div></div><div
              class="para">
				<code
                class="command">apt-get</code> (または <code
                class="command">aptitude</code>) を使ってパッケージのインストールと削除を同時に命令するには、パッケージ名の末尾にサフィックスを付け加えます。<code
                class="command">apt-get install</code> コマンドで、パッケージ名の末尾に「<code
                class="literal">-</code>」をつけると、削除。<code
                class="command">apt-get remove</code> コマンドで、パッケージ名の末尾に「<code
                class="literal">+</code>」をつけるとインストールになります。
			</div><div
              class="para">
				次の例は <em
                class="replaceable">package1</em> をインストール、<em
                class="replaceable">package2</em> を削除する 2 種類の方法です。
			</div><pre
              class="screen"># <strong
                class="userinput"><code>apt-get install <em
                    class="replaceable">package1</em> <em
                    class="replaceable">package2-</em></code></strong>
[...]
# <strong
                class="userinput"><code>apt-get remove <em
                    class="replaceable">package1+</em> <em
                    class="replaceable">package2</em></code></strong>
[...]</pre><div
              class="para">
				これは例えば <code
                class="literal">Recommends</code> に指定されているなどの原因でインストールされてしまうパッケージを除外するために使う事も可能です。一般に、依存関係ソルバは代替解決策を探すための手掛かりとしてこの情報を使います。
			</div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt-get --reinstall</code> と <code
                        class="command">aptitude reinstall</code></strong></p></div></div></div><a
              id="idm140393327734736"
              class="indexterm"></a><div
              class="para">
				システムはパッケージ中のファイルが削除されたり変更されたりした後に被害を受ける場合があります。これらのファイルを再取得する最も簡単な方法は、影響を受けたパッケージを再インストールする事です。残念なことに、パッケージ化システムはパッケージが既にインストール済みで、再インストールできない事を丁寧に教えてくれます; これを避けるために、<code
                class="command">apt-get</code> コマンドの <code
                class="literal">--reinstall</code> オプションを使います。以下は、既にインストール済みでも <span
                class="pkg pkg">postfix</span> を再インストールするコマンドです:
			</div><pre
              class="screen"><code
                class="computeroutput"># </code><strong
                class="userinput"><code>apt-get --reinstall install postfix</code></strong></pre><div
              class="para">
				<code
                class="command">aptitude</code> のコマンドラインは少し違いますが、<code
                class="command">aptitude reinstall postfix</code> で同じ結果を得られます。
			</div><div
              class="para">
				この問題は <code
                class="command">dpkg</code> を使えば起こりませんが、管理者がこのプログラムを直接使うことはまれです。
			</div><div
              class="para">
				注意してください! 攻撃を受けている最中に、変更されたパッケージを修復する目的で <code
                class="command">apt-get --reinstall</code> を使っても、システムを以前の状態に回復することは絶対に不可能でしょう。不正侵入を受けたシステムでパッケージを修復するために必要な手順の詳細は<a
                class="xref"
                href="sect.dealing-with-compromised-machine.html">「不正侵入されたマシンの取り扱い」</a>を参照してください。
			</div></div><div
            class="para">
				<code
              class="filename">sources.list</code> が複数のディストリビューションを参照しているのなら、パッケージのバージョンを指定してインストールする事も可能です。特定のバージョンを指定するには、<code
              class="command">apt-get install <em
                class="replaceable">package</em>=<em
                class="replaceable">version</em></code> を使いますが、<code
              class="command">apt-get install <em
                class="replaceable">package</em>/<em
                class="replaceable">distribution</em></code> のようにして、ディストリビューション (<span
              class="distribution distribution">安定版</span>、<span
              class="distribution distribution">テスト版</span>、<span
              class="distribution distribution">不安定版</span>) を指定するやり方のほうが通常好まれます。<code
              class="filename">sources.list</code> ファイルに書かれたどこかのソースから古いバージョンをまだ入手できるなら、このコマンドを使ってパッケージを古いバージョンに戻す事が可能です (例えば古いバージョンが上手く動作すると知っている場合など)。そうでないなら、<code
              class="literal">snapshot.debian.org</code> アーカイブを使ってください (傍注<a
              class="xref"
              href="apt.html#sidebar.snapshot.debian.org"><span
                class="emphasis"><em>GOING FURTHER</em></span> 古いパッケージバージョン: <code
                class="literal">snapshot.debian.org</code></a>参照)。
			</div><div
            class="example"><a
              id="idm140393327717824"></a><p
              class="title"><strong>例6.3 <span
                  class="pkg pkg">spamassassin</span> の<span
                  class="distribution distribution">不安定版</span>バージョンをインストール</strong></p><div
              class="example-contents"><pre
                class="screen"><code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>apt-get install spamassassin/unstable</code></strong></pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>GOING FURTHER</em></span> <code
                        class="filename">.deb</code> ファイルのキャッシュ</strong></p></div></div></div><div
              class="para">
				APT はダウンロード済み <code
                class="filename">.deb</code> ファイルのコピーを <code
                class="filename">/var/cache/apt/archives/</code> ディレクトリに保存します。頻繁に更新をする場合、パッケージの複数のバージョンが保存されるためこのディレクトリは多くのディスク領域を消費します; 日常的にこのディレクトリの内容を調べたほうがよいでしょう。2 つのコマンドが使えます: <code
                class="command">apt-get clean</code> はこのディレクトリを完全に空にします; <code
                class="command">apt-get autoclean</code> は (Debian ミラーから削除されたために) もはやダウンロードできない、明らかに無駄なパッケージだけを削除します (設定パラメータ <code
                class="literal">APT::Clean-Installed</code> を使って現在インストール済みパッケージの <code
                class="filename">.deb</code> は削除しないようにする事も可能です)。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-upgrade"></a>6.2.3. システムのアップグレード</h3></div></div></div><a
            id="idm140393327707648"
            class="indexterm"></a><a
            id="idm140393327706240"
            class="indexterm"></a><a
            id="idm140393327705120"
            class="indexterm"></a><div
            class="para">
				最新のセキュリティ更新を入手するために、定期的にアップグレードする事をお勧めします。アップグレードするには、(もちろん <code
              class="command">apt-get update</code> を実行した後で) <code
              class="command">apt-get upgrade</code> または <code
              class="command">aptitude safe-upgrade</code> を実行してください。このコマンドは他のパッケージを削除せずにアップグレード可能なインストール済みパッケージを探します。言い換えれば、最低限可能なアップグレードを行います。<code
              class="command">apt-get</code> のアップグレードパッケージの選択ルールは <code
              class="command">aptitude</code> よりも少し条件が厳しいです。これは <code
              class="command">apt-get</code> は既にインストール済みのパッケージだけをアップグレードするからです。
			</div><div
            class="sidebar"><a
              id="sidebar.apt-pdiff"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> 増分アップグレード</strong></p></div></div></div><div
              class="para">
				先に説明したとおり、<code
                class="command">apt-get update</code> コマンドは、複数のパッケージソースから適当な <code
                class="filename">Packages</code> (または <code
                class="filename">Sources</code>) ファイルをダウンロードします。しかしながら、これらのファイルのサイズは <code
                class="command">bzip2</code> 圧縮してもまだ大きいです (<span
                class="distribution distribution">Jessie</span> の <span
                class="foreignphrase"><em
                  class="foreignphrase">main</em></span> セクションの <code
                class="filename">Packages.xz</code> は 6 MB 以上です)。日常的にアップグレードしたい場合、ダウンロードに時間がかかるという事です。
			</div><div
              class="para">
				APT は作業を高速に進めるために、ファイル全体をダウンロードするのではなく、前回の更新以降の変更を含む「差分」をダウンロードします。これを実現するために、公式の Debian ミラーはある時点の <code
                class="filename">Packages</code> ファイルとそれ以降の時点の差分を含むファイルを配布します。差分はアーカイブが更新されるたびに生成され、1 週間につき 1 つが残されます。それぞれの「差分」ファイルは<span
                class="distribution distribution">不安定版</span>の場合でもたった数十キロバイトです。そうすれば毎週 <code
                class="command">aptitude update</code> を実行する場合にダウンロードされるデータ量は通常 10 分の 1 です。より変更頻度が低い <span
                class="distribution distribution">安定版</span>や<span
                class="distribution distribution">テスト版</span>などのディストリビューションについては、その増加はより顕著です。
			</div><div
              class="para">
				しかしながら、特に最後のアップグレードが長い時間が経っている場合や増分差分の効果が薄い場合、<code
                class="filename">Packages</code> ファイルの全体を強制的にダウンロードしたいと思うかもしれません。これはまた、ネットワークがとても高速でマシンの処理がかなり遅い場合に興味深いです。なぜなら、ダウンロードによって節約される時間の方がコンピュータがファイルの新しいバージョンを計算する時間 (古いバージョンにダウンロードされた差分を連結していく時間) のほうが長いからです。こうするには、設定パラメータ <code
                class="literal">Acquire::Pdiffs</code> を <code
                class="literal">false</code> に設定してください。
			</div></div><div
            class="para">
				通常 <code
              class="command">apt-get</code> は最新のバージョン (<span
              class="distribution distribution">実験版</span> と <span
              class="distribution distribution">安定版バックポート</span> のパッケージは除きます。これらは普通バージョン番号にかかわらず無視されます) を選択します。<code
              class="filename">sources.list</code> の中で<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>を指定した場合、<code
              class="command">apt-get upgrade</code> は<span
              class="distribution distribution">安定版</span>システムのほとんどを<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>に変更します。これはあなたが望んでいないことかもしれません。
			</div><div
            class="para">
				<code
              class="command">apt-get</code> がアップグレードされたパッケージを検索する際に特定のディストリビューションを検索させるには、ディストリビューションの名前を後ろにつけて <code
              class="literal">-t</code> または <code
              class="literal">--target-release</code> オプションを使ってください (例: <code
              class="command">apt-get -t stable upgrade</code>)。<code
              class="command">apt-get</code> を使う時に毎回このオプションを指定するのを避けるには、<code
              class="filename">/etc/apt/apt.conf.d/local</code> ファイルに <code
              class="literal">APT::Default-Release "stable";</code> を追加してください。
			</div><a
            id="idm140393327675904"
            class="indexterm"></a><a
            id="idm140393327674784"
            class="indexterm"></a><a
            id="idm140393327673664"
            class="indexterm"></a><div
            class="para">
				より重要なアップグレード、例えば Debian のメジャーバージョンから次バージョンに変更するなどの場合、<code
              class="command">apt-get dist-upgrade</code> (「ディストリビューションアップグレード」) を使ってください。この命令で、アップグレード伴う新しい依存関係で時代遅れのパッケージを削除することになったとしても、<code
              class="command">apt-get</code> はアップグレードを完了します。この命令はまた Debian <span
              class="distribution distribution">不安定版</span> リリースを日常的に使い、毎日開発進化についていくユーザが使うコマンドです。これは説明がほとんど必要ないくらいとても単純です: APT の評判はこの偉大なる機能性が担っています。
			</div><div
            class="para">
				<code
              class="command">aptitude full-upgrade</code> は <code
              class="command">aptitude</code> で上の命令に対応するコマンドですが、<code
              class="command">dist-upgrade</code> も認識されます (将来廃止予定です)。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-config"></a>6.2.4. 設定オプション</h3></div></div></div><a
            id="idm140393327666496"
            class="indexterm"></a><a
            id="idm140393327665056"
            class="indexterm"></a><a
            id="idm140393327663936"
            class="indexterm"></a><div
            class="para">
				既に説明した設定項目に加えて、<code
              class="filename">/etc/apt/apt.conf.d/</code> ディレクトリにファイルを追加して APT の特定の機能を設定できます。例えば、APT に <code
              class="command">dpkg</code> がファイルの衝突によるエラーを無視するよう設定するには、<code
              class="literal">DPkg::Options { "--force-overwrite"; }</code> を指定してください。
			</div><div
            class="para">
				プロキシを介さないとウェブにアクセスできないのなら、<code
              class="literal">Acquire::http::proxy "http://<em
                class="replaceable">yourproxy</em>:3128"</code> の行を追加してください。FTP プロキシは <code
              class="literal">Acquire::ftp::proxy "ftp://<em
                class="replaceable">yourproxy</em>"</code> のように追加してください。より多くの設定オプションを確認するには、<code
              class="command">man apt.conf</code> コマンドで <span
              class="citerefentry"><span
                class="refentrytitle">apt.conf</span>(5)</span> マニュアルページをご覧ください (マニュアルページの詳細は<a
              class="xref"
              href="solving-problems.html#sect.manual-pages">「マニュアルページ」</a>をご覧ください)。
			</div><div
            class="sidebar"><a
              id="sidebar.directory.d"></a><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> <code
                        class="filename">.d</code> で終わるディレクトリ</strong></p></div></div></div><a
              id="idm140393327654400"
              class="indexterm"></a><div
              class="para">
				名前に <code
                class="filename">.d</code> サフィックスが付けられたディレクトリは頻繁に使われます。それぞれのディレクトリは複数ファイルに渡って分割された設定ファイルを表しています。この意味において、<code
                class="filename">/etc/apt/apt.conf.d/</code> 内のすべてのファイルには APT に対する設定が含まれています。APT はこれらをアルファベット順に読み込みます。つまり、読み込まれる順番が遅いファイルの設定が早いファイルの設定を上書きするという事です。
			</div><div
              class="para">
				この体制により、マシンの管理者とパッケージメンテナは設定にいくつかの自由度を持つ事が可能です。実際、管理者はソフトウェアの設定を、出来合いのファイルをこのディレクトリに追加することによって、既存のファイルを編集せずに、簡単に修正できます。パッケージメンテナはこれと同じやり方で、自分のパッケージと上手に共存させながら、他のソフトウェアの設定を変更します。他のパッケージが提供する設定ファイルを変更することは Debian ポリシーによって禁止されています - 変更できるのはユーザだけです。パッケージのアップグレード中に設定ファイルの変更が検出されたら、ユーザは設定ファイルのどのバージョンを保存するか聞かれる事を忘れないでください。外部から設定ファイルが変更されれば必ず聞かれます。これは何も変えたくない管理者にとって煩わしいでしょう。
			</div><div
              class="para">
				<code
                class="filename">.d</code> ディレクトリが無い場合、設定ファイルを提供するパッケージ以外が、その設定ファイルを書き換えずにプログラムの設定を変更するのは不可能です。その代わり、ユーザに自分で設定ファイルを書き換えるよう案内し、そのやり方を <code
                class="filename">/usr/share/doc/<em
                  class="replaceable">package</em>/README.Debian</code> ファイルに記載しなければいけません。
			</div><div
              class="para">
				アプリケーションに依存しますが、<code
                class="filename">.d</code> ディレクトリは直接またはすべてのファイルを連結して設定ファイルを作成する外部スクリプトを介して使われます。最新の変更を反映させるため、ディレクトリ内のファイルを変更した後にスクリプトを実行する事が重要です。同様に、自動的に生成された設定ファイルを直接編集しない事が重要です。なぜなら、スクリプトを実行すれば生成された設定ファイルに行ったすべての変更が失われるからです。どちらの方法をとるか (<code
                class="filename">.d</code> ディレクトリを直接使うかディレクトリからファイルを生成するか) は通常実装に依存します。しかし、どちらの場合でも設定の柔軟性が増えるのに対して、設定の複雑さは少ししか増加しません。Exim 4 メールサーバはファイルを生成する方針をとるアプリケーションの例です: ファイル (<code
                class="filename">/etc/exim4/conf.d/*</code>) に設定を書き込み、<code
                class="command">update-exim4.conf</code> コマンドがこれらを連結して <code
                class="filename">/var/lib/exim4/config.autogenerated</code> を生成します。
			</div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt.priorities"></a>6.2.5. パッケージ優先度の管理</h3></div></div></div><div
            class="para">
				APT の設定で最も重要な側面の 1 つに各パッケージソースに対する優先度の管理があります。例えば、<span
              class="distribution distribution">テスト版</span>、<span
              class="distribution distribution">不安定版</span>、<span
              class="distribution distribution">実験版</span>から入手できる新しいパッケージを 1 つか 2 つあるディストリビューションにインストールしたいと思うかもしれません。利用可能なパッケージに対して優先度を割り当てる事が可能です (同じパッケージに対してバージョンやそれを提供しているディストリビューションに依存する異なる優先度を設定する事も可能です)。優先度の設定は APT の挙動に影響を与えます: 各パッケージについて、APT は常に最も優先度の高いバージョンをインストールします (例外は、最も優先度の高いバージョンがインストール済みのバージョンよりも古い場合か 1000 より低い優先順位を持っている場合です)。
			</div><a
            id="idm140393327638656"
            class="indexterm"></a><a
            id="idm140393327637056"
            class="indexterm"></a><a
            id="idm140393327636096"
            class="indexterm"></a><a
            id="idm140393327634656"
            class="indexterm"></a><a
            id="idm140393327633248"
            class="indexterm"></a><a
            id="idm140393327631808"
            class="indexterm"></a><a
            id="idm140393327630688"
            class="indexterm"></a><div
            class="para">
				APT はいくつかのデフォルト優先度を定義しています。インストール済みパッケージのバージョンは優先度 100 です。インストールされていないパッケージのバージョンはデフォルトで優先度 500 ですが、ターゲットリリース (<code
              class="literal">-t</code> コマンドラインオプションか <code
              class="literal">APT::Default-Release</code> の設定ディレクティブによって定義します) に含まれるバージョンの場合、優先度 990 になります。
			</div><div
            class="para">
				優先度を変更するには、<code
              class="filename">/etc/apt/preferences</code> ファイルに、影響を受けるパッケージの名前、バージョン、パッケージの提供者、新しい優先度を指定するエントリを追加してください。
			</div><div
            class="para">
				APT は優先度が 1000 より高い場合を除いて、パッケージの古いバージョン (言い換えれば、現在インストールされているバージョンよりバージョン番号が低いパッケージ) をインストールしません。APT は常にこの制限に基づいて最も高い優先度のパッケージをインストールします。2 つのバージョンが同じ優先度の場合、APT は最新の (バージョン番号が最も高い) バージョンをインストールします。バージョンと優先度が同じで、パッケージの内容が異なる場合、APT はインストールされていないバージョンをインストールします (このルールはあるパッケージがリビジョン番号を変化させずに更新された場合に対応させるために作られました。通常は増加させなければいけません)。
			</div><div
            class="para">
				より具体的に言えば、優先度が 0 より低いパッケージは決してインストールされません。0 から 100 までの優先度を持つパッケージは、パッケージの他のバージョンがインストール済みでない場合にだけ、インストールされます。100 から 500 までの優先度を持つパッケージは、インストール済みのバージョンに新しいものが存在しないか、他のディストリビューションに利用可能なバージョンが存在する場合にだけ、インストールされます。501 から 990 までの優先度を持つパッケージは、インストール済みのバージョンに新しいものが存在しないか、ターゲットディストリビューションに利用可能なバージョンが存在する場合にだけ、インストールされます。990 から 1000 までの優先度を持つパッケージは、インストール済みバージョンが古い場合に、インストールされます。1000 より大きい優先度を持つパッケージは、古いバージョンにダウングレードすることになったとしても、常にインストールされます。
			</div><div
            class="para">
				APT が <code
              class="filename">/etc/apt/preferences</code> の設定を評価する際、最初に具体的なエントリ (該当するパッケージに関連するエントリ)、その後に一般的なエントリ (例えばあるディストリビューションのすべてのパッケージを含めたものなど) を評価します。一般的なエントリが複数存在する場合、最初にマッチしたものを使います。利用可能な選択基準には、パッケージの名前とパッケージを配布しているパッケージソースが含まれます。各パッケージソースは APT が <code
              class="filename">Packages</code> と一緒にダウンロードする <code
              class="filename">Release</code> ファイルに含まれる情報によって区別されます。このファイルは提供者 (公式ミラーのパッケージの場合、通常「Debian」ですが、人名やサードパーティリポジトリの組織名になる場合もあります) を規定しています。また、このファイルはディストリビューションの名前 (Debian の提供する標準的ディストリビューションの場合、通常 <span
              class="distribution distribution">安定版</span>、<span
              class="distribution distribution">テスト版</span>、<span
              class="distribution distribution">不安定版</span>、<span
              class="distribution distribution">実験版</span>) とバージョン (例えば Debian <span
              class="distribution distribution">Lenny</span> なら 5.0) を規定しています。このメカニズムの実際のケーススタディを通じて、構文を見てみましょう。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>SPECIFIC CASE</em></span> <span
                        class="distribution distribution">実験版</span> の優先度</strong></p></div></div></div><a
              id="idm140393327614752"
              class="indexterm"></a><div
              class="para">
				<span
                class="distribution distribution">実験版</span>を <code
                class="filename">sources.list</code> ファイルに含めても対応するパッケージは決してインストールされません。なぜなら優先度が 1 だからです。これはもちろん特別な場合で、誤って<span
                class="distribution distribution">実験版</span>のパッケージをインストールするのを避けるためこうなっています。パッケージをインストールする唯一の方法は <code
                class="command">aptitude install <em
                  class="replaceable">package</em>/experimental</code> と実行する事です - このコマンドを実行するユーザは嫌でもリスクをとることに気付くでしょう。<span
                class="distribution distribution">実験版</span> のパッケージの優先度を 500 にして他のディストリビューションのパッケージと同列に扱う事も (推奨<span
                class="emphasis"><em>しません</em></span>が) 不可能ではありません。こうするには <code
                class="filename">/etc/apt/preferences</code> に以下のエントリを含めてください:
			</div><div
              class="informalexample"><pre
                class="programlisting">Package: *
Pin: release a=experimental
Pin-Priority: 500</pre></div></div><div
            class="para">
				Debian の安定版バージョンからのパッケージだけを使いたいと仮定しましょう。他のバージョンから提供されるパッケージは、はっきりと要求されない限り、インストールされるべきではありません。この場合、<code
              class="filename">/etc/apt/preferences</code> ファイルに以下のエントリを書きます:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: *
Pin: release a=stable
Pin-Priority: 900

Package: *
Pin: release o=Debian
Pin-Priority: -10</pre></div><div
            class="para">
				<code
              class="literal">a=stable</code> で選択するディストリビューションの名前を定義します。<code
              class="literal">o=Debian</code> で提供者が「Debian」のパッケージに範囲を限定します。
			</div><div
            class="para">
				さてここで、サーバには Perl バージョン 5.14 に依存するローカルプログラムがあり、アップグレードによって他のバージョンがインストールされない事を保証したいと仮定しましょう。この場合、以下のエントリを使います:
			</div><div
            class="informalexample"><pre
              class="programlisting">Package: perl
Pin: version 5.14*
Pin-Priority: 1001</pre></div><div
            class="para">
				マニュアルページ <span
              class="citerefentry"><span
                class="refentrytitle">apt_preferences</span>(5)</span> にはこの設定ファイルに対する関連文書があり、<code
              class="command">man apt_preferences</code> で表示できます。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="filename">/etc/apt/preferences</code> 内のコメント</strong></p></div></div></div><a
              id="idm140393327597296"
              class="indexterm"></a><a
              id="idm140393327596176"
              class="indexterm"></a><a
              id="idm140393327595056"
              class="indexterm"></a><div
              class="para">
				<code
                class="filename">/etc/apt/preferences</code> ファイルにコメントを記入する正しいやり方はありませんが、それぞれのエントリの前の行に「<code
                class="literal">Explanation</code>」フィールドをつけるとテキスト説明を記入できます。
			</div><div
              class="informalexample"><pre
                class="programlisting">Explanation: The package xserver-xorg-video-intel provided
Explanation: in experimental can be used safely
Package: xserver-xorg-video-intel
Pin: release a=experimental
Pin-Priority: 500</pre></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.apt-mix-distros"></a>6.2.6. 複数ディストリビューションの利用</h3></div></div></div><div
            class="para">
				<code
              class="command">apt-get</code> はこのように素晴らしく、他のディストリビューションからパッケージを選ぶ際に力を発揮するツールです。例えば、<span
              class="distribution distribution">安定版</span>システムをインストールした後に<span
              class="distribution distribution">テスト版</span>や<span
              class="distribution distribution">不安定版</span>に収録されているあるソフトウェアのパッケージを試したいが、システムを最初の状態から大きく変更したくないという場合です。
			</div><div
            class="para">
				ディストリビューションの異なるパッケージを混在させると、時々問題に遭遇するかもしれませんが、<code
              class="command">apt-get</code> はパッケージを上手く共存させ、危険の及ぶ範囲を上手く限定します。進むべき最善の道は、<code
              class="filename">/etc/apt/sources.list</code> で使われているすべてのディストリビューションをリストアップ (常に 3 つのディストリビューションを使う人がいるかもしれませんが、<span
              class="distribution distribution">不安定版</span>は経験豊かなユーザ向けである事を忘れないでください) して、<code
              class="literal">APT::Default-Release</code> パラメータ (<a
              class="xref"
              href="sect.apt-get.html#sect.apt-upgrade">「システムのアップグレード」</a>参照) で基準ディストリビューションをを定義する事です。
			</div><div
            class="para">
				<span
              class="distribution distribution">安定版</span>が基準ディストリビューションと仮定しますが、併せて<span
              class="distribution distribution">テスト版</span>と<span
              class="distribution distribution">不安定版</span>も <code
              class="filename">sources.list</code> ファイルに書かれているとします。この場合、<span
              class="distribution distribution">テスト版</span> からのパッケージをインストールするには <code
              class="command">apt-get install <em
                class="replaceable">package</em>/testing</code> を使います。依存関係の解決に失敗してインストールできなかった場合、<code
              class="literal">-t testing</code> パラメータをつけて <span
              class="distribution distribution">テスト版</span>を使って依存関係を解決させる事が可能です。<span
              class="distribution distribution">不安定版</span>でも同じ事が言えます。
			</div><div
            class="para">
				この状況では、アップグレード (<code
              class="command">upgrade</code> と <code
              class="command">dist-upgrade</code>) は、他のディストリビューションでパッケージがアップグレードされていない限り、<span
              class="distribution distribution">安定版</span>のパッケージを使って終了します: 他のディストリビューションに利用可能な更新があれば、アップグレードします。以下では、APT によって設定されたデフォルト優先度の助けを借りてこの挙動を説明します。パッケージの優先度を確認するには、遠慮なく <code
              class="command">apt-cache policy</code> (傍注参照) を使ってください。
			</div><div
            class="para">
				APT はインストール済みのパッケージに比べてバージョンが高いか同じのパッケージだけを考慮するという事実を知れば、すべてを理解できます (ここでは <code
              class="filename">/etc/apt/preferences</code> の中に一部のパッケージに対して 1000 より高い優先度を強制する設定が無いと仮定します)。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> <code
                        class="command">apt-cache policy</code></strong></p></div></div></div><div
              class="para">
				優先度のメカニズムをさらに良く理解するためには、<code
                class="command">apt-cache policy</code> を実行し、各パッケージソースに対して設定されているデフォルトの優先度を確認して下さい。また、あるパッケージの利用可能なバージョンすべてに対する優先度を表示するために <code
                class="command">apt-cache policy <em
                  class="replaceable">package</em></code> を使う事も可能です。
			</div></div><div
            class="para">
				あるパッケージの、<span
              class="distribution distribution">安定版</span>から提供されるバージョン 1 がインストール済みで、<span
              class="distribution distribution">テスト版</span>と<span
              class="distribution distribution">不安定版</span>から提供されるバージョン 2 と 3 が利用可能と仮定しましょう。インストール済みバージョンの優先度は 100 ですが、<span
              class="distribution distribution">安定版</span>から提供されるバージョン (インストール済みと全く同じバージョン) の (ターゲットリリースから提供されるバージョンの) 優先度は 990 です。<span
              class="distribution distribution">テスト版</span>と<span
              class="distribution distribution">不安定版</span>から提供されるバージョンの優先度 (インストールされていないバージョンに対するデフォルト優先度) は 500 です。この場合、バージョン 1 が最も高い優先度 990 を持ちます。パッケージは「<span
              class="distribution distribution">安定版</span>のまま」です。
			</div><div
            class="para">
				<span
              class="distribution distribution">テスト版</span>から提供されるバージョン 2 がインストール済みの場合について見てみましょう。<span
              class="distribution distribution">安定版</span>から提供されるバージョン 1 と<span
              class="distribution distribution">不安定版</span>から提供されるバージョン 3 が利用可能です。バージョン 1 (優先度は 1000 より低く 990) は、インストール済みバージョンよりもバージョンが低いため、無視されます。残るのはバージョン 2 か 3 ですが、両方の優先度は 500 です。優先度をが同じ場合、APT は最も新しいバージョン、<span
              class="distribution distribution">不安定版</span>から提供されるバージョン、を選択します。<span
              class="distribution distribution">テスト版</span>から提供されたインストール済みバージョンを<span
              class="distribution distribution">不安定版</span>から提供されるバージョンに移行したくない場合、<span
              class="distribution distribution">不安定版</span>から提供されるバージョンに 500 よりも低い優先度 (例えば 490 など) を割り当てないといけません。これを行うには、<code
              class="filename">/etc/apt/preferences</code> を以下のように修正してください:
			</div><pre
            class="programlisting">Package: *
Pin: release a=unstable
Pin-Priority: 490</pre></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="sect.automatic-tracking"></a>6.2.7. 自動的にインストールされたパッケージの追跡</h3></div></div></div><div
            class="para">
				<code
              class="command">apt-get</code> の本質的な機能の 1 つに、依存関係によってのみインストールされたパッケージの追跡があります (当初これは <code
              class="command">aptitude</code> に固有の機能でした)。これらのパッケージは「自動」と呼ばれ、例えばライブラリなどがその一例です。
			</div><div
            class="para">
				あるパッケージを削除する際に、パッケージマネージャは、この追跡情報を元に、もはや不要になった自動パッケージ (「手作業でインストール」されていないパッケージ) を選び出す事ができる。不要になった自動パッケージを削除するには <code
              class="command">apt-get autoremove</code> を使います。<code
              class="command">aptitude</code> にはこのコマンドがありませんが、これは不要な自動パッケージは見つかり次第自動的に削除されるからです。どちらのプログラムでも、不要になったパッケージは分かりやすく表示されます。
			</div><a
            id="idm140393327548352"
            class="indexterm"></a><a
            id="idm140393327547232"
            class="indexterm"></a><a
            id="idm140393327546112"
            class="indexterm"></a><a
            id="idm140393327544992"
            class="indexterm"></a><div
            class="para">
				直接的に使うわけではないパッケージを自動パッケージとしてマークするのは良い癖です。こうすれば、そのパッケージがいらなくなった時に自動的に削除されます。<code
              class="command">apt-mark auto <em
                class="replaceable">package</em></code> はパッケージを自動パッケージとしてマークし、逆に <code
              class="command">apt-mark manual <em
                class="replaceable">package</em></code> は手動パッケージとしてマークします。<code
              class="command">aptitude markauto</code> と <code
              class="command">aptitude unmarkauto</code> は同様に動きますが、多くのパッケージを同時にマークする機能を持っています (<a
              class="xref"
              href="sect.apt-frontends.html#sect.aptitude">「<code
                class="command">aptitude</code>」</a>参照)。<code
              class="command">aptitude</code> のコンソールベース対話型インターフェースを使うと、多くのパッケージの「自動パッケージフラグ」を容易に確認できます。
			</div><a
            id="idm140393327539328"
            class="indexterm"></a><div
            class="para">
				自動的にインストールされたパッケージがシステムに存在する理由を知りたい場合があるかもしれません。この情報をコマンドラインから得るには、<code
              class="command">aptitude why <em
                class="replaceable">package</em></code> を使ってください (<code
              class="command">apt-get</code> に同様の機能はありません):
			</div><pre
            class="screen">$ <strong
              class="userinput"><code>aptitude why python-debian</code></strong>
i   aptitude         推奨 apt-xapian-index         
i A apt-xapian-index 依存 python-debian (&gt;= 0.1.15)
</pre><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>ALTERNATIVE</em></span> <code
                        class="command">deborphan</code> と <code
                        class="command">debfoster</code></strong></p></div></div></div><a
              id="idm140393327533376"
              class="indexterm"></a><a
              id="idm140393327532256"
              class="indexterm"></a><div
              class="para">
				<code
                class="command">apt-get</code> や <code
                class="command">aptitude</code> にまだ自動パッケージを追跡する機能が無かった時代、不要なパッケージをリストアップするユーティリティが 2 つありました: <code
                class="command">deborphan</code> と <code
                class="command">debfoster</code> です。
			</div><div
              class="para">
				<code
                class="command">deborphan</code> はもう一方と比べれば基礎的なツールです。これは単純に (他に指示の無い限り) <code
                class="literal">libs</code> と <code
                class="literal">oldlibs</code> セクションを調べ、現在インストール済みで他のどのパッケージからも必要とされていないパッケージを探します。この結果は必要無いパッケージを削除するための叩き台になります。
			</div><div
              class="para">
				<code
                class="command">debfoster</code> は APT とよく似たより複雑なアプローチを取ります: このプログラムは明示的にインストールされたパッケージのリストを保存し、毎回起動される度に本当に必要なパッケージを記録します。<code
                class="command">debfoster</code> が新しいパッケージをシステムに検出し、そのパッケージが必要か判らなかった場合、そのパッケージを依存関係のリストと一緒に画面に表示します。そして、選択肢を表示します: パッケージを削除する (そのパッケージが依存するパッケージも一緒に削除するかもしれません)、明示的に必要とマークする、一時的にこれを無視する。
			</div></div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="apt.html"><strong>戻る</strong>第6章 保守と更新: APT ツール</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.apt-cache.html"><strong>次へ</strong>6.3. apt-cache コマンド</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.apt-get.html">ar-MA</a></li><li><a
              href="../da-DK/sect.apt-get.html">da-DK</a></li><li><a
              href="../de-DE/sect.apt-get.html">de-DE</a></li><li><a
              href="../el-GR/sect.apt-get.html">el-GR</a></li><li><a
              href="../en-US/sect.apt-get.html">en-US</a></li><li><a
              href="../es-ES/sect.apt-get.html">es-ES</a></li><li><a
              href="../fa-IR/sect.apt-get.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.apt-get.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.apt-get.html">hr-HR</a></li><li><a
              href="../id-ID/sect.apt-get.html">id-ID</a></li><li><a
              href="../it-IT/sect.apt-get.html">it-IT</a></li><li><a
              href="../ja-JP/sect.apt-get.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.apt-get.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.apt-get.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.apt-get.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.apt-get.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.apt-get.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.apt-get.html">zh-CN</a></li></ul></div></body></html>
