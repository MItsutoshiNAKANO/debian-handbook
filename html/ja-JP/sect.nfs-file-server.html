<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">11.4. NFS ファイルサーバ</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.1" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="Postfix, Apache, NFS, Samba, Squid, OpenLDAP" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="network-services.html"
        title="第11章 ネットワークサービス: Postfix、Apache、NFS、Samba、Squid、LDAP" /><link
        rel="prev"
        href="sect.ftp-file-server.html"
        title="11.3. FTP ファイルサーバ" /><link
        rel="next"
        href="sect.windows-file-server-with-samba.html"
        title="11.5. Samba を使った Windows 共有のセットアップ" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ja-JP/sect.nfs-file-server.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.nfs-file-server"></a>11.4. NFS ファイルサーバ</h2></div></div></div><div
          class="para">
			NFS (<span
            class="emphasis"><em>Network File System</em></span>) はネットワークを介したファイルシステムへのリモートアクセスをつかさどるプロトコルです。すべての Unix システムは NFS プロトコルを取り扱うことが可能です; Windows システムを参加させる場合、代わりに Samba を使わなければいけません。
		</div><a
          id="idm140170051853152"
          class="indexterm"></a><a
          id="idm140170051852192"
          class="indexterm"></a><a
          id="idm140170051850432"
          class="indexterm"></a><a
          id="idm140170051849024"
          class="indexterm"></a><a
          id="idm140170051847584"
          class="indexterm"></a><div
          class="para">
			NFS はとても便利なツールですが、特にセキュリティ問題を気にする場合、NFS の欠点に注意しなければいけません; ネットワークを通過するすべてのデータは平文です (<span
            class="emphasis"><em>スニファ</em></span> を使えば内容を傍受することが可能です); サーバはクライアントの IP アドレス (これはなりすまし可能です) に基づくアクセス制限を強制します; そして最後に、クライアントマシンが正しく設定されていない NFS 共有にアクセスを許可された場合、クライアントの root ユーザは共有されている全ファイル (他のユーザに所属するファイル) にアクセスすることが可能です。なぜなら、NFS サーバはクライアントから受け取ったユーザ名を信用する (これは NFS プロトコルの歴史的な制限) からです。
		</div><div
          class="sidebar"><div
            class="titlepage"><div><div><p
                  class="title"><strong><span
                      class="emphasis"><em>DOCUMENTATION</em></span> NFS HOWTO</strong></p></div></div></div><div
            class="para">
			NFS HOWTO は比較的古い文書ですが、性能の最適化方法などの興味深い情報をたくさん載せています。さらに SSH トンネルを使って NFS を安全に使う方法を説明しています; しかしながら、SSH トンネルを使う場合 <code
              class="command">lockd</code> を使えなくなります。<div
              class="url">→ <a
                href="http://nfs.sourceforge.net/nfs-howto/">http://nfs.sourceforge.net/nfs-howto/</a></div>
		</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170051840944"></a>11.4.1. 安全な NFS</h3></div></div></div><a
            id="idm140170051840144"
            class="indexterm"></a><div
            class="para">
				NFS はネットワークから受け取った情報を信用するため、NFS の利用を許可されたマシンだけが種々の要求された RPC サーバに接続できるように制限することが不可欠です。ファイアウォールは外部のマシンが内部のマシンのように振る舞うことを避けるために <span
              class="emphasis"><em>IP なりすまし</em></span>をブロックし、NFS 共有にアクセスするように意図されたマシンだけが適切なポートにアクセスするように制限しなければいけません。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> RPC</strong></p></div></div></div><div
              class="para">
				RPC (<span
                class="emphasis"><em>Remote Procedure Call</em></span>) はリモートサービスに関する Unix 標準です。NFS は RPC サービスの 1 つです。
			</div><a
              id="idm140170051835056"
              class="indexterm"></a><a
              id="idm140170051834096"
              class="indexterm"></a><div
              class="para">
				ディレクトリに登録する RPC サービスは <span
                class="emphasis"><em>portmapper</em></span> としても知られています。NFS 問い合わせを実行することを望むクライアントは最初に <span
                class="emphasis"><em>portmapper</em></span> (ポート番号 111 番、TCP または UDP) を呼び出し、NFS サーバのポート番号を要求します; 通常ポート番号 2049 番 (NFS のデフォルト) が返されます。すべての RPC サービスが必ず固定されたポートで使われる必要があるわけではありません。
			</div></div><div
            class="para">
				最適な状態で NFS を使うには、<code
              class="command">rpc.mountd</code>、<code
              class="command">rpc.statd</code>、<code
              class="command">lockd</code> などの別の RPC サービスを必要とする場合があります。しかしながら、これらの RPC サービスはデフォルトで (<span
              class="emphasis"><em>portmapper</em></span> の割り当てた) ランダムなポートを使うため、対象のサービスに関するトラフィックをフィルタすることが難しくなります。Falcot Corp 管理者はこの問題に対する次善策を見つけました。以下のようなものです。
			</div><a
            id="idm140170051828160"
            class="indexterm"></a><a
            id="idm140170051827040"
            class="indexterm"></a><a
            id="idm140170051825920"
            class="indexterm"></a><a
            id="idm140170051824800"
            class="indexterm"></a><div
            class="para">
				上で挙げた <code
              class="command">rpc.mountd</code> と <code
              class="command">rpc.statd</code> はユーザ空間プログラムとして実装されており、それぞれ <code
              class="filename">/etc/init.d/nfs-kernel-server</code> と <code
              class="filename">/etc/init.d/nfs-common</code> を使って開始されます。どちらのプログラムも、ポートを強制するための設定オプションを備えています; 常に適用する設定オプションを変更するには、<code
              class="filename">/etc/default/nfs-kernel-server</code> と <code
              class="filename">/etc/default/nfs-common</code> を編集します。
			</div><a
            id="idm140170051820256"
            class="indexterm"></a><a
            id="idm140170051819136"
            class="indexterm"></a><a
            id="idm140170048476256"
            class="indexterm"></a><a
            id="idm140170048475360"
            class="indexterm"></a><div
            class="example"><a
              id="idm140170048474464"></a><p
              class="title"><strong>例11.23 <code
                  class="filename">/etc/default/nfs-kernel-server</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
# Number of servers to start up
RPCNFSDCOUNT=8

# Runtime priority of server (see nice(1))
RPCNFSDPRIORITY=0

# Options for rpc.mountd.
# If you have a port-based firewall, you might want to set up
# a fixed port here using the --port option. For more information, 
# see rpc.mountd(8) or http://wiki.debian.org/SecuringNFS
# To disable NFSv4 on the server, specify '--no-nfs-version 4' here
RPCMOUNTDOPTS="--manage-gids --port 2048"

# Do you want to start the svcgssd daemon? It is only required for Kerberos
# exports. Valid alternatives are "yes" and "no"; the default is "no".
NEED_SVCGSSD=

# Options for rpc.svcgssd.
RPCSVCGSSDOPTS=</pre></div></div><div
            class="example"><a
              id="idm140170048472400"></a><p
              class="title"><strong>例11.24 <code
                  class="filename">/etc/default/nfs-common</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
# If you do not set values for the NEED_ options, they will be attempted
# autodetected; this should be sufficient for most people. Valid alternatives
# for the NEED_ options are "yes" and "no".

# Do you want to start the statd daemon? It is not needed for NFSv4.
NEED_STATD=

# Options for rpc.statd.
#   Should rpc.statd listen on a specific port? This is especially useful
#   when you have a port-based firewall. To use a fixed port, set this
#   this variable to a statd argument like: "--port 4000 --outgoing-port 4001".
#   For more information, see rpc.statd(8) or http://wiki.debian.org/SecuringNFS
STATDOPTS="--port 2046 --outgoing-port 2047"

# Do you want to start the idmapd daemon? It is only needed for NFSv4.
NEED_IDMAPD=

# Do you want to start the gssd daemon? It is required for Kerberos mounts.
NEED_GSSD=</pre></div></div><div
            class="para">
				これらの変更を行った後、サービスを再起動すれば、<code
              class="command">rpc.mountd</code> はポート番号 2048 番を使うようになります; <code
              class="command">rpc.statd</code> はポート番号 2046 番をリッスンし、外向きの接続にポート番号 2047 番を使うようになります。
			</div><div
            class="para">
				<code
              class="command">lockd</code> サービスはカーネル<span
              class="emphasis"><em>スレッド</em></span> (軽量プロセス) によって取り扱われます; この機能は Debian カーネルのモジュールとしてビルドされています。このモジュールは常に同じポートを使うための 2 種類のオプション <code
              class="literal">nlm_udpport</code> と <code
              class="literal">nlm_tcpport</code> を取ります。これらのオプションを系統的に使うには、以下のような <code
              class="filename">/etc/modprobe.d/lockd</code> ファイルが必要です:
			</div><div
            class="example"><a
              id="idm140170048466176"></a><p
              class="title"><strong>例11.25 <code
                  class="filename">/etc/modprobe.d/lockd</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
options lockd nlm_udpport=2045 nlm_tcpport=2045</pre></div></div><div
            class="para">
				これらのパラメータを設定したら、ポート番号 111 番および 2045 番から 2049 番まで (UDP と TCP の両方) を使うアクセスをフィルタすることにより、きめ細かな設定をファイアウォールに適用し、NFS サービスへのアクセスを簡単に制御することが可能になります。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170048463888"></a>11.4.2. NFS サーバ</h3></div></div></div><div
            class="para">
				NFS サーバは Linux カーネルの一部です; Debian の提供するカーネルでは、NFS サーバをカーネルモジュールとしてビルドしています。NFS サーバを起動時に自動的に実行するには、<span
              class="pkg pkg">nfs-kernel-server</span> パッケージをインストールしてください; このパッケージには、対応する起動スクリプトが含まれます。
			</div><div
            class="para">
				NFS サーバ設定ファイル <code
              class="filename">/etc/exports</code> には、ネットワークを介して利用できるようにする (<span
              class="emphasis"><em>エクスポートされる</em></span>) ディレクトリをリストします。各 NFS 共有について、リストされたマシンだけがアクセスを許可されます。よりきめ細かなアクセス制御を行うには、いくつかのオプションを使います。<code
              class="filename">/etc/exports</code> ファイルの構文はとても単純です:
			</div><a
            id="idm140170048460016"
            class="indexterm"></a><a
            id="idm140170048459120"
            class="indexterm"></a><pre
            class="programlisting">
/directory/to/share machine1(option1,option2,...) machine2(...) ...</pre><div
            class="para">
				各マシンは DNS 名か IP アドレスのどちらか一方を使って識別されます。マシン群全体を指定するには、<code
              class="literal">*.falcot.com</code> などの構文を使うか <code
              class="literal">192.168.0.0/255.255.255.0</code> や <code
              class="literal">192.168.0.0/24</code> などの IP アドレス範囲を使います。
			</div><div
            class="para">
				ディレクトリはデフォルトで (または <code
              class="literal">ro</code> オプションを使えば) 読み込み専用として利用できるようにされます。<code
              class="literal">rw</code> オプションを使えば読み書きアクセスが許可されます。典型的に NFS クライアントは root だけが使えるポート (言い換えれば、1024 番よりも低い番号のポート) から接続します; この制限をなくすには、<code
              class="literal">insecure</code> オプションを使います (<code
              class="literal">secure</code> オプションは暗黙的に有効化されていますが、明示する必要があればオプションを明示することも可能です)。
			</div><a
            id="idm140170048453648"
            class="indexterm"></a><div
            class="para">
				デフォルトの状態では、サーバが NFS 問い合わせに応答するのは、現在のディスク操作が完了した (<code
              class="literal">sync</code> オプション) 後です; これを無効化するには、<code
              class="literal">async</code> オプションを使います。非同期書き込みを使うことで、性能はほんの少し向上しますが、信頼性は低下します。なぜなら、書き込み確認とディスクへの実際の書き込みの間にサーバがクラッシュした場合に、データを損失する危険性があるからです。デフォルト値が変更されたのは最近なので (NFS バージョンによってデフォルト値が違うので) 、明確に設定することを推奨します。
			</div><div
            class="para">
				NFS クライアントがファイルシステムに root 権限でアクセスすることを許可しないために、サーバは root ユーザからのすべての問い合わせを <code
              class="literal">nobody</code> ユーザからの問い合わせとして処理します。この挙動は <code
              class="literal">root_squash</code> オプションを使った場合の挙動に対応し、このオプションはデフォルトで有効化されています。<code
              class="literal">no_root_squash</code> オプションを使うことで、この挙動は無効化されますが、このオプションは危険であり管理された環境の中でのみ使われるべきです。<code
              class="literal">anonuid=<em
                class="replaceable">uid</em></code> と <code
              class="literal">anongid=<em
                class="replaceable">gid</em></code> オプションを使うことで、UID/GID 65534 (これは <code
              class="literal">nobody</code> ユーザと <code
              class="literal">nogroup</code> グループに対応します) の代わりに使う別の偽ユーザを指定することが可能です。
			</div><div
            class="para">
				他のオプションも利用できます; オプションは <span
              class="citerefentry"><span
                class="refentrytitle">exports</span>(5)</span> マニュアルページで説明されています。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>CAUTION</em></span> 最初のインストール</strong></p></div></div></div><div
              class="para">
				<code
                class="filename">/etc/init.d/nfs-kernel-server</code> 起動スクリプトは、<code
                class="filename">/etc/exports</code> に 1 つ以上の NFS 共有が含まれる場合に、サーバを起動するだけです。最初の設定で、<code
                class="filename">/etc/exports</code> ファイルを編集して適切なエントリを含めたら、NFS サーバを以下のコマンドで起動するべきです。
			</div><pre
              class="screen">
<code
                class="computeroutput"># </code><strong
                class="userinput"><code>/etc/init.d/nfs-kernel-server start</code></strong></pre></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140170048441248"></a>11.4.3. NFS クライアント</h3></div></div></div><a
            id="idm140170048440608"
            class="indexterm"></a><a
            id="idm140170048439456"
            class="indexterm"></a><div
            class="para">
				他のファイルシステムと同様、NFS 共有をシステムの階層構造に統合するにはマウント作業が必要です。NFS 共有ファイルシステムは特殊なので、<code
              class="command">mount</code> コマンドと <code
              class="filename">/etc/fstab</code> ファイルにいくつかの調整を行うパラメータを含める必要があります。
			</div><div
            class="example"><a
              id="idm140170048436832"></a><p
              class="title"><strong>例11.26 <code
                  class="command">mount</code> コマンドを用いた手作業によるマウント</strong></p><div
              class="example-contents"><pre
                class="screen">
<code
                  class="computeroutput"># </code><strong
                  class="userinput"><code>mount -t nfs -o rw,nosuid arrakis.internal.falcot.com:/srv/shared /shared</code></strong></pre></div></div><div
            class="example"><a
              id="idm140170048434912"></a><p
              class="title"><strong>例11.27 <code
                  class="filename">/etc/fstab</code> ファイルの NFS エントリ</strong></p><div
              class="example-contents"><pre
                class="programlisting">
arrakis.internal.falcot.com:/srv/shared /shared nfs rw,nosuid 0 0</pre></div></div><div
            class="para">
				上の例で示したエントリを使うことで、システム起動時に、<code
              class="literal">arrakis</code> サーバの <code
              class="filename">/srv/shared/</code> NFS ディレクトリがローカルの <code
              class="filename">/shared/</code> ディレクトリにマウントされます。読み書きアクセスを要求しています (このため <code
              class="literal">rw</code> パラメータを追加しています)。<code
              class="literal">nosuid</code> オプションは一種の保護手段で、共有ディレクトリに保存されているプログラムに設定された <code
              class="literal">setuid</code> または <code
              class="literal">setgid</code> ビットを無効化します。文書を保存するだけの目的で NFS 共有を使っている場合、<code
              class="literal">noexec</code> オプションを追加することを推奨します。これは共有ディレクトリに含まれるプログラムの実行を避けるものです。
			</div><div
            class="para">
				<span
              class="citerefentry"><span
                class="refentrytitle">nfs</span>(5)</span> マニュアルページでは、すべてのオプションをについて詳しく説明されています。
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="sect.ftp-file-server.html"><strong>戻る</strong>11.3. FTP ファイルサーバ</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.windows-file-server-with-samba.html"><strong>次へ</strong>11.5. Samba を使った Windows 共有のセットアップ</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.nfs-file-server.html">ar-MA</a></li><li><a
              href="../da-DK/sect.nfs-file-server.html">da-DK</a></li><li><a
              href="../de-DE/sect.nfs-file-server.html">de-DE</a></li><li><a
              href="../el-GR/sect.nfs-file-server.html">el-GR</a></li><li><a
              href="../en-US/sect.nfs-file-server.html">en-US</a></li><li><a
              href="../es-ES/sect.nfs-file-server.html">es-ES</a></li><li><a
              href="../fa-IR/sect.nfs-file-server.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.nfs-file-server.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.nfs-file-server.html">hr-HR</a></li><li><a
              href="../id-ID/sect.nfs-file-server.html">id-ID</a></li><li><a
              href="../it-IT/sect.nfs-file-server.html">it-IT</a></li><li><a
              href="../ja-JP/sect.nfs-file-server.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.nfs-file-server.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.nfs-file-server.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.nfs-file-server.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.nfs-file-server.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.nfs-file-server.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.nfs-file-server.html">zh-CN</a></li></ul></div></body></html>
