<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"><head><meta
        http-equiv="Content-Type"
        content="text/html; charset=UTF-8" /><title
        xmlns:d="http://docbook.org/ns/docbook">15.2. 最初のパッケージのビルド</title><link
        rel="stylesheet"
        type="text/css"
        href="Common_Content/css/default.css" /><link
        rel="stylesheet"
        media="print"
        href="Common_Content/css/print.css"
        type="text/css" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="generator"
        content="publican v4.3.2" /><meta
        xmlns:d="http://docbook.org/ns/docbook"
        name="package"
        content="Debian-debian-handbook-8-ja-JP-1.0-1" /><meta
        name="keywords"
        content="バックポート, 再ビルド, ソースパッケージ, アーカイブ, メタパッケージ, Debian 開発者, メンテナ" /><link
        rel="home"
        href="index.html"
        title="Debian 管理者ハンドブック" /><link
        rel="up"
        href="debian-packaging.html"
        title="第15章 Debian パッケージの作成" /><link
        rel="prev"
        href="debian-packaging.html"
        title="第15章 Debian パッケージの作成" /><link
        rel="next"
        href="sect.setup-apt-package-repository.html"
        title="15.3. APT 用のパッケージリポジトリの作成" /><link
        rel="canonical"
        href="http://l.github.io/debian-handbook/html/ja-JP/sect.building-first-package.html" /></head><body
      class="draft "><noscript><iframe
          src="//www.googletagmanager.com/ns.html?id=GTM-5H35QX"
          height="0"
          width="0"
          style="display:none;visibility:hidden"></iframe></noscript><script
        type="text/javascript">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-5H35QX');</script><div
        id="banner"><a
          href="http://debian-handbook.info/get/"><span
            class="text">Download the ebook</span></a></div><p
        id="title"><a
          class="left"
          href="http://www.debian.org"><img
            alt="Product Site"
            src="Common_Content/images//image_left.png" /></a><a
          class="right"
          href="http://debian-handbook.info"><img
            alt="Documentation Site"
            src="Common_Content/images//image_right.png" /></a></p><ul
        class="docnav top"><li
          class="previous"><a
            accesskey="p"
            href="debian-packaging.html"><strong>戻る</strong></a></li><li
          class="home">Debian 管理者ハンドブック</li><li
          class="next"><a
            accesskey="n"
            href="sect.setup-apt-package-repository.html"><strong>次へ</strong></a></li></ul><div
        class="section"><div
          class="titlepage"><div><div><h2
                class="title"><a
                  id="sect.building-first-package"></a>15.2. 最初のパッケージのビルド</h2></div></div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140090710858496"></a>15.2.1. メタパッケージか偽物のパッケージ</h3></div></div></div><div
            class="para">
				偽物のパッケージとメタパッケージは似ています。両者は自分のメタデータをパッケージ取り扱いスタックに置いておくためだけに存在する抜け殻です。
			</div><div
            class="para">
				偽物のパッケージの目的は、<code
              class="command">dpkg</code> と <code
              class="command">apt</code> をだまして、抜け殻に過ぎないいくつかのパッケージがインストールされていると信じこませることにあります。これを使うことで、あるソフトウェアの依存関係を満足させるために必要なソフトウェアがパッケージシステムの管轄外にインストールされている場合に、そのソフトウェアの依存関係を満足させることが可能です。この方法は問題を解決しますが、これはできる限り避けるべき方法です。なぜなら、手作業でインストールされたソフトウェアが対応するパッケージと全く同様に振る舞う保証はありませんし、手作業でインストールされたソフトウェアに依存する他のパッケージが適切に動く保証もないからです。
			</div><div
            class="para">
				逆に、メタパッケージはほとんどの場合依存関係の集合体として機能します。メタパッケージをインストールするだけで、一連の他のパッケージがインストールされます。
			</div><div
            class="para">
				偽物のパッケージとメタパッケージは <code
              class="command">equivs-control</code> と <code
              class="command">equivs-build</code> コマンド (<span
              class="pkg pkg">equivs</span> パッケージに含まれます) を使って作成されます。<code
              class="command">equivs-control <em
                class="replaceable">file</em></code> コマンドは Debian パッケージヘッダファイルを作成します。Debian パッケージヘッダファイルには、パッケージの名前、バージョン番号、メンテナ、依存関係、説明を含めるように編集します。デフォルト値を持たない他のフィールドは任意で、削除することも可能です。<code
              class="literal">Copyright</code>、<code
              class="literal">Changelog</code>、<code
              class="literal">Readme</code>、<code
              class="literal">Extra-Files</code> フィールドは Debian パッケージの標準的なフィールドではありません。さらに、これらのフィールドは <code
              class="command">equivs-build</code> を使う限りにおいて意味を持つものであり、生成されるパッケージのヘッダから削除されるべきです。
			</div><div
            class="example"><a
              id="idm140090710848240"></a><p
              class="title"><strong>例15.2 <span
                  class="emphasis"><em>libxml-libxml-perl</em></span> 偽物のパッケージのヘッダファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Section: perl
Priority: optional
Standards-Version: 3.9.6

Package: libxml-libxml-perl
Version: 2.0116-1
Maintainer: Raphael Hertzog &lt;hertzog@debian.org&gt;
Depends: libxml2 (&gt;= 2.7.4)
Architecture: all
Description: Fake package - module manually installed in site_perl
 This is a fake package to let the packaging system
 believe that this Debian package is installed. 
 .
 In fact, the package is not installed since a newer version
 of the module has been manually compiled &amp; installed in the
 site_perl directory.</pre></div></div><div
            class="para">
				次のステップでは、<code
              class="command">equivs-build <em
                class="replaceable">file</em></code> コマンドを使って Debian パッケージを生成します。さぁこれで、パッケージは現在のディレクトリに作成され、他の Debian パッケージと同様に取り扱うことが可能になります。
			</div></div><div
          class="section"><div
            class="titlepage"><div><div><h3
                  class="title"><a
                    id="idm140090710844384"></a>15.2.2. 単純なファイルアーカイブ</h3></div></div></div><div
            class="para">
				Falcot Corp の管理者は大量のマシン上に一連の文書を配備することを簡単に行うために Debian パッケージを作成する必要があります。この作業を担当している管理者は最初に「新メンテナーガイド」を読み、その後最初のパッケージに対する作業に着手します。<div
              class="url">→ <a
                href="https://www.debian.org/doc/manuals/maint-guide/">https://www.debian.org/doc/manuals/maint-guide/</a></div>
			</div><div
            class="para">
				最初に、対象のソースパッケージを含める <code
              class="filename">falcot-data-1.0</code> ディレクトリを作成します。このパッケージは必然的に、<code
              class="literal">falcot-data</code> と名付けられ、バージョン番号は <code
              class="literal">1.0</code> になります。その後、管理者は文書ファイルを <code
              class="filename">data</code> サブディレクトリに置きます。その後、管理者は <code
              class="command">dh_make</code> コマンド (<span
              class="pkg pkg">dh-make</span> パッケージに含まれます) を実行し、パッケージ生成作業に必要なファイルを追加します。このファイルは <code
              class="filename">debian</code> サブディレクトリに保存されます。
			</div><pre
            class="screen">
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>cd falcot-data-1.0</code></strong>
<code
              class="computeroutput">$ </code><strong
              class="userinput"><code>dh_make --native</code></strong>
<code
              class="computeroutput">
Type of package: single binary, indep binary, multiple binary, library, kernel module, kernel patch?
 [s/i/m/l/k/n] </code><strong
              class="userinput"><code>i</code></strong>
<code
              class="computeroutput">
Maintainer name : Raphael Hertzog
Email-Address   : hertzog@debian.org
Date            : Fri, 04 Sep 2015 12:09:39 -0400
Package Name    : falcot-data
Version         : 1.0
License         : gpl3
Type of Package : Independent
Hit &lt;enter&gt; to confirm:
Currently there is no top level Makefile. This may require additional tuning.
Done. Please edit the files in the debian/ subdirectory now. You should also
check that the falcot-data Makefiles install into $DESTDIR and not in / .
$</code></pre><div
            class="para">
				パッケージの種類で <span
              class="emphasis"><em>indep binary</em></span> を選ぶと、ソースパッケージから単一のバイナリパッケージを生成します。ここで生成されるバイナリパッケージはすべてのアーキテクチャで共有されることを意味します (<code
              class="literal">Architecture: all</code>)。<span
              class="emphasis"><em>single binary</em></span> はその逆の振る舞いで、対象のアーキテクチャに依存する (<code
              class="literal">Architecture: any</code>) 単一のバイナリを生成します。今回作成するパッケージの場合、<span
              class="emphasis"><em>indep binary</em></span> がより適切です。なぜなら、このパッケージは文書だけを含みバイナリプログラムを含まないからです。このため、すべてのアーキテクチャのコンピュータで同様に使うことが可能です。
			</div><a
            id="idm140090710831152"
            class="indexterm"></a><a
            id="idm140090710830224"
            class="indexterm"></a><div
            class="para">
				<span
              class="emphasis"><em>multiple binary</em></span> を選ぶと、ソースパッケージから複数のバイナリパッケージを作成することになります。<span
              class="emphasis"><em>library</em></span> は特別な場合で、共有ライブラリ用に用意されています。なぜなら、共有ライブラリは厳しいパッケージ化規則に従う必要があるからです。同様に、<span
              class="emphasis"><em>kernel module</em></span> および <span
              class="emphasis"><em>kernel patch</em></span> はカーネルモジュールを含むパッケージ用に用意されています。
			</div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>TIP</em></span> メンテナの名前と電子メールアドレス</strong></p></div></div></div><div
              class="para">
				パッケージメンテナンスに関わるほとんどのプログラムはメンテナの名前と電子メールアドレスを <code
                class="varname">DEBFULLNAME</code> と <code
                class="varname">DEBEMAIL</code> または <code
                class="varname">EMAIL</code> 環境変数から取得します。たった 1 回だけこれらの環境変数を定義するだけで、毎回これらの情報を打ち込む必要がなくなります。通常のシェルが <code
                class="command">bash</code> の場合、<code
                class="filename">~/.bashrc</code> ファイルに以下の 2 行 (当然ですが、値を自分のものに変えてくださいね!) を追加するだけで簡単にこれを行うことが可能です。
			</div><pre
              class="programlisting">
export EMAIL="hertzog@debian.org"
export DEBFULLNAME="Raphael Hertzog"</pre></div><div
            class="para">
				<code
              class="command">dh_make</code> コマンドは <code
              class="filename">debian</code> サブディレクトリと各種ファイルを作成しました。一部のファイル、特に <code
              class="filename">rules</code>、<code
              class="filename">control</code>、<code
              class="filename">changelog</code>、<code
              class="filename">copyright</code> は必須です。<code
              class="filename">.ex</code> 拡張子を持つファイルは例ファイルで、必要ならばこれらのファイルをひな形として (拡張子を削除して) 使うことが可能です。必要なければ例ファイルを削除することを推奨します。<code
              class="filename">compat</code> ファイルはそのままにしておくべきです。なぜなら、<code
              class="filename">compat</code> ファイルはパッケージビルド作業のさまざまな段階で使われる <span
              class="emphasis"><em>debhelper</em></span> プログラムスイート (<code
              class="command">dh_</code> から始まるプログラム群) を適切に動作させるために必要だからです。
			</div><div
            class="para">
				<code
              class="filename">copyright</code> ファイルには、必ずパッケージに含まれる文書の著者と対応するライセンスに関する情報を含めなければいけません。今回の場合、パッケージには内部文書が含まれ、その使用は Falcot Corp 社内だけに制限されています。デフォルトの <code
              class="filename">changelog</code> ファイルはほとんどの場合に適切です。「Initial release」をより詳しい説明に置き換えたり、<code
              class="literal">unstable</code> を <code
              class="literal">internal</code> に変えるだけで十分です。<code
              class="filename">control</code> ファイルも更新します。具体的に言えば、section を <span
              class="emphasis"><em>misc</em></span> に変更し、<code
              class="literal">Homepage</code>、<code
              class="literal">Vcs-Git</code>、<code
              class="literal">Vcs-Browser</code> を削除しました。<code
              class="literal">Depends</code> フィールドには <code
              class="literal">iceweasel | www-browser</code> を指定しました。これはパッケージ内の文書を表示するために必要なウェブブラウザがインストールされていることを保証するためです。
			</div><div
            class="example"><a
              id="idm140090710808960"></a><p
              class="title"><strong>例15.3 <code
                  class="filename">control</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Source: falcot-data
Section: misc
Priority: optional
Maintainer: Raphael Hertzog &lt;hertzog@debian.org&gt;
Build-Depends: debhelper (&gt;= 9)
Standards-Version: 3.9.5

Package: falcot-data
Architecture: all
Depends: iceweasel | www-browser, ${misc:Depends}
Description: Internal Falcot Corp Documentation
 This package provides several documents describing the internal
 structure at Falcot Corp.  This includes:
  - organization diagram
  - contacts for each department.
 .
 These documents MUST NOT leave the company.
 Their use is INTERNAL ONLY.</pre></div></div><div
            class="example"><a
              id="idm140090710806672"></a><p
              class="title"><strong>例15.4 <code
                  class="filename">changelog</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
falcot-data (1.0) internal; urgency=low

  * Initial Release.
  * Let's start with few documents:
    - internal company structure;
    - contacts for each department.

 -- Raphael Hertzog &lt;hertzog@debian.org&gt;  Fri, 04 Sep 2015 12:09:39 -0400</pre></div></div><div
            class="example"><a
              id="idm140090710804688"></a><p
              class="title"><strong>例15.5 <code
                  class="filename">copyright</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
Format: http://www.debian.org/doc/packaging-manuals/copyright-format/1.0/
Upstream-Name: falcot-data

Files: *
Copyright: 2004-2015 Falcot Corp
License: 
 All rights reserved.</pre></div></div><div
            class="sidebar"><div
              class="titlepage"><div><div><p
                    class="title"><strong><span
                        class="emphasis"><em>BACK TO BASICS</em></span> <code
                        class="filename">Makefile</code> ファイル</strong></p></div></div></div><a
              id="idm140090710801168"
              class="indexterm"></a><div
              class="para">
				<code
                class="filename">Makefile</code> ファイルは <code
                class="command">make</code> プログラムによって使われるスクリプトです。さらに <code
                class="filename">Makefile</code> ファイルは互いに依存関係を持つファイル群をビルドする規則を指定します (たとえば、複数のソースファイル群から 1 つのプログラムをビルドすることを指定します)。<code
                class="filename">Makefile</code> ファイルはビルド規則を以下のフォーマットで指定します。
			</div><pre
              class="programlisting">
target: source1 source2 ...
        command1
        command2</pre><div
              class="para">
				ビルド規則の解釈は以下の通り行われます。つまり <code
                class="literal">source*</code> ファイルの 1 つが <code
                class="literal">target</code> ファイルよりも新しい場合、<code
                class="command">command1</code> と <code
                class="command">command2</code> を使って target を生成します。
			</div><div
              class="para">
				コマンド行は必ずタブ文字で開始しなければいけない点に注意してください。さらに、コマンド行がダッシュ文字 (<code
                class="literal">-</code>) で始まる場合、そのコマンドが失敗しても全体のプロセスは停止されなくなる点に注意してください。
			</div></div><div
            class="para">
				<code
              class="filename">rules</code> ファイルには、(生成されるバイナリパッケージにちなんで名付けられた) 専用のサブディレクトリ内で対象のソフトウェアを設定、ビルド、インストールするために使われる一連の規則が定義されています。このサブディレクトリの内容はあたかもサブディレクトリがファイルシステムのルートであるかのように Debian パッケージの中に保存されます。今回の場合、ファイルは <code
              class="filename">debian/falcot-data/usr/share/falcot-data/</code> サブディレクトリにインストールされます。こうすることで、生成されたパッケージをインストールすると、ファイルが <code
              class="filename">/usr/share/falcot-data/</code> の下に配備されます。<code
              class="filename">rules</code> ファイルは <code
              class="filename">Makefile</code> として使われ、いくつかの標準的なターゲット (定義済みの <code
              class="literal">clean</code> と <code
              class="literal">binary</code> はそれぞれソースディレクトリを削除する場合、バイナリパッケージを生成する場合に使います) が定義されています。
			</div><div
            class="para">
				<code
              class="filename">rules</code> ファイルはビルド作業の核心で、<code
              class="command">debhelper</code> ツールによって提供される標準的なコマンド群を実行するために必要な最低限の要素だけを含みます。これが面倒を見るのは <code
              class="command">dh_make</code> によって生成されたファイルだけです。自分のファイルをインストールするためには、以下の <code
              class="filename">debian/falcot-data.install</code> ファイルを作成して、<code
              class="command">dh_install</code> コマンドの挙動を単純に設定します。
			</div><pre
            class="programlisting">
data/* usr/share/falcot-data/</pre><div
            class="para">
				この時点でパッケージを作成することも可能ですが、パッケージにもう少しファイルを追加します。管理者はグラフィカルデスクトップ環境のメニューから文書へ簡単にアクセスできるようにしたいので、パッケージに <code
              class="filename">falcot-data.desktop</code> ファイルを追加します。さらに <code
              class="filename">debian/falcot-data.install</code> に例に示した 2 行目を追加して、<code
              class="filename">/usr/share/applications</code> の中に <code
              class="filename">falcot-data.desktop</code> ファイルをインストールします。
			</div><div
            class="example"><a
              id="idm140090712057904"></a><p
              class="title"><strong>例15.6 <code
                  class="filename">falcot-data.desktop</code> ファイル</strong></p><div
              class="example-contents"><pre
                class="programlisting">
[Desktop Entry]
Name=Internal Falcot Corp Documentation
Comment=Starts a browser to read the documentation
Exec=x-www-browser /usr/share/falcot-data/index.html
Terminal=false
Type=Application
Categories=Documentation;</pre></div></div><div
            class="para">
				編集後の <code
              class="filename">debian/falcot-data.install</code> は以下のようになります。
			</div><pre
            class="programlisting">
data/* usr/share/falcot-data/
falcot-data.desktop usr/share/applications/</pre><div
            class="para">
				これでソースパッケージの準備が整いました。最後に残された作業は、以前パッケージを再ビルドした際に使った方法と同じ方法を使って、バイナリパッケージを生成することです。具体的に言えば、バイナリパッケージを生成するには、<code
              class="filename">falcot-data-1.0</code> ディレクトリの中で、<code
              class="command">dpkg-buildpackage -us -uc</code> コマンドを実行します。
			</div></div></div><ul
        class="docnav"><li
          class="previous"><a
            accesskey="p"
            href="debian-packaging.html"><strong>戻る</strong>第15章 Debian パッケージの作成</a></li><li
          class="up"><a
            accesskey="u"
            href="#"><strong>上に戻る</strong></a></li><li
          class="home"><a
            accesskey="h"
            href="index.html"><strong>ホーム</strong></a></li><li
          class="next"><a
            accesskey="n"
            href="sect.setup-apt-package-repository.html"><strong>次へ</strong>15.3. APT 用のパッケージリポジトリの作成</a></li></ul><div
        id="translated_pages"><ul><li><a
              href="../ar-MA/sect.building-first-package.html">ar-MA</a></li><li><a
              href="../da-DK/sect.building-first-package.html">da-DK</a></li><li><a
              href="../de-DE/sect.building-first-package.html">de-DE</a></li><li><a
              href="../el-GR/sect.building-first-package.html">el-GR</a></li><li><a
              href="../en-US/sect.building-first-package.html">en-US</a></li><li><a
              href="../es-ES/sect.building-first-package.html">es-ES</a></li><li><a
              href="../fa-IR/sect.building-first-package.html">fa-IR</a></li><li><a
              href="../fr-FR/sect.building-first-package.html">fr-FR</a></li><li><a
              href="../hr-HR/sect.building-first-package.html">hr-HR</a></li><li><a
              href="../id-ID/sect.building-first-package.html">id-ID</a></li><li><a
              href="../it-IT/sect.building-first-package.html">it-IT</a></li><li><a
              href="../ja-JP/sect.building-first-package.html">ja-JP</a></li><li><a
              href="../pl-PL/sect.building-first-package.html">pl-PL</a></li><li><a
              href="../pt-BR/sect.building-first-package.html">pt-BR</a></li><li><a
              href="../ro-RO/sect.building-first-package.html">ro-RO</a></li><li><a
              href="../ru-RU/sect.building-first-package.html">ru-RU</a></li><li><a
              href="../tr-TR/sect.building-first-package.html">tr-TR</a></li><li><a
              href="../zh-CN/sect.building-first-package.html">zh-CN</a></li></ul></div></body></html>
